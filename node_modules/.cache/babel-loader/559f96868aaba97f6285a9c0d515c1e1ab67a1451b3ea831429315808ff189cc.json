{"ast":null,"code":"import { _ as __assign, b as __awaiter, c as __generator, d as createNanoEvents, a as __rest } from './common-ba25e019.js';\nimport { b as commonjsRequire, r as requireMinimal, c as commonjsGlobal, p as protoExports, M as MessageNames, d as createProtocol } from './sdk-f73acc07.js';\nvar asr = {\n  exports: {}\n};\n\n/*eslint-disable block-scoped-var, id-length, no-control-regex, no-magic-numbers, no-prototype-builtins, no-redeclare, no-shadow, no-var, sort-vars*/\n\n(function (module) {\n  (function (global, factory) {\n    /* global define, require, module */\n\n    /* AMD */if (typeof commonjsRequire === 'function' && 'object' === 'object' && module && module.exports) module.exports = factory(requireMinimal());\n  })(commonjsGlobal, function ($protobuf) {\n    // Common aliases\n    var $Reader = $protobuf.Reader,\n      $util = $protobuf.util;\n\n    // Exported root namespace\n    var $root = $protobuf.roots[\"default\"] || ($protobuf.roots[\"default\"] = {});\n    $root.Variables = function () {\n      /**\n       * Properties of a Variables.\n       * @exports IVariables\n       * @interface IVariables\n       * @property {Object.<string,string>|null} [variables] Variables variables\n       */\n\n      /**\n       * Constructs a new Variables.\n       * @exports Variables\n       * @classdesc Represents a Variables.\n       * @implements IVariables\n       * @constructor\n       * @param {IVariables=} [properties] Properties to set\n       */\n      function Variables(properties) {\n        this.variables = {};\n        if (properties) for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i) if (properties[keys[i]] != null) this[keys[i]] = properties[keys[i]];\n      }\n\n      /**\n       * Variables variables.\n       * @member {Object.<string,string>} variables\n       * @memberof Variables\n       * @instance\n       */\n      Variables.prototype.variables = $util.emptyObject;\n\n      /**\n       * Decodes a Variables message from the specified reader or buffer.\n       * @function decode\n       * @memberof Variables\n       * @static\n       * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n       * @param {number} [length] Message length if known beforehand\n       * @returns {Variables} Variables\n       * @throws {Error} If the payload is not a reader or valid buffer\n       * @throws {$protobuf.util.ProtocolError} If required fields are missing\n       */\n      Variables.decode = function decode(reader, length) {\n        if (!(reader instanceof $Reader)) reader = $Reader.create(reader);\n        var end = length === undefined ? reader.len : reader.pos + length,\n          message = new $root.Variables(),\n          key,\n          value;\n        while (reader.pos < end) {\n          var tag = reader.uint32();\n          switch (tag >>> 3) {\n            case 1:\n              {\n                if (message.variables === $util.emptyObject) message.variables = {};\n                var end2 = reader.uint32() + reader.pos;\n                key = \"\";\n                value = \"\";\n                while (reader.pos < end2) {\n                  var tag2 = reader.uint32();\n                  switch (tag2 >>> 3) {\n                    case 1:\n                      key = reader.string();\n                      break;\n                    case 2:\n                      value = reader.string();\n                      break;\n                    default:\n                      reader.skipType(tag2 & 7);\n                      break;\n                  }\n                }\n                message.variables[key] = value;\n                break;\n              }\n            default:\n              reader.skipType(tag & 7);\n              break;\n          }\n        }\n        return message;\n      };\n      return Variables;\n    }();\n    $root.UndecodedSeconds = function () {\n      /**\n       * Properties of an UndecodedSeconds.\n       * @exports IUndecodedSeconds\n       * @interface IUndecodedSeconds\n       * @property {number|null} [undecodedSeconds] UndecodedSeconds undecodedSeconds\n       */\n\n      /**\n       * Constructs a new UndecodedSeconds.\n       * @exports UndecodedSeconds\n       * @classdesc Represents an UndecodedSeconds.\n       * @implements IUndecodedSeconds\n       * @constructor\n       * @param {IUndecodedSeconds=} [properties] Properties to set\n       */\n      function UndecodedSeconds(properties) {\n        if (properties) for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i) if (properties[keys[i]] != null) this[keys[i]] = properties[keys[i]];\n      }\n\n      /**\n       * UndecodedSeconds undecodedSeconds.\n       * @member {number} undecodedSeconds\n       * @memberof UndecodedSeconds\n       * @instance\n       */\n      UndecodedSeconds.prototype.undecodedSeconds = 0;\n\n      /**\n       * Decodes an UndecodedSeconds message from the specified reader or buffer.\n       * @function decode\n       * @memberof UndecodedSeconds\n       * @static\n       * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n       * @param {number} [length] Message length if known beforehand\n       * @returns {UndecodedSeconds} UndecodedSeconds\n       * @throws {Error} If the payload is not a reader or valid buffer\n       * @throws {$protobuf.util.ProtocolError} If required fields are missing\n       */\n      UndecodedSeconds.decode = function decode(reader, length) {\n        if (!(reader instanceof $Reader)) reader = $Reader.create(reader);\n        var end = length === undefined ? reader.len : reader.pos + length,\n          message = new $root.UndecodedSeconds();\n        while (reader.pos < end) {\n          var tag = reader.uint32();\n          switch (tag >>> 3) {\n            case 1:\n              {\n                message.undecodedSeconds = reader.float();\n                break;\n              }\n            default:\n              reader.skipType(tag & 7);\n              break;\n          }\n        }\n        return message;\n      };\n      return UndecodedSeconds;\n    }();\n    $root.FullyFinalized = function () {\n      /**\n       * Properties of a FullyFinalized.\n       * @exports IFullyFinalized\n       * @interface IFullyFinalized\n       */\n\n      /**\n       * Constructs a new FullyFinalized.\n       * @exports FullyFinalized\n       * @classdesc Represents a FullyFinalized.\n       * @implements IFullyFinalized\n       * @constructor\n       * @param {IFullyFinalized=} [properties] Properties to set\n       */\n      function FullyFinalized(properties) {\n        if (properties) for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i) if (properties[keys[i]] != null) this[keys[i]] = properties[keys[i]];\n      }\n\n      /**\n       * Decodes a FullyFinalized message from the specified reader or buffer.\n       * @function decode\n       * @memberof FullyFinalized\n       * @static\n       * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n       * @param {number} [length] Message length if known beforehand\n       * @returns {FullyFinalized} FullyFinalized\n       * @throws {Error} If the payload is not a reader or valid buffer\n       * @throws {$protobuf.util.ProtocolError} If required fields are missing\n       */\n      FullyFinalized.decode = function decode(reader, length) {\n        if (!(reader instanceof $Reader)) reader = $Reader.create(reader);\n        var end = length === undefined ? reader.len : reader.pos + length,\n          message = new $root.FullyFinalized();\n        while (reader.pos < end) {\n          var tag = reader.uint32();\n          switch (tag >>> 3) {\n            default:\n              reader.skipType(tag & 7);\n              break;\n          }\n        }\n        return message;\n      };\n      return FullyFinalized;\n    }();\n    $root.EmotionResult = function () {\n      /**\n       * Properties of an EmotionResult.\n       * @exports IEmotionResult\n       * @interface IEmotionResult\n       * @property {string|null} [name] EmotionResult name\n       * @property {number|null} [confidence] EmotionResult confidence\n       */\n\n      /**\n       * Constructs a new EmotionResult.\n       * @exports EmotionResult\n       * @classdesc Represents an EmotionResult.\n       * @implements IEmotionResult\n       * @constructor\n       * @param {IEmotionResult=} [properties] Properties to set\n       */\n      function EmotionResult(properties) {\n        if (properties) for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i) if (properties[keys[i]] != null) this[keys[i]] = properties[keys[i]];\n      }\n\n      /**\n       * EmotionResult name.\n       * @member {string} name\n       * @memberof EmotionResult\n       * @instance\n       */\n      EmotionResult.prototype.name = \"\";\n\n      /**\n       * EmotionResult confidence.\n       * @member {number} confidence\n       * @memberof EmotionResult\n       * @instance\n       */\n      EmotionResult.prototype.confidence = 0;\n\n      /**\n       * Decodes an EmotionResult message from the specified reader or buffer.\n       * @function decode\n       * @memberof EmotionResult\n       * @static\n       * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n       * @param {number} [length] Message length if known beforehand\n       * @returns {EmotionResult} EmotionResult\n       * @throws {Error} If the payload is not a reader or valid buffer\n       * @throws {$protobuf.util.ProtocolError} If required fields are missing\n       */\n      EmotionResult.decode = function decode(reader, length) {\n        if (!(reader instanceof $Reader)) reader = $Reader.create(reader);\n        var end = length === undefined ? reader.len : reader.pos + length,\n          message = new $root.EmotionResult();\n        while (reader.pos < end) {\n          var tag = reader.uint32();\n          switch (tag >>> 3) {\n            case 1:\n              {\n                message.name = reader.string();\n                break;\n              }\n            case 2:\n              {\n                message.confidence = reader.float();\n                break;\n              }\n            default:\n              reader.skipType(tag & 7);\n              break;\n          }\n        }\n        return message;\n      };\n      return EmotionResult;\n    }();\n    $root.Hypothesis = function () {\n      /**\n       * Properties of a Hypothesis.\n       * @exports IHypothesis\n       * @interface IHypothesis\n       * @property {string|null} [words] Hypothesis words\n       * @property {number|null} [acousticCost] Hypothesis acousticCost\n       * @property {number|null} [linguisticCost] Hypothesis linguisticCost\n       * @property {number|null} [finalCost] Hypothesis finalCost\n       * @property {number|null} [phraseStart] Hypothesis phraseStart\n       * @property {number|null} [phraseEnd] Hypothesis phraseEnd\n       * @property {string|null} [normalizedText] Hypothesis normalizedText\n       */\n\n      /**\n       * Constructs a new Hypothesis.\n       * @exports Hypothesis\n       * @classdesc Represents a Hypothesis.\n       * @implements IHypothesis\n       * @constructor\n       * @param {IHypothesis=} [properties] Properties to set\n       */\n      function Hypothesis(properties) {\n        if (properties) for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i) if (properties[keys[i]] != null) this[keys[i]] = properties[keys[i]];\n      }\n\n      /**\n       * Hypothesis words.\n       * @member {string} words\n       * @memberof Hypothesis\n       * @instance\n       */\n      Hypothesis.prototype.words = \"\";\n\n      /**\n       * Hypothesis acousticCost.\n       * @member {number} acousticCost\n       * @memberof Hypothesis\n       * @instance\n       */\n      Hypothesis.prototype.acousticCost = 0;\n\n      /**\n       * Hypothesis linguisticCost.\n       * @member {number} linguisticCost\n       * @memberof Hypothesis\n       * @instance\n       */\n      Hypothesis.prototype.linguisticCost = 0;\n\n      /**\n       * Hypothesis finalCost.\n       * @member {number} finalCost\n       * @memberof Hypothesis\n       * @instance\n       */\n      Hypothesis.prototype.finalCost = 0;\n\n      /**\n       * Hypothesis phraseStart.\n       * @member {number} phraseStart\n       * @memberof Hypothesis\n       * @instance\n       */\n      Hypothesis.prototype.phraseStart = 0;\n\n      /**\n       * Hypothesis phraseEnd.\n       * @member {number} phraseEnd\n       * @memberof Hypothesis\n       * @instance\n       */\n      Hypothesis.prototype.phraseEnd = 0;\n\n      /**\n       * Hypothesis normalizedText.\n       * @member {string} normalizedText\n       * @memberof Hypothesis\n       * @instance\n       */\n      Hypothesis.prototype.normalizedText = \"\";\n\n      /**\n       * Decodes a Hypothesis message from the specified reader or buffer.\n       * @function decode\n       * @memberof Hypothesis\n       * @static\n       * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n       * @param {number} [length] Message length if known beforehand\n       * @returns {Hypothesis} Hypothesis\n       * @throws {Error} If the payload is not a reader or valid buffer\n       * @throws {$protobuf.util.ProtocolError} If required fields are missing\n       */\n      Hypothesis.decode = function decode(reader, length) {\n        if (!(reader instanceof $Reader)) reader = $Reader.create(reader);\n        var end = length === undefined ? reader.len : reader.pos + length,\n          message = new $root.Hypothesis();\n        while (reader.pos < end) {\n          var tag = reader.uint32();\n          switch (tag >>> 3) {\n            case 1:\n              {\n                message.words = reader.string();\n                break;\n              }\n            case 2:\n              {\n                message.acousticCost = reader.float();\n                break;\n              }\n            case 3:\n              {\n                message.linguisticCost = reader.float();\n                break;\n              }\n            case 4:\n              {\n                message.finalCost = reader.float();\n                break;\n              }\n            case 5:\n              {\n                message.phraseStart = reader.float();\n                break;\n              }\n            case 6:\n              {\n                message.phraseEnd = reader.float();\n                break;\n              }\n            case 7:\n              {\n                message.normalizedText = reader.string();\n                break;\n              }\n            default:\n              reader.skipType(tag & 7);\n              break;\n          }\n        }\n        return message;\n      };\n      return Hypothesis;\n    }();\n    $root.DecoderResult = function () {\n      /**\n       * Properties of a DecoderResult.\n       * @exports IDecoderResult\n       * @interface IDecoderResult\n       * @property {Array.<IHypothesis>|null} [hypothesis] DecoderResult hypothesis\n       * @property {number|null} [chunkStart] DecoderResult chunkStart\n       * @property {number|null} [chunkEnd] DecoderResult chunkEnd\n       * @property {number|null} [timeEndpointDetectionMs] DecoderResult timeEndpointDetectionMs\n       * @property {number|null} [timeDecodingMs] DecoderResult timeDecodingMs\n       * @property {IVariables|null} [variables] DecoderResult variables\n       * @property {boolean|null} [isFinal] DecoderResult isFinal\n       * @property {Array.<IEmotionResult>|null} [emotionResult] DecoderResult emotionResult\n       * @property {Array.<DecoderResult.IContextAnswer>|null} [contextAnswer] DecoderResult contextAnswer\n       */\n\n      /**\n       * Constructs a new DecoderResult.\n       * @exports DecoderResult\n       * @classdesc Represents a DecoderResult.\n       * @implements IDecoderResult\n       * @constructor\n       * @param {IDecoderResult=} [properties] Properties to set\n       */\n      function DecoderResult(properties) {\n        this.hypothesis = [];\n        this.emotionResult = [];\n        this.contextAnswer = [];\n        if (properties) for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i) if (properties[keys[i]] != null) this[keys[i]] = properties[keys[i]];\n      }\n\n      /**\n       * DecoderResult hypothesis.\n       * @member {Array.<IHypothesis>} hypothesis\n       * @memberof DecoderResult\n       * @instance\n       */\n      DecoderResult.prototype.hypothesis = $util.emptyArray;\n\n      /**\n       * DecoderResult chunkStart.\n       * @member {number} chunkStart\n       * @memberof DecoderResult\n       * @instance\n       */\n      DecoderResult.prototype.chunkStart = 0;\n\n      /**\n       * DecoderResult chunkEnd.\n       * @member {number} chunkEnd\n       * @memberof DecoderResult\n       * @instance\n       */\n      DecoderResult.prototype.chunkEnd = 0;\n\n      /**\n       * DecoderResult timeEndpointDetectionMs.\n       * @member {number} timeEndpointDetectionMs\n       * @memberof DecoderResult\n       * @instance\n       */\n      DecoderResult.prototype.timeEndpointDetectionMs = 0;\n\n      /**\n       * DecoderResult timeDecodingMs.\n       * @member {number} timeDecodingMs\n       * @memberof DecoderResult\n       * @instance\n       */\n      DecoderResult.prototype.timeDecodingMs = 0;\n\n      /**\n       * DecoderResult variables.\n       * @member {IVariables|null|undefined} variables\n       * @memberof DecoderResult\n       * @instance\n       */\n      DecoderResult.prototype.variables = null;\n\n      /**\n       * DecoderResult isFinal.\n       * @member {boolean} isFinal\n       * @memberof DecoderResult\n       * @instance\n       */\n      DecoderResult.prototype.isFinal = false;\n\n      /**\n       * DecoderResult emotionResult.\n       * @member {Array.<IEmotionResult>} emotionResult\n       * @memberof DecoderResult\n       * @instance\n       */\n      DecoderResult.prototype.emotionResult = $util.emptyArray;\n\n      /**\n       * DecoderResult contextAnswer.\n       * @member {Array.<DecoderResult.IContextAnswer>} contextAnswer\n       * @memberof DecoderResult\n       * @instance\n       */\n      DecoderResult.prototype.contextAnswer = $util.emptyArray;\n\n      /**\n       * Decodes a DecoderResult message from the specified reader or buffer.\n       * @function decode\n       * @memberof DecoderResult\n       * @static\n       * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n       * @param {number} [length] Message length if known beforehand\n       * @returns {DecoderResult} DecoderResult\n       * @throws {Error} If the payload is not a reader or valid buffer\n       * @throws {$protobuf.util.ProtocolError} If required fields are missing\n       */\n      DecoderResult.decode = function decode(reader, length) {\n        if (!(reader instanceof $Reader)) reader = $Reader.create(reader);\n        var end = length === undefined ? reader.len : reader.pos + length,\n          message = new $root.DecoderResult();\n        while (reader.pos < end) {\n          var tag = reader.uint32();\n          switch (tag >>> 3) {\n            case 1:\n              {\n                if (!(message.hypothesis && message.hypothesis.length)) message.hypothesis = [];\n                message.hypothesis.push($root.Hypothesis.decode(reader, reader.uint32()));\n                break;\n              }\n            case 2:\n              {\n                message.chunkStart = reader.float();\n                break;\n              }\n            case 3:\n              {\n                message.chunkEnd = reader.float();\n                break;\n              }\n            case 4:\n              {\n                message.timeEndpointDetectionMs = reader.float();\n                break;\n              }\n            case 5:\n              {\n                message.timeDecodingMs = reader.float();\n                break;\n              }\n            case 6:\n              {\n                message.variables = $root.Variables.decode(reader, reader.uint32());\n                break;\n              }\n            case 7:\n              {\n                message.isFinal = reader.bool();\n                break;\n              }\n            case 8:\n              {\n                if (!(message.emotionResult && message.emotionResult.length)) message.emotionResult = [];\n                message.emotionResult.push($root.EmotionResult.decode(reader, reader.uint32()));\n                break;\n              }\n            case 9:\n              {\n                if (!(message.contextAnswer && message.contextAnswer.length)) message.contextAnswer = [];\n                message.contextAnswer.push($root.DecoderResult.ContextAnswer.decode(reader, reader.uint32()));\n                break;\n              }\n            default:\n              reader.skipType(tag & 7);\n              break;\n          }\n        }\n        return message;\n      };\n      DecoderResult.ContextAnswer = function () {\n        /**\n         * Properties of a ContextAnswer.\n         * @memberof DecoderResult\n         * @interface IContextAnswer\n         * @property {Array.<DecoderResult.ContextAnswer.IContextRef>|null} [contextResult] ContextAnswer contextResult\n         */\n\n        /**\n         * Constructs a new ContextAnswer.\n         * @memberof DecoderResult\n         * @classdesc Represents a ContextAnswer.\n         * @implements IContextAnswer\n         * @constructor\n         * @param {DecoderResult.IContextAnswer=} [properties] Properties to set\n         */\n        function ContextAnswer(properties) {\n          this.contextResult = [];\n          if (properties) for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i) if (properties[keys[i]] != null) this[keys[i]] = properties[keys[i]];\n        }\n\n        /**\n         * ContextAnswer contextResult.\n         * @member {Array.<DecoderResult.ContextAnswer.IContextRef>} contextResult\n         * @memberof DecoderResult.ContextAnswer\n         * @instance\n         */\n        ContextAnswer.prototype.contextResult = $util.emptyArray;\n\n        /**\n         * Decodes a ContextAnswer message from the specified reader or buffer.\n         * @function decode\n         * @memberof DecoderResult.ContextAnswer\n         * @static\n         * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n         * @param {number} [length] Message length if known beforehand\n         * @returns {DecoderResult.ContextAnswer} ContextAnswer\n         * @throws {Error} If the payload is not a reader or valid buffer\n         * @throws {$protobuf.util.ProtocolError} If required fields are missing\n         */\n        ContextAnswer.decode = function decode(reader, length) {\n          if (!(reader instanceof $Reader)) reader = $Reader.create(reader);\n          var end = length === undefined ? reader.len : reader.pos + length,\n            message = new $root.DecoderResult.ContextAnswer();\n          while (reader.pos < end) {\n            var tag = reader.uint32();\n            switch (tag >>> 3) {\n              case 1:\n                {\n                  if (!(message.contextResult && message.contextResult.length)) message.contextResult = [];\n                  message.contextResult.push($root.DecoderResult.ContextAnswer.ContextRef.decode(reader, reader.uint32()));\n                  break;\n                }\n              default:\n                reader.skipType(tag & 7);\n                break;\n            }\n          }\n          return message;\n        };\n        ContextAnswer.ContextRef = function () {\n          /**\n           * Properties of a ContextRef.\n           * @memberof DecoderResult.ContextAnswer\n           * @interface IContextRef\n           * @property {string|null} [id] ContextRef id\n           * @property {number|null} [index] ContextRef index\n           * @property {string|null} [originalValue] ContextRef originalValue\n           * @property {string|null} [predictedValue] ContextRef predictedValue\n           * @property {number|null} [score] ContextRef score\n           */\n\n          /**\n           * Constructs a new ContextRef.\n           * @memberof DecoderResult.ContextAnswer\n           * @classdesc Represents a ContextRef.\n           * @implements IContextRef\n           * @constructor\n           * @param {DecoderResult.ContextAnswer.IContextRef=} [properties] Properties to set\n           */\n          function ContextRef(properties) {\n            if (properties) for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i) if (properties[keys[i]] != null) this[keys[i]] = properties[keys[i]];\n          }\n\n          /**\n           * ContextRef id.\n           * @member {string} id\n           * @memberof DecoderResult.ContextAnswer.ContextRef\n           * @instance\n           */\n          ContextRef.prototype.id = \"\";\n\n          /**\n           * ContextRef index.\n           * @member {number} index\n           * @memberof DecoderResult.ContextAnswer.ContextRef\n           * @instance\n           */\n          ContextRef.prototype.index = 0;\n\n          /**\n           * ContextRef originalValue.\n           * @member {string} originalValue\n           * @memberof DecoderResult.ContextAnswer.ContextRef\n           * @instance\n           */\n          ContextRef.prototype.originalValue = \"\";\n\n          /**\n           * ContextRef predictedValue.\n           * @member {string} predictedValue\n           * @memberof DecoderResult.ContextAnswer.ContextRef\n           * @instance\n           */\n          ContextRef.prototype.predictedValue = \"\";\n\n          /**\n           * ContextRef score.\n           * @member {number} score\n           * @memberof DecoderResult.ContextAnswer.ContextRef\n           * @instance\n           */\n          ContextRef.prototype.score = 0;\n\n          /**\n           * Decodes a ContextRef message from the specified reader or buffer.\n           * @function decode\n           * @memberof DecoderResult.ContextAnswer.ContextRef\n           * @static\n           * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n           * @param {number} [length] Message length if known beforehand\n           * @returns {DecoderResult.ContextAnswer.ContextRef} ContextRef\n           * @throws {Error} If the payload is not a reader or valid buffer\n           * @throws {$protobuf.util.ProtocolError} If required fields are missing\n           */\n          ContextRef.decode = function decode(reader, length) {\n            if (!(reader instanceof $Reader)) reader = $Reader.create(reader);\n            var end = length === undefined ? reader.len : reader.pos + length,\n              message = new $root.DecoderResult.ContextAnswer.ContextRef();\n            while (reader.pos < end) {\n              var tag = reader.uint32();\n              switch (tag >>> 3) {\n                case 1:\n                  {\n                    message.id = reader.string();\n                    break;\n                  }\n                case 2:\n                  {\n                    message.index = reader.int32();\n                    break;\n                  }\n                case 3:\n                  {\n                    message.originalValue = reader.string();\n                    break;\n                  }\n                case 4:\n                  {\n                    message.predictedValue = reader.string();\n                    break;\n                  }\n                case 5:\n                  {\n                    message.score = reader.float();\n                    break;\n                  }\n                default:\n                  reader.skipType(tag & 7);\n                  break;\n              }\n            }\n            return message;\n          };\n          return ContextRef;\n        }();\n        return ContextAnswer;\n      }();\n      return DecoderResult;\n    }();\n    $root.ErrorResponse = function () {\n      /**\n       * Properties of an ErrorResponse.\n       * @exports IErrorResponse\n       * @interface IErrorResponse\n       * @property {string|null} [errorMessage] ErrorResponse errorMessage\n       */\n\n      /**\n       * Constructs a new ErrorResponse.\n       * @exports ErrorResponse\n       * @classdesc Represents an ErrorResponse.\n       * @implements IErrorResponse\n       * @constructor\n       * @param {IErrorResponse=} [properties] Properties to set\n       */\n      function ErrorResponse(properties) {\n        if (properties) for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i) if (properties[keys[i]] != null) this[keys[i]] = properties[keys[i]];\n      }\n\n      /**\n       * ErrorResponse errorMessage.\n       * @member {string} errorMessage\n       * @memberof ErrorResponse\n       * @instance\n       */\n      ErrorResponse.prototype.errorMessage = \"\";\n\n      /**\n       * Decodes an ErrorResponse message from the specified reader or buffer.\n       * @function decode\n       * @memberof ErrorResponse\n       * @static\n       * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n       * @param {number} [length] Message length if known beforehand\n       * @returns {ErrorResponse} ErrorResponse\n       * @throws {Error} If the payload is not a reader or valid buffer\n       * @throws {$protobuf.util.ProtocolError} If required fields are missing\n       */\n      ErrorResponse.decode = function decode(reader, length) {\n        if (!(reader instanceof $Reader)) reader = $Reader.create(reader);\n        var end = length === undefined ? reader.len : reader.pos + length,\n          message = new $root.ErrorResponse();\n        while (reader.pos < end) {\n          var tag = reader.uint32();\n          switch (tag >>> 3) {\n            case 1:\n              {\n                message.errorMessage = reader.string();\n                break;\n              }\n            default:\n              reader.skipType(tag & 7);\n              break;\n          }\n        }\n        return message;\n      };\n      return ErrorResponse;\n    }();\n    $root.PacketWrapperFromServer = function () {\n      /**\n       * Properties of a PacketWrapperFromServer.\n       * @exports IPacketWrapperFromServer\n       * @interface IPacketWrapperFromServer\n       * @property {IUndecodedSeconds|null} [undecodedSecondsField] PacketWrapperFromServer undecodedSecondsField\n       * @property {IFullyFinalized|null} [fullyFinalizedField] PacketWrapperFromServer fullyFinalizedField\n       * @property {IDecoderResult|null} [decoderResultField] PacketWrapperFromServer decoderResultField\n       * @property {IErrorResponse|null} [errorResponse] PacketWrapperFromServer errorResponse\n       */\n\n      /**\n       * Constructs a new PacketWrapperFromServer.\n       * @exports PacketWrapperFromServer\n       * @classdesc Represents a PacketWrapperFromServer.\n       * @implements IPacketWrapperFromServer\n       * @constructor\n       * @param {IPacketWrapperFromServer=} [properties] Properties to set\n       */\n      function PacketWrapperFromServer(properties) {\n        if (properties) for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i) if (properties[keys[i]] != null) this[keys[i]] = properties[keys[i]];\n      }\n\n      /**\n       * PacketWrapperFromServer undecodedSecondsField.\n       * @member {IUndecodedSeconds|null|undefined} undecodedSecondsField\n       * @memberof PacketWrapperFromServer\n       * @instance\n       */\n      PacketWrapperFromServer.prototype.undecodedSecondsField = null;\n\n      /**\n       * PacketWrapperFromServer fullyFinalizedField.\n       * @member {IFullyFinalized|null|undefined} fullyFinalizedField\n       * @memberof PacketWrapperFromServer\n       * @instance\n       */\n      PacketWrapperFromServer.prototype.fullyFinalizedField = null;\n\n      /**\n       * PacketWrapperFromServer decoderResultField.\n       * @member {IDecoderResult|null|undefined} decoderResultField\n       * @memberof PacketWrapperFromServer\n       * @instance\n       */\n      PacketWrapperFromServer.prototype.decoderResultField = null;\n\n      /**\n       * PacketWrapperFromServer errorResponse.\n       * @member {IErrorResponse|null|undefined} errorResponse\n       * @memberof PacketWrapperFromServer\n       * @instance\n       */\n      PacketWrapperFromServer.prototype.errorResponse = null;\n\n      // OneOf field names bound to virtual getters and setters\n      var $oneOfFields;\n\n      /**\n       * PacketWrapperFromServer MessageType.\n       * @member {\"undecodedSecondsField\"|\"fullyFinalizedField\"|\"decoderResultField\"|\"errorResponse\"|undefined} MessageType\n       * @memberof PacketWrapperFromServer\n       * @instance\n       */\n      Object.defineProperty(PacketWrapperFromServer.prototype, \"MessageType\", {\n        get: $util.oneOfGetter($oneOfFields = [\"undecodedSecondsField\", \"fullyFinalizedField\", \"decoderResultField\", \"errorResponse\"]),\n        set: $util.oneOfSetter($oneOfFields)\n      });\n\n      /**\n       * Decodes a PacketWrapperFromServer message from the specified reader or buffer.\n       * @function decode\n       * @memberof PacketWrapperFromServer\n       * @static\n       * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n       * @param {number} [length] Message length if known beforehand\n       * @returns {PacketWrapperFromServer} PacketWrapperFromServer\n       * @throws {Error} If the payload is not a reader or valid buffer\n       * @throws {$protobuf.util.ProtocolError} If required fields are missing\n       */\n      PacketWrapperFromServer.decode = function decode(reader, length) {\n        if (!(reader instanceof $Reader)) reader = $Reader.create(reader);\n        var end = length === undefined ? reader.len : reader.pos + length,\n          message = new $root.PacketWrapperFromServer();\n        while (reader.pos < end) {\n          var tag = reader.uint32();\n          switch (tag >>> 3) {\n            case 1:\n              {\n                message.undecodedSecondsField = $root.UndecodedSeconds.decode(reader, reader.uint32());\n                break;\n              }\n            case 2:\n              {\n                message.fullyFinalizedField = $root.FullyFinalized.decode(reader, reader.uint32());\n                break;\n              }\n            case 4:\n              {\n                message.decoderResultField = $root.DecoderResult.decode(reader, reader.uint32());\n                break;\n              }\n            case 8:\n              {\n                message.errorResponse = $root.ErrorResponse.decode(reader, reader.uint32());\n                break;\n              }\n            default:\n              reader.skipType(tag & 7);\n              break;\n          }\n        }\n        return message;\n      };\n      return PacketWrapperFromServer;\n    }();\n    return $root;\n  });\n})(asr);\nvar asrExports = asr.exports;\nvar mtt = {\n  exports: {}\n};\n\n/*eslint-disable block-scoped-var, id-length, no-control-regex, no-magic-numbers, no-prototype-builtins, no-redeclare, no-shadow, no-var, sort-vars*/\n\n(function (module) {\n  (function (global, factory) {\n    /* global define, require, module */\n\n    /* AMD */if (typeof commonjsRequire === 'function' && 'object' === 'object' && module && module.exports) module.exports = factory(requireMinimal());\n  })(commonjsGlobal, function ($protobuf) {\n    // Common aliases\n    var $Reader = $protobuf.Reader,\n      $util = $protobuf.util;\n\n    // Exported root namespace\n    var $root = $protobuf.roots[\"default\"] || ($protobuf.roots[\"default\"] = {});\n    $root.Music2TrackProtocol = function () {\n      /**\n       * Namespace Music2TrackProtocol.\n       * @exports Music2TrackProtocol\n       * @namespace\n       */\n      var Music2TrackProtocol = {};\n      Music2TrackProtocol.DecoderResult = function () {\n        /**\n         * Properties of a DecoderResult.\n         * @memberof Music2TrackProtocol\n         * @interface IDecoderResult\n         * @property {string|null} [result] DecoderResult result\n         * @property {boolean|null} [isMusicFound] DecoderResult isMusicFound\n         * @property {boolean|null} [isFinal] DecoderResult isFinal\n         */\n\n        /**\n         * Constructs a new DecoderResult.\n         * @memberof Music2TrackProtocol\n         * @classdesc Represents a DecoderResult.\n         * @implements IDecoderResult\n         * @constructor\n         * @param {Music2TrackProtocol.IDecoderResult=} [properties] Properties to set\n         */\n        function DecoderResult(properties) {\n          if (properties) for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i) if (properties[keys[i]] != null) this[keys[i]] = properties[keys[i]];\n        }\n\n        /**\n         * DecoderResult result.\n         * @member {string} result\n         * @memberof Music2TrackProtocol.DecoderResult\n         * @instance\n         */\n        DecoderResult.prototype.result = \"\";\n\n        /**\n         * DecoderResult isMusicFound.\n         * @member {boolean} isMusicFound\n         * @memberof Music2TrackProtocol.DecoderResult\n         * @instance\n         */\n        DecoderResult.prototype.isMusicFound = false;\n\n        /**\n         * DecoderResult isFinal.\n         * @member {boolean} isFinal\n         * @memberof Music2TrackProtocol.DecoderResult\n         * @instance\n         */\n        DecoderResult.prototype.isFinal = false;\n\n        /**\n         * Decodes a DecoderResult message from the specified reader or buffer.\n         * @function decode\n         * @memberof Music2TrackProtocol.DecoderResult\n         * @static\n         * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n         * @param {number} [length] Message length if known beforehand\n         * @returns {Music2TrackProtocol.DecoderResult} DecoderResult\n         * @throws {Error} If the payload is not a reader or valid buffer\n         * @throws {$protobuf.util.ProtocolError} If required fields are missing\n         */\n        DecoderResult.decode = function decode(reader, length) {\n          if (!(reader instanceof $Reader)) reader = $Reader.create(reader);\n          var end = length === undefined ? reader.len : reader.pos + length,\n            message = new $root.Music2TrackProtocol.DecoderResult();\n          while (reader.pos < end) {\n            var tag = reader.uint32();\n            switch (tag >>> 3) {\n              case 1:\n                {\n                  message.result = reader.string();\n                  break;\n                }\n              case 2:\n                {\n                  message.isMusicFound = reader.bool();\n                  break;\n                }\n              case 3:\n                {\n                  message.isFinal = reader.bool();\n                  break;\n                }\n              default:\n                reader.skipType(tag & 7);\n                break;\n            }\n          }\n          return message;\n        };\n        return DecoderResult;\n      }();\n      Music2TrackProtocol.ErrorResponse = function () {\n        /**\n         * Properties of an ErrorResponse.\n         * @memberof Music2TrackProtocol\n         * @interface IErrorResponse\n         * @property {string|null} [errorMessage] ErrorResponse errorMessage\n         * @property {number|null} [errorCode] ErrorResponse errorCode\n         */\n\n        /**\n         * Constructs a new ErrorResponse.\n         * @memberof Music2TrackProtocol\n         * @classdesc Represents an ErrorResponse.\n         * @implements IErrorResponse\n         * @constructor\n         * @param {Music2TrackProtocol.IErrorResponse=} [properties] Properties to set\n         */\n        function ErrorResponse(properties) {\n          if (properties) for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i) if (properties[keys[i]] != null) this[keys[i]] = properties[keys[i]];\n        }\n\n        /**\n         * ErrorResponse errorMessage.\n         * @member {string} errorMessage\n         * @memberof Music2TrackProtocol.ErrorResponse\n         * @instance\n         */\n        ErrorResponse.prototype.errorMessage = \"\";\n\n        /**\n         * ErrorResponse errorCode.\n         * @member {number} errorCode\n         * @memberof Music2TrackProtocol.ErrorResponse\n         * @instance\n         */\n        ErrorResponse.prototype.errorCode = 0;\n\n        /**\n         * Decodes an ErrorResponse message from the specified reader or buffer.\n         * @function decode\n         * @memberof Music2TrackProtocol.ErrorResponse\n         * @static\n         * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n         * @param {number} [length] Message length if known beforehand\n         * @returns {Music2TrackProtocol.ErrorResponse} ErrorResponse\n         * @throws {Error} If the payload is not a reader or valid buffer\n         * @throws {$protobuf.util.ProtocolError} If required fields are missing\n         */\n        ErrorResponse.decode = function decode(reader, length) {\n          if (!(reader instanceof $Reader)) reader = $Reader.create(reader);\n          var end = length === undefined ? reader.len : reader.pos + length,\n            message = new $root.Music2TrackProtocol.ErrorResponse();\n          while (reader.pos < end) {\n            var tag = reader.uint32();\n            switch (tag >>> 3) {\n              case 1:\n                {\n                  message.errorMessage = reader.string();\n                  break;\n                }\n              case 2:\n                {\n                  message.errorCode = reader.int32();\n                  break;\n                }\n              default:\n                reader.skipType(tag & 7);\n                break;\n            }\n          }\n          return message;\n        };\n        return ErrorResponse;\n      }();\n      Music2TrackProtocol.MttResponse = function () {\n        /**\n         * Properties of a MttResponse.\n         * @memberof Music2TrackProtocol\n         * @interface IMttResponse\n         * @property {Music2TrackProtocol.IDecoderResult|null} [decoderResultField] MttResponse decoderResultField\n         * @property {Music2TrackProtocol.IErrorResponse|null} [errorResponse] MttResponse errorResponse\n         */\n\n        /**\n         * Constructs a new MttResponse.\n         * @memberof Music2TrackProtocol\n         * @classdesc Represents a MttResponse.\n         * @implements IMttResponse\n         * @constructor\n         * @param {Music2TrackProtocol.IMttResponse=} [properties] Properties to set\n         */\n        function MttResponse(properties) {\n          if (properties) for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i) if (properties[keys[i]] != null) this[keys[i]] = properties[keys[i]];\n        }\n\n        /**\n         * MttResponse decoderResultField.\n         * @member {Music2TrackProtocol.IDecoderResult|null|undefined} decoderResultField\n         * @memberof Music2TrackProtocol.MttResponse\n         * @instance\n         */\n        MttResponse.prototype.decoderResultField = null;\n\n        /**\n         * MttResponse errorResponse.\n         * @member {Music2TrackProtocol.IErrorResponse|null|undefined} errorResponse\n         * @memberof Music2TrackProtocol.MttResponse\n         * @instance\n         */\n        MttResponse.prototype.errorResponse = null;\n\n        // OneOf field names bound to virtual getters and setters\n        var $oneOfFields;\n\n        /**\n         * MttResponse MessageType.\n         * @member {\"decoderResultField\"|\"errorResponse\"|undefined} MessageType\n         * @memberof Music2TrackProtocol.MttResponse\n         * @instance\n         */\n        Object.defineProperty(MttResponse.prototype, \"MessageType\", {\n          get: $util.oneOfGetter($oneOfFields = [\"decoderResultField\", \"errorResponse\"]),\n          set: $util.oneOfSetter($oneOfFields)\n        });\n\n        /**\n         * Decodes a MttResponse message from the specified reader or buffer.\n         * @function decode\n         * @memberof Music2TrackProtocol.MttResponse\n         * @static\n         * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n         * @param {number} [length] Message length if known beforehand\n         * @returns {Music2TrackProtocol.MttResponse} MttResponse\n         * @throws {Error} If the payload is not a reader or valid buffer\n         * @throws {$protobuf.util.ProtocolError} If required fields are missing\n         */\n        MttResponse.decode = function decode(reader, length) {\n          if (!(reader instanceof $Reader)) reader = $Reader.create(reader);\n          var end = length === undefined ? reader.len : reader.pos + length,\n            message = new $root.Music2TrackProtocol.MttResponse();\n          while (reader.pos < end) {\n            var tag = reader.uint32();\n            switch (tag >>> 3) {\n              case 1:\n                {\n                  message.decoderResultField = $root.Music2TrackProtocol.DecoderResult.decode(reader, reader.uint32());\n                  break;\n                }\n              case 2:\n                {\n                  message.errorResponse = $root.Music2TrackProtocol.ErrorResponse.decode(reader, reader.uint32());\n                  break;\n                }\n              default:\n                reader.skipType(tag & 7);\n                break;\n            }\n          }\n          return message;\n        };\n        return MttResponse;\n      }();\n      return Music2TrackProtocol;\n    }();\n    return $root;\n  });\n})(mtt);\nvar mttExports = mtt.exports;\nvar createClient = function (protocol, provideMeta, _a) {\n  if (provideMeta === void 0) {\n    provideMeta = undefined;\n  }\n  var getVoiceMeta = _a.getVoiceMeta;\n  var _b = createNanoEvents(),\n    on = _b.on,\n    emit = _b.emit;\n  /** ждет ответ бека и возвращает данные из этого ответа */\n  var waitForAnswer = function (messageId) {\n    return new Promise(function (resolve) {\n      var off = on('systemMessage', function (systemMessageData, originalMessage) {\n        if (originalMessage.messageId === messageId && (originalMessage.messageName === MessageNames.ANSWER_TO_USER || originalMessage.messageName === MessageNames.DO_NOTHING)) {\n          off();\n          resolve(systemMessageData);\n        }\n      });\n    });\n  };\n  /** отправляет произвольный systemMessage, не подкладывает мету */\n  var sendData = function (data, messageName, meta) {\n    if (messageName === void 0) {\n      messageName = '';\n    }\n    var messageId = protocol.getMessageId();\n    protocol.sendSystemMessage({\n      data: data,\n      messageName: messageName\n    }, true, messageId, {\n      meta: meta || {}\n    });\n    return messageId;\n  };\n  /** отправляет cancel на сообщение */\n  var sendCancel = function (messageId) {\n    protocol.sendCancel({}, true, messageId);\n  };\n  /** отправляет приветствие */\n  var sendOpenAssistant = function (_a) {\n    var _b = _a === void 0 ? {\n        isFirstSession: false\n      } : _a,\n      isFirstSession = _b.isFirstSession;\n    return __awaiter(void 0, void 0, void 0, function () {\n      var data, meta, _c;\n      return __generator(this, function (_d) {\n        switch (_d.label) {\n          case 0:\n            data = isFirstSession ? {\n              is_first_session: true\n            } : {};\n            if (!provideMeta) return [3 /*break*/, 2];\n            return [4 /*yield*/, provideMeta()];\n          case 1:\n            _c = _d.sent();\n            return [3 /*break*/, 3];\n          case 2:\n            _c = undefined;\n            _d.label = 3;\n          case 3:\n            meta = _c;\n            return [2 /*return*/, waitForAnswer(sendData(data, 'OPEN_ASSISTANT', meta))];\n        }\n      });\n    });\n  };\n  /** вызывает sendSystemMessage, куда подкладывает мету */\n  var sendMeta = function (sendSystemMessage, additionalMeta) {\n    return __awaiter(void 0, void 0, void 0, function () {\n      var meta, _a;\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            if (!provideMeta) return [3 /*break*/, 2];\n            return [4 /*yield*/, provideMeta(additionalMeta)];\n          case 1:\n            _a = _b.sent();\n            return [3 /*break*/, 3];\n          case 2:\n            _a = {};\n            _b.label = 3;\n          case 3:\n            meta = _a;\n            if (typeof meta !== 'undefined') {\n              sendSystemMessage({\n                data: {},\n                messageName: ''\n              }, false, {\n                meta: meta\n              });\n            }\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n  /** перестать слать озвучку для messageId */\n  var sendMute = function (messageId) {\n    protocol.sendMute({}, true, messageId);\n  };\n  /** отправляет server_action и мету */\n  var sendServerAction = function (serverAction, appInfo, messageName, mode) {\n    if (messageName === void 0) {\n      messageName = 'SERVER_ACTION';\n    }\n    return __awaiter(void 0, void 0, void 0, function () {\n      var messageId;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            messageId = protocol.getMessageId();\n            // мету и server_action отправляем в одном systemMessage\n            return [4 /*yield*/, sendMeta(function (data, _, _a) {\n              var _b = _a === void 0 ? {} : _a,\n                meta = _b.meta;\n              var systemData = __rest(data, []);\n              protocol.sendSystemMessage({\n                // eslint-disable-next-line camelcase\n                data: __assign(__assign({}, systemData), {\n                  app_info: appInfo,\n                  server_action: serverAction,\n                  mode: mode\n                }),\n                messageName: messageName || 'SERVER_ACTION'\n              }, true, messageId, {\n                meta: meta\n              });\n            }, {\n              source: {\n                sourceType: 'vps'\n              }\n            })];\n          case 1:\n            // мету и server_action отправляем в одном systemMessage\n            _a.sent();\n            return [2 /*return*/, messageId];\n        }\n      });\n    });\n  };\n  /** отправляет текст и текущую мету */\n  var sendText = function (text, isSsml, shouldSendDisableDubbing, additionalMeta) {\n    if (isSsml === void 0) {\n      isSsml = false;\n    }\n    return __awaiter(void 0, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        if (text.trim() === '') {\n          return [2 /*return*/, undefined];\n        }\n        return [2 /*return*/, protocol.batch(function (_a) {\n          var sendSystemMessage = _a.sendSystemMessage,\n            clientSendText = _a.sendText,\n            sendSettings = _a.sendSettings,\n            messageId = _a.messageId;\n          return __awaiter(void 0, void 0, void 0, function () {\n            var prevDubbing, sendDisableDubbing, isStillNeedReturnDubbing;\n            return __generator(this, function (_b) {\n              switch (_b.label) {\n                case 0:\n                  return [4 /*yield*/, sendMeta(sendSystemMessage, additionalMeta)];\n                case 1:\n                  _b.sent();\n                  prevDubbing = protocol.configuration.settings.dubbing;\n                  sendDisableDubbing = prevDubbing !== -1 && shouldSendDisableDubbing;\n                  if (!sendDisableDubbing) return [3 /*break*/, 3];\n                  return [4 /*yield*/, sendSettings({\n                    dubbing: -1\n                  }, false)];\n                case 2:\n                  _b.sent();\n                  _b.label = 3;\n                case 3:\n                  isSsml ? clientSendText(text, {}, 'application/ssml') : clientSendText(text, {});\n                  isStillNeedReturnDubbing = prevDubbing === protocol.configuration.settings.dubbing;\n                  if (sendDisableDubbing && isStillNeedReturnDubbing) {\n                    sendSettings({\n                      dubbing: prevDubbing\n                    });\n                  }\n                  return [2 /*return*/, messageId];\n              }\n            });\n          });\n        })];\n      });\n    });\n  };\n  /** инициализирует исходящий голосовой поток, факт. передает в callback параметры для отправки голоса,\n   * отправляет мету */\n  var createVoiceStream = function (callback, additionalMeta) {\n    return protocol.batch(function (_a) {\n      var sendSystemMessage = _a.sendSystemMessage,\n        sendVoice = _a.sendVoice,\n        messageId = _a.messageId;\n      return __awaiter(void 0, void 0, void 0, function () {\n        var first;\n        return __generator(this, function (_b) {\n          switch (_b.label) {\n            case 0:\n              first = true;\n              return [4 /*yield*/, sendMeta(sendSystemMessage, additionalMeta)];\n            case 1:\n              _b.sent();\n              return [4 /*yield*/, callback({\n                sendVoice: function () {\n                  var args = [];\n                  for (var _i = 0; _i < arguments.length; _i++) {\n                    args[_i] = arguments[_i];\n                  }\n                  if (first) {\n                    // отправляем мету только в первом чанке с голосом\n                    sendVoice(args[0], args[1], args[2], __assign(__assign({}, args[3]), {\n                      meta: getVoiceMeta()\n                    }));\n                    first = false;\n                    return;\n                  }\n                  sendVoice.apply(void 0, args);\n                },\n                messageId: messageId\n              })];\n            case 2:\n              _b.sent();\n              return [2 /*return*/];\n          }\n        });\n      });\n    });\n  };\n  var off = protocol.on('incoming', function (message) {\n    var _a, _b, _c, _d, _e, _f, _g, _h, _j;\n    if ((_a = message.systemMessage) === null || _a === void 0 ? void 0 : _a.data) {\n      emit('systemMessage', JSON.parse(message.systemMessage.data), message);\n    }\n    if (message.voice) {\n      emit('voice', message.voice.data || new Uint8Array(), message);\n    }\n    if (message.status) {\n      emit('status', message.status, message);\n    }\n    if (message.messageName === 'TAKE_HISTORY' && ((_b = message.bytes) === null || _b === void 0 ? void 0 : _b.data)) {\n      var history_1 = protoExports.GetHistoryResponse.decode((_c = message.bytes) === null || _c === void 0 ? void 0 : _c.data).historyMessages;\n      var parsedHistory = history_1.map(function (historyMessage) {\n        return __assign(__assign({}, historyMessage), {\n          content: JSON.parse(historyMessage.content || '')\n        });\n      });\n      emit('history', parsedHistory, message);\n    }\n    if (message.messageName === MessageNames.STT && (message.text || ((_e = (_d = message.bytes) === null || _d === void 0 ? void 0 : _d.data) === null || _e === void 0 ? void 0 : _e.length))) {\n      var response = ((_g = (_f = message.bytes) === null || _f === void 0 ? void 0 : _f.data) === null || _g === void 0 ? void 0 : _g.length) ? asrExports.PacketWrapperFromServer.decode(message.bytes.data) : undefined;\n      emit('stt', {\n        text: message.text,\n        response: response\n      }, message);\n    }\n    if (message.messageName === MessageNames.MTT && ((_j = (_h = message.bytes) === null || _h === void 0 ? void 0 : _h.data) === null || _j === void 0 ? void 0 : _j.length)) {\n      emit('musicRecognition', mttExports.Music2TrackProtocol.MttResponse.decode(message.bytes.data), message);\n    }\n  });\n  return {\n    destroy: function () {\n      off();\n    },\n    init: protocol.init,\n    createVoiceStream: createVoiceStream,\n    sendData: sendData,\n    sendMeta: sendMeta,\n    sendOpenAssistant: sendOpenAssistant,\n    sendServerAction: sendServerAction,\n    sendText: sendText,\n    sendCancel: sendCancel,\n    sendMute: sendMute,\n    on: on,\n    waitForAnswer: waitForAnswer\n  };\n};\nvar RETRY_INTERVAL = 300; // ms\nvar defaultWSCreator = function (url) {\n  return new WebSocket(url);\n};\nvar createTransport = function (_a) {\n  var _b = _a.createWS,\n    createWS = _b === void 0 ? defaultWSCreator : _b,\n    checkCertUrl = _a.checkCertUrl;\n  var _c = createNanoEvents(),\n    on = _c.on,\n    emit = _c.emit;\n  var hasCert = !checkCertUrl;\n  var retryTimeoutId = -1;\n  var retries = 0;\n  var status = 'closed';\n  var webSocket;\n  var stopped = true;\n  var checkCert = function (checkUrl) {\n    return new Promise(function (resolve) {\n      window.fetch(checkUrl).then(function () {\n        return resolve(true);\n      }).catch(function () {\n        return resolve(false);\n      });\n    });\n  };\n  var close = function () {\n    stopped = true;\n    if (status === 'closing' || status === 'closed') {\n      return;\n    }\n    status = 'closing';\n    webSocket === null || webSocket === void 0 ? void 0 : webSocket.close();\n  };\n  var connect = function (url) {\n    return __awaiter(void 0, void 0, void 0, function () {\n      var okay;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            status = 'connecting';\n            emit('connecting');\n            if (!(!hasCert && window.navigator.onLine)) return [3 /*break*/, 2];\n            return [4 /*yield*/, checkCert(checkCertUrl)];\n          case 1:\n            okay = _a.sent();\n            if (!okay) {\n              status = 'closed';\n              emit('close');\n              emit('error', new Error('Cert authority invalid'));\n              return [2 /*return*/];\n            }\n            hasCert = true;\n            _a.label = 2;\n          case 2:\n            webSocket = createWS(url);\n            webSocket.binaryType = 'arraybuffer';\n            webSocket.addEventListener('open', function () {\n              if (webSocket.readyState !== 1) {\n                return;\n              }\n              window.clearTimeout(retryTimeoutId);\n              retries = 0;\n              status = 'open';\n              emit('open');\n            });\n            webSocket.addEventListener('close', function () {\n              status = 'closed';\n              emit('close');\n            });\n            webSocket.addEventListener('error', function (e) {\n              if (status !== 'connecting') {\n                throw e;\n              }\n              // пробуем переподключаться, если возникла ошибка при коннекте\n              if (!webSocket || webSocket.readyState === 3 && !stopped) {\n                window.clearTimeout(retryTimeoutId);\n                if (retries < 2) {\n                  retryTimeoutId = window.setTimeout(function () {\n                    // eslint-disable-next-line @typescript-eslint/no-use-before-define\n                    open(url);\n                    retries++;\n                  }, RETRY_INTERVAL * retries);\n                } else {\n                  retries = 0;\n                  emit('error', e);\n                }\n              }\n            });\n            webSocket.addEventListener('message', function (_a) {\n              var data = _a.data;\n              emit('message', data);\n            });\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n  var open = function (url) {\n    if (status === 'connecting' || status === 'open') {\n      return;\n    }\n    stopped = false;\n    connect(url);\n  };\n  var reconnect = function (url) {\n    if (status === 'closed') {\n      open(url);\n      return;\n    }\n    window.setTimeout(function () {\n      return reconnect(url);\n    });\n    close();\n  };\n  var send = function (data) {\n    if (!window.navigator.onLine) {\n      close();\n      emit('error');\n      throw new Error('The client seems to be offline');\n    }\n    webSocket.send(data);\n  };\n  return {\n    close: close,\n    get isOnline() {\n      return window.navigator.onLine;\n    },\n    on: on,\n    open: open,\n    reconnect: reconnect,\n    send: send\n  };\n};\nvar convertToMetaPermissions = function (permission) {\n  return Object.keys(permission).map(function (key) {\n    return {\n      type: key,\n      status: permission[key]\n    };\n  });\n};\nvar getLocation = function () {\n  return __awaiter(void 0, void 0, void 0, function () {\n    return __generator(this, function (_a) {\n      return [2 /*return*/, new Promise(function (resolve, reject) {\n        navigator.geolocation.getCurrentPosition(function (_a) {\n          var coords = _a.coords,\n            timestamp = _a.timestamp;\n          resolve({\n            lat: coords.latitude,\n            lon: coords.longitude,\n            accuracy: coords.accuracy,\n            timestamp: timestamp\n          });\n        }, reject, {\n          timeout: 5000\n        });\n      })];\n    });\n  });\n};\nvar getTime = function () {\n  return {\n    // Здесь нужен полифилл, т.к. `Intl.DateTimeFormat().resolvedOptions().timeZone` - возвращает пустую строку\n    timezone_id: Intl.DateTimeFormat().resolvedOptions().timeZone,\n    timezone_offset_sec: -new Date().getTimezoneOffset() * 60,\n    timestamp: Date.now()\n  };\n};\nvar getAnswerForRequestPermissions = function (requestMessageId, appInfo, items) {\n  return __awaiter(void 0, void 0, void 0, function () {\n    var permissions, response;\n    return __generator(this, function (_a) {\n      permissions = {\n        record_audio: 'denied_once',\n        geo: 'denied_once',\n        read_contacts: 'denied_permanently',\n        push: 'denied_once'\n      };\n      response = {\n        app_info: appInfo,\n        meta: {\n          time: getTime(),\n          permissions: []\n        },\n        server_action: {\n          action_id: 'command_response',\n          request_message_id: requestMessageId,\n          command_response: {\n            request_permissions: {\n              permissions: []\n            }\n          }\n        }\n      };\n      return [2 /*return*/, Promise.all(items.map(function (permission) {\n        return __awaiter(void 0, void 0, void 0, function () {\n          var _a, location_1;\n          var _c, _d, _e;\n          return __generator(this, function (_f) {\n            switch (_f.label) {\n              case 0:\n                _a = permission;\n                switch (_a) {\n                  case 'geo':\n                    return [3 /*break*/, 1];\n                }\n                return [3 /*break*/, 5];\n              case 1:\n                _f.trys.push([1, 3,, 4]);\n                return [4 /*yield*/, getLocation()];\n              case 2:\n                location_1 = _f.sent();\n                permissions.geo = 'granted';\n                response.meta.location = location_1;\n                (_c = response.server_action.command_response.request_permissions) === null || _c === void 0 ? void 0 : _c.permissions.push({\n                  type: 'geo',\n                  status: 'granted'\n                });\n                return [3 /*break*/, 4];\n              case 3:\n                _f.sent();\n                permissions.geo = 'denied_permanently';\n                (_d = response.server_action.command_response.request_permissions) === null || _d === void 0 ? void 0 : _d.permissions.push({\n                  type: 'geo',\n                  status: 'denied_permanently'\n                });\n                return [3 /*break*/, 4];\n              case 4:\n                return [3 /*break*/, 6];\n              case 5:\n                // остальные доступы не поддерживаем\n                (_e = response.server_action.command_response.request_permissions) === null || _e === void 0 ? void 0 : _e.permissions.push({\n                  type: permission,\n                  status: 'denied_permanently'\n                });\n                return [3 /*break*/, 6];\n              case 6:\n                return [2 /*return*/];\n            }\n          });\n        });\n      })).then(function () {\n        response.meta.permissions = convertToMetaPermissions(permissions);\n        return response;\n      })];\n    });\n  });\n};\nvar IS_APPLE_MOBILE = typeof window !== 'undefined' ? (/iPad|iPhone|iPod/.test(navigator.platform) || navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1) && !window.MSStream : false;\nfunction createSilentAudioFile(sampleRate) {\n  var arrayBuffer = new ArrayBuffer(10);\n  var dataView = new DataView(arrayBuffer);\n  dataView.setUint32(0, sampleRate, true);\n  dataView.setUint32(4, sampleRate, true);\n  dataView.setUint16(8, 1, true);\n  var missingCharacters = window.btoa(String.fromCharCode.apply(null, new Uint8Array(arrayBuffer))).slice(0, 13);\n  return \"data:audio/wav;base64,UklGRisAAABXQVZFZm10IBAAAAABAAEA\" + missingCharacters + \"AgAZGF0YQcAAACAgICAgICAAAA=\";\n}\n/**\n * Создает объект, который позволяет воспроизводить аудио с активным silent mode.\n * Перед использование нужно вызвать initialize()\n * Создает <audio> и воспроизводит тишину, управляется turnOn/turnOff.\n * @returns object\n */\nvar createIosSilentModePatch = function () {\n  var audio = null;\n  var destroy = function () {\n    if (audio === null) {\n      return;\n    }\n    audio.src = 'about:blank';\n    audio.load();\n    audio = null;\n  };\n  /**\n   * Инициализирует патч,\n   * вызывать по событию взаимодействия пользователя со страницей (click)\n   */\n  var initialize = function () {\n    if (!IS_APPLE_MOBILE) {\n      return;\n    }\n    destroy();\n    audio = new Audio();\n    audio.setAttribute('x-webkit-airplay', 'deny');\n    audio.preload = 'auto';\n    audio.loop = true;\n    audio.src = createSilentAudioFile(16000);\n    audio.load();\n  };\n  var turnOff = function () {\n    audio === null || audio === void 0 ? void 0 : audio.pause();\n  };\n  return {\n    destroy: destroy,\n    initialize: initialize,\n    turnOff: turnOff,\n    turnOn: function () {\n      audio === null || audio === void 0 ? void 0 : audio.play().catch(function (e) {\n        console.error('ios audio patch excepted', e);\n      });\n    },\n    get isActive() {\n      return (audio === null || audio === void 0 ? void 0 : audio.paused) === false;\n    }\n  };\n};\nvar iosSilentModePatch = createIosSilentModePatch();\nvar isAudioSupported = typeof window !== 'undefined' && (window.AudioContext || window.webkitAudioContext);\n/**\n * Возвращает новый инстанс AudioContext или ошибку\n * @param options AudioContextOptions\n * @returns AudioContext\n */\nfunction createAudioContext(options) {\n  if (window.AudioContext) {\n    return new AudioContext(options);\n  }\n  if (window.webkitAudioContext) {\n    // eslint-disable-next-line new-cap\n    return new window.webkitAudioContext();\n  }\n  throw new Error('Audio not supported');\n}\nvar _a = createNanoEvents(),\n  on = _a.on,\n  emit = _a.emit;\nvar audioContext;\n/**\n * При помощи вызова функции из аргумента, возвращает, готовый к воспроизведению звука, AudioContext.\n * Всегда возвращает один и тот же AudioContext\n * @param onReady Функция, в аргумент которой будет возвращен AudioContext\n */\nvar resolveAudioContext = function (onReady) {\n  if (!audioContext) {\n    var isSafari_1 = navigator.vendor.search('Apple') >= 0;\n    var context_1 = createAudioContext();\n    audioContext = {\n      context: context_1,\n      ready: !isSafari_1 && context_1.state === 'running',\n      on: on\n    };\n    context_1.onstatechange = function () {\n      if (audioContext.context.state === 'running') {\n        audioContext.ready = true;\n        emit('ready');\n      }\n    };\n    /// Контекст может быть не готов для использования сразу после создания\n    /// Если попробовать что-то воспроизвести в этом контексте - звука не будет\n    if (!audioContext.ready) {\n      var handleClick_1 = function () {\n        document.removeEventListener('click', handleClick_1);\n        iosSilentModePatch.initialize();\n        if (isSafari_1) {\n          /// проигрываем тишину, т.к нужно что-то проиграть,\n          /// чтобы сафари разрешил воспроизводить звуки в любой момент в этом контексте\n          var oscillator = audioContext.context.createOscillator();\n          oscillator.frequency.value = 0;\n          oscillator.connect(audioContext.context.destination);\n          oscillator.start(0);\n          oscillator.stop(0.5);\n        }\n        if (audioContext.context.state === 'suspended') {\n          /// Developers who write games, WebRTC applications, or other websites that use the Web Audio API\n          /// should call context.resume() after the first user gesture (e.g. a click, or tap)\n          /// https://sites.google.com/a/chromium.org/dev/audio-video/autoplay\n          audioContext.context.resume();\n        }\n      };\n      /// чтобы сделать контекст готовым к использованию (воспроизведению звука),\n      /// необходимо событие от пользователя (только не touch)\n      document.addEventListener('click', handleClick_1);\n    }\n  }\n  if (audioContext.ready) {\n    onReady && onReady(audioContext.context, function () {\n      return iosSilentModePatch.destroy();\n    });\n  } else {\n    var unsubscribe_1 = on('ready', function () {\n      onReady(audioContext.context, function () {\n        return iosSilentModePatch.destroy();\n      });\n      unsubscribe_1();\n    });\n  }\n};\n\n/**\n * Понижает sample rate c inSampleRate до значения outSampleRate и преобразует Float32Array в ArrayBuffer\n * @param buffer Аудио\n * @param inSampleRate текущий sample rate\n * @param outSampleRate требуемый sample rate\n * @returns Аудио со значением sample rate = outSampleRate\n */\nvar downsampleBuffer = function (buffer, inSampleRate, outSampleRate) {\n  if (outSampleRate > inSampleRate) {\n    throw new Error('downsampling rate show be smaller than original sample rate');\n  }\n  var sampleRateRatio = inSampleRate / outSampleRate;\n  var newLength = Math.round(buffer.length / sampleRateRatio);\n  var result = new Int16Array(newLength);\n  var offsetResult = 0;\n  var offsetBuffer = 0;\n  while (offsetResult < result.length) {\n    var nextOffsetBuffer = Math.round((offsetResult + 1) * sampleRateRatio);\n    var accum = 0;\n    var count = 0;\n    for (var i = offsetBuffer; i < nextOffsetBuffer && i < buffer.length; i++) {\n      accum += buffer[i];\n      count++;\n    }\n    result[offsetResult] = Math.min(1, accum / count) * 0x7fff;\n    offsetResult++;\n    offsetBuffer = nextOffsetBuffer;\n  }\n  return result.buffer;\n};\nvar TARGET_SAMPLE_RATE = 16000;\nvar IS_FIREFOX = typeof window !== 'undefined' && navigator.userAgent.toLowerCase().indexOf('firefox') > -1;\nvar IS_SAFARI = typeof window !== 'undefined' && /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\nvar context;\nvar processor;\nvar analyser = null;\nvar destination;\n/**\n * Преобразует stream в чанки (кусочки), и передает их в cb,\n * будет это делать, пока не будет вызвана функция остановки\n * @param stream Аудио-поток\n * @param cb callback, куда будут переданы чанки из потока\n * @returns Функция, вызов которой остановит передачу чанков\n */\nvar createAudioRecorder = function (stream, cb, useAnalyser) {\n  return new Promise(function (resolve) {\n    var state = 'inactive';\n    var input;\n    var stop = function () {\n      if (state === 'inactive') {\n        return;\n      }\n      state = 'inactive';\n      stream.getTracks().forEach(function (track) {\n        track.stop();\n      });\n      input.disconnect();\n    };\n    var start = function () {\n      if (state !== 'inactive') {\n        throw new Error(\"Can't start not inactive recorder\");\n      }\n      state = 'recording';\n      if (!context) {\n        context = createAudioContext({\n          // firefox не умеет выравнивать samplerate, будем делать это самостоятельно\n          sampleRate: IS_FIREFOX ? undefined : TARGET_SAMPLE_RATE\n        });\n      }\n      input = context.createMediaStreamSource(stream);\n      if (!processor) {\n        processor = context.createScriptProcessor(2048, 1, 1);\n      }\n      if (!analyser && useAnalyser) {\n        analyser = context.createAnalyser();\n        analyser.fftSize = 1024;\n      }\n      var listener = function (e) {\n        var buffer = e.inputBuffer.getChannelData(0);\n        var data = downsampleBuffer(buffer, context.sampleRate, TARGET_SAMPLE_RATE);\n        var last = state === 'inactive';\n        // отсылаем только чанки где есть звук voiceData > 0, т.к.\n        // в safari первые несколько чанков со звуком пустые\n        if (!IS_SAFARI || new Uint8Array(data).some(function (voiceData) {\n          return voiceData > 0;\n        })) {\n          var analyserArray = null;\n          if (analyser) {\n            analyserArray = new Uint8Array(analyser.frequencyBinCount);\n            analyser === null || analyser === void 0 ? void 0 : analyser.getByteFrequencyData(analyserArray);\n          }\n          cb(data, analyserArray, last);\n          resolve(stop);\n        }\n        if (last) {\n          processor.removeEventListener('audioprocess', listener);\n        }\n      };\n      processor.addEventListener('audioprocess', listener);\n      input.connect(processor);\n      if (analyser) {\n        input.connect(analyser);\n      }\n      if (!destination) {\n        destination = context.createMediaStreamDestination();\n      }\n      processor.connect(destination);\n    };\n    start();\n  });\n};\n/**\n * Запрашивает у браузера доступ к микрофону и резолвит Promise, если разрешение получено.\n * После получения разрешения, чанки с голосом будут передаваться в cb - пока не будет вызвана функция из результата.\n * @param cb Callback, куда будут передаваться чанки с голосом пользователя\n * @returns Promise, который содержит функцию прерывающую слушание\n */\nvar createNavigatorAudioProvider = function (cb, useAnalyser) {\n  return navigator.mediaDevices.getUserMedia({\n    audio: true\n  }).then(function (stream) {\n    return createAudioRecorder(stream, cb, useAnalyser);\n  }).catch(function (err) {\n    if (window.location.protocol === 'http:') {\n      throw new Error('Audio is supported only on a secure connection');\n    }\n    throw err;\n  });\n};\n\n/**\n * Возвращает объект, позволяющий получать запись голоса пользователя и управлять ею.\n * @param createAudioProvider Источник голоса\n * @returns Api для запуска и остановки слушания\n */\nvar createVoiceListener = function (createAudioProvider) {\n  if (createAudioProvider === void 0) {\n    createAudioProvider = createNavigatorAudioProvider;\n  }\n  var _a = createNanoEvents(),\n    emit = _a.emit,\n    on = _a.on;\n  var stopRecord;\n  var status = 'stopped';\n  var cancelableToken = {\n    current: false\n  };\n  var stop = function () {\n    cancelableToken.current = true;\n    cancelableToken = {\n      current: false\n    };\n    status = 'stopped';\n    stopRecord === null || stopRecord === void 0 ? void 0 : stopRecord();\n    emit('status', 'stopped');\n  };\n  var listen = function (handleVoice) {\n    cancelableToken = {\n      current: false\n    };\n    var capturedToken = cancelableToken;\n    status = 'started';\n    emit('status', 'started');\n    return createAudioProvider(function (data, analyser, last) {\n      return handleVoice(new Uint8Array(data), analyser, last);\n    }).then(function (recStop) {\n      stopRecord = recStop;\n    }).then(function () {\n      if (capturedToken.current === true || status === 'stopped') {\n        stopRecord();\n      } else {\n        status = 'listen';\n        emit('status', 'listen');\n      }\n    }).catch(function (err) {\n      status = 'stopped';\n      emit('status', 'stopped');\n      throw err;\n    });\n  };\n  return {\n    listen: listen,\n    stop: stop,\n    on: on,\n    get status() {\n      return status;\n    }\n  };\n};\n\n/** Создает коллекцию треков  */\nvar createTrackCollection = function () {\n  var trackIds;\n  var trackMap;\n  var clear = function () {\n    trackIds = new Array();\n    trackMap = new Map();\n  };\n  var push = function (id, track) {\n    if (trackMap.has(id)) {\n      throw new Error('Track already exists');\n    }\n    trackMap.set(id, track);\n    trackIds.push(id);\n  };\n  var has = function (id) {\n    return trackMap.has(id);\n  };\n  var getById = function (id) {\n    var track = trackMap.get(id);\n    if (track === undefined) {\n      throw new Error('Unknown track id');\n    }\n    return track;\n  };\n  var getByIndex = function (index) {\n    if (index < 0 || index >= trackIds.length) {\n      throw new Error('Index out of bounds');\n    }\n    var track = trackMap.get(trackIds[index]);\n    if (track == null) {\n      throw new Error('Something wrong...');\n    }\n    return track;\n  };\n  var some = function (predicate) {\n    return trackIds.some(function (id) {\n      return predicate(getById(id));\n    });\n  };\n  clear();\n  return {\n    clear: clear,\n    has: has,\n    get: getById,\n    getByIndex: getByIndex,\n    push: push,\n    some: some,\n    get length() {\n      return trackIds.length;\n    }\n  };\n};\n\n/** Создает структуру для хранения загружаемых и воспроизводимых частей трека */\nvar createChunkQueue = function () {\n  var chunks = []; // очередь воспроизведения\n  /** Добавить чанк в очередь воспроизведения */\n  var push = function (chunk) {\n    chunks.push(chunk);\n  };\n  /** Удалить чанк из очереди воспроизведения */\n  var remove = function (chunk) {\n    chunks.splice(chunks.indexOf(chunk), 1);\n  };\n  return {\n    get chunks() {\n      return chunks;\n    },\n    remove: remove,\n    push: push,\n    get length() {\n      return chunks.length;\n    },\n    get ended() {\n      // считаем трек законченным, когда все воспроизведено\n      return chunks.length === 0;\n    }\n  };\n};\nvar HZ_BYTES_COUNT = 2;\nvar from16BitToFloat32 = function (incomingData) {\n  var l = incomingData.length;\n  var outputData = new Float32Array(l);\n  for (var i = 0; i < l; i += 1) {\n    outputData[i] = incomingData[i] / 32768.0;\n  }\n  return outputData;\n};\n/** Возвращает потоковый подгружаемый трек, который умеет себя проигрывать */\nvar createTrackStream = function (ctx, _a) {\n  var _b = _a === void 0 ? {} : _a,\n    _c = _b.sampleRate,\n    sampleRate = _c === void 0 ? 24000 : _c,\n    _d = _b.numberOfChannels,\n    numberOfChannels = _d === void 0 ? 1 : _d,\n    _e = _b.delay,\n    delay = _e === void 0 ? 0 : _e,\n    onPlay = _b.onPlay,\n    onEnd = _b.onEnd,\n    onStop = _b.onStop,\n    trackStatus = _b.trackStatus;\n  // очередь загруженных чанков (кусочков) трека\n  var queue = createChunkQueue();\n  var buffer = new ArrayBuffer(0);\n  var extraByte = null;\n  var status = trackStatus || 'stop';\n  var lastChunkOffset = 0;\n  var startTime = 0;\n  var firstChunk = true;\n  var loaded = false;\n  var end = function () {\n    // останавливаем воспроизведение чанков из очереди воспроизведения\n    queue.chunks.forEach(function (chunk) {\n      chunk.stop();\n    });\n    status = 'end';\n    onEnd && onEnd();\n    startTime = 0;\n    lastChunkOffset = 0;\n  };\n  var stop = function () {\n    onStop === null || onStop === void 0 ? void 0 : onStop();\n    end();\n  };\n  var play = function () {\n    var _a;\n    if (status === 'end') {\n      return;\n    }\n    var isPlaying = status === 'play';\n    if (!isPlaying) {\n      status = 'play';\n      onPlay && onPlay();\n    }\n    // воспроизводим трек, если источник уже проигрывается или поток полностью загрузился или длина загруженного\n    // больше задержки\n    if (isPlaying || loaded || buffer.byteLength / (sampleRate * HZ_BYTES_COUNT) >= delay) {\n      if (buffer.byteLength > 0) {\n        var chunk = getChunkFromBuffer();\n        startTime = queue.length === 0 ? ctx.currentTime : startTime;\n        queue.push(chunk);\n        chunk.start(startTime + lastChunkOffset);\n        lastChunkOffset += ((_a = chunk.buffer) === null || _a === void 0 ? void 0 : _a.duration) || 0;\n      }\n    }\n    if (loaded && queue.ended) {\n      end();\n      return;\n    }\n  };\n  /** Удаляет или добавляет байт для четности */\n  var getExtraBytes = function (data, bytesArraysSizes) {\n    if (extraByte == null && bytesArraysSizes.incomingMessageVoiceDataLength % 2) {\n      extraByte = data[bytesArraysSizes.incomingMessageVoiceDataLength - 1];\n      bytesArraysSizes.incomingMessageVoiceDataLength -= 1;\n      bytesArraysSizes.sourceLen -= 1;\n    } else if (extraByte != null) {\n      bytesArraysSizes.prepend = extraByte;\n      bytesArraysSizes.start = 1;\n      if (bytesArraysSizes.incomingMessageVoiceDataLength % 2) {\n        bytesArraysSizes.incomingMessageVoiceDataLength += 1;\n        extraByte = null;\n      } else {\n        extraByte = data[bytesArraysSizes.incomingMessageVoiceDataLength - 1];\n        bytesArraysSizes.sourceLen -= 1;\n      }\n    }\n  };\n  var createChunk = function (chunk) {\n    var audioBuffer = ctx.createBuffer(numberOfChannels, chunk.length / numberOfChannels, sampleRate);\n    for (var i = 0; i < numberOfChannels; i++) {\n      var channelChunk = new Float32Array(chunk.length / numberOfChannels);\n      var index = 0;\n      for (var j = i; j < chunk.length; j += numberOfChannels) {\n        channelChunk[index++] = chunk[j];\n      }\n      audioBuffer.getChannelData(i).set(channelChunk);\n    }\n    var source = ctx.createBufferSource();\n    source.buffer = audioBuffer;\n    source.connect(ctx.destination);\n    source.onended = function () {\n      queue.remove(source);\n      if (queue.ended && status !== 'end' && loaded) {\n        status = 'end';\n        onEnd && onEnd();\n      }\n    };\n    return source;\n  };\n  /** Получить чанк из буфера */\n  var getChunkFromBuffer = function () {\n    var tmp = buffer;\n    buffer = new ArrayBuffer(0);\n    var data = new Uint8Array(tmp);\n    var bytesArraysSizes = {\n      incomingMessageVoiceDataLength: data.length,\n      sourceLen: data.length,\n      start: 0,\n      prepend: null\n    };\n    // выравние по два байта\n    getExtraBytes(data, bytesArraysSizes);\n    var dataBuffer = new ArrayBuffer(bytesArraysSizes.incomingMessageVoiceDataLength);\n    var bufferUi8 = new Uint8Array(dataBuffer);\n    var bufferI16 = new Int16Array(dataBuffer);\n    bufferUi8.set(data.slice(0, bytesArraysSizes.sourceLen), bytesArraysSizes.start);\n    if (bytesArraysSizes.prepend != null) {\n      bufferUi8[0] = bytesArraysSizes.prepend;\n    }\n    return createChunk(from16BitToFloat32(bufferI16));\n  };\n  /** добавляет чанк в очередь на воспроизведение */\n  var write = function (data) {\n    // 44 байта - заголовок трека\n    var slicePoint = firstChunk ? 44 : 0;\n    firstChunk = false;\n    if (slicePoint >= data.length) {\n      return;\n    }\n    var tmp = new Uint8Array(buffer.byteLength + data.length - slicePoint);\n    tmp.set(new Uint8Array(buffer), 0);\n    tmp.set(slicePoint ? data.slice(slicePoint) : data, buffer.byteLength);\n    buffer = tmp;\n    if (status === 'play') {\n      play();\n    }\n  };\n  return {\n    get loaded() {\n      return loaded;\n    },\n    setLoaded: function () {\n      loaded = true;\n      if (status === 'play') {\n        play();\n      }\n    },\n    write: write,\n    get status() {\n      return status;\n    },\n    play: play,\n    stop: stop\n  };\n};\nvar createVoicePlayer = function (actx, _a) {\n  var _b = _a === void 0 ? {} : _a,\n    _c = _b.startVoiceDelay,\n    startVoiceDelay = _c === void 0 ? 0.2 : _c,\n    sampleRate = _b.sampleRate,\n    numberOfChannels = _b.numberOfChannels;\n  var _d = createNanoEvents(),\n    on = _d.on,\n    emit = _d.emit;\n  var tracks = createTrackCollection();\n  // true - воспроизводим все треки в очереди (новые в том числе), false - скипаем всю очередь (новые в т.ч.)\n  var active = true;\n  // индекс текущего трека в tracks\n  var cursor = 0;\n  var play = function () {\n    if (cursor >= tracks.length) {\n      if (tracks.some(function (track) {\n        return !track.loaded;\n      })) {\n        return;\n      }\n      iosSilentModePatch.turnOff();\n      // очищаем коллекцию, если все треки были воспроизведены\n      cursor = 0;\n      tracks.clear();\n      return;\n    }\n    // хак для silent mode ios\n    if (!iosSilentModePatch.isActive) {\n      iosSilentModePatch.turnOn();\n    }\n    // рекурсивно последовательно включаем треки из очереди\n    var current = tracks.getByIndex(cursor);\n    if (current.status === 'end') {\n      if (cursor < tracks.length) {\n        cursor++;\n        play();\n      }\n    } else {\n      current.play();\n    }\n  };\n  var append = function (data, trackId, last) {\n    if (last === void 0) {\n      last = false;\n    }\n    var current = tracks.has(trackId) ? tracks.get(trackId) : undefined;\n    if (current == null) {\n      /// если trackId нет в коллекции - создаем трек\n      /// по окончании проигрывания - запускаем следующий трек, вызывая play\n      current = createTrackStream(actx, {\n        sampleRate: sampleRate,\n        numberOfChannels: numberOfChannels,\n        delay: startVoiceDelay,\n        onPlay: function () {\n          return emit('play', trackId);\n        },\n        onStop: function () {\n          return emit('stop', trackId);\n        },\n        onEnd: function () {\n          emit('end', trackId);\n          play();\n        },\n        trackStatus: active ? 'stop' : 'end'\n      });\n      tracks.push(trackId, current);\n    }\n    if (current.status !== 'end' && data.length) {\n      current.write(data);\n    }\n    if (last) {\n      // все чанки трека загружены\n      current.setLoaded();\n    }\n    play();\n  };\n  var stop = function () {\n    while (cursor < tracks.length) {\n      var cur = cursor;\n      cursor++;\n      tracks.getByIndex(cur).stop();\n    }\n    iosSilentModePatch.turnOff();\n  };\n  return {\n    append: append,\n    setActive: function (value) {\n      active = value;\n      if (value) {\n        play();\n      } else {\n        stop();\n      }\n    },\n    on: on,\n    stop: stop\n  };\n};\n\n/** Фильтр тишины */\nvar filterEmptyChunks = function (chunksOriginal) {\n  return chunksOriginal.reduce(function (acc, chunkOriginal) {\n    var chunk = chunkOriginal.filter(function (int) {\n      return int;\n    });\n    if (chunk.length) {\n      acc.push(chunk);\n    }\n    return acc;\n  }, []);\n};\nvar createVoice = function (client, settings, emit,\n/// пока onReady не вызван, треки не воспроизводятся\n/// когда случится onReady, очередь треков начнет проигрываться\nonReady) {\n  var useAnalyser = false;\n  var voicePlayer;\n  var listener = createVoiceListener(function (cb) {\n    return createNavigatorAudioProvider(cb, useAnalyser);\n  });\n  var subscriptions = [];\n  var appInfoDict = {};\n  var mesIdQueue = [];\n  /** в процессе инициализации слушания */\n  var isRecognizeInitializing = false;\n  /** проигрывается/не проигрывается озвучка */\n  var isPlaying = false;\n  /** id сообщения, после проигрывания которого, нужно активировать слушание */\n  var autolistenMessageId = null;\n  /** id сообщения со звуком, отправляемое в данный момент */\n  var currentVoiceMessageId = null;\n  /** стримит поток чанков. Если метода нет, то стриминг не идёт */\n  var streaming = null;\n  /** Уничтожает аудио-контекст */\n  var destroyAudioContext = null;\n  /** Останавливает слушание голоса, отправляет cancel. Возвращает true - если слушание было активно */\n  var stopVoice = function (sendCancel) {\n    if (sendCancel === void 0) {\n      sendCancel = true;\n    }\n    autolistenMessageId = null;\n    streaming = null;\n    if (sendCancel && currentVoiceMessageId) {\n      client.sendCancel(currentVoiceMessageId);\n    }\n    currentVoiceMessageId = null;\n    if (listener.status === 'listen') {\n      listener.stop();\n      return true;\n    }\n    return false;\n  };\n  /** Останавливает слушание и воспроизведение */\n  var stop = function () {\n    // здесь важен порядок остановки голоса\n    stopVoice();\n    voicePlayer === null || voicePlayer === void 0 ? void 0 : voicePlayer.stop();\n  };\n  var recognize = function (_a) {\n    var _b = _a === void 0 ? {} : _a,\n      begin = _b.begin,\n      messageName = _b.messageName,\n      _c = _b.isAutoListening,\n      isAutoListening = _c === void 0 ? false : _c;\n    return __awaiter(void 0, void 0, void 0, function () {\n      var unsubscribe_1;\n      return __generator(this, function (_d) {\n        switch (_d.label) {\n          case 0:\n            if (stopVoice()) {\n              return [2 /*return*/];\n            }\n            if (isPlaying) {\n              voicePlayer === null || voicePlayer === void 0 ? void 0 : voicePlayer.stop();\n              return [2 /*return*/];\n            }\n            if (settings.current.disableListening) {\n              return [2 /*return*/];\n            }\n            if (!(listener.status === 'stopped' && !isRecognizeInitializing)) return [3 /*break*/, 2];\n            isRecognizeInitializing = true;\n            unsubscribe_1 = listener.on('status', function () {\n              isRecognizeInitializing = false;\n              unsubscribe_1();\n            });\n            return [4 /*yield*/, client.init().catch(function (error) {\n              isRecognizeInitializing = false;\n              throw error;\n            })];\n          case 1:\n            _d.sent();\n            return [2 /*return*/, client.createVoiceStream(function (_a) {\n              var sendVoice = _a.sendVoice,\n                messageId = _a.messageId;\n              begin === null || begin === void 0 ? void 0 : begin.forEach(function (chunk) {\n                return sendVoice(new Uint8Array(chunk), false);\n              });\n              currentVoiceMessageId = messageId;\n              return listener.listen(function (chunk, analyser, last) {\n                if (analyser) {\n                  emit({\n                    voiceAnalyser: {\n                      data: analyser\n                    }\n                  });\n                }\n                sendVoice(chunk, last, messageName);\n              });\n            }, {\n              source: {\n                sourceType: isAutoListening ? 'autoListening' : 'lavashar'\n              }\n            })];\n          case 2:\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n  /**\n   * Стримит переданные чанки звука в VPS.\n   * При отсутствии last=true через 3 секунды тишины отправляет Cancel.\n   * Если было активно слушание или проигрывание – останавливает.\n   *\n   * @param chunks одноканальные, sampleRate: 16000\n   * @param last последние чанки этого стрима?\n   * @param messageName указать, если чанки для шазама\n   */\n  var streamVoice = function (chunks, last, messageName) {\n    return __awaiter(void 0, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            chunks = filterEmptyChunks(chunks);\n            if (streaming === null || streaming === void 0 ? void 0 : streaming(chunks, last)) {\n              return [2 /*return*/];\n            }\n            stopVoice();\n            if (isPlaying) {\n              voicePlayer === null || voicePlayer === void 0 ? void 0 : voicePlayer.stop();\n            }\n            if (!(!isRecognizeInitializing && chunks.length)) return [3 /*break*/, 2];\n            isRecognizeInitializing = true;\n            return [4 /*yield*/, client.init()];\n          case 1:\n            _a.sent();\n            return [2 /*return*/, client.createVoiceStream(function (_a) {\n              var messageId = _a.messageId,\n                sendVoice = _a.sendVoice;\n              return __awaiter(void 0, void 0, void 0, function () {\n                var cancelTimeoutId;\n                return __generator(this, function (_b) {\n                  cancelTimeoutId = -1;\n                  isRecognizeInitializing = false;\n                  currentVoiceMessageId = messageId;\n                  streaming = function (ch, l) {\n                    clearTimeout(cancelTimeoutId);\n                    ch.forEach(function (chunk) {\n                      return sendVoice(new Uint8Array(chunk), l, messageName);\n                    });\n                    if (l) {\n                      streaming = null;\n                    } else {\n                      cancelTimeoutId = setTimeout(function () {\n                        if (streaming) {\n                          stopVoice();\n                        }\n                      }, 3000);\n                    }\n                    return true;\n                  };\n                  streaming(chunks, last);\n                  return [2 /*return*/];\n                });\n              });\n            }, {\n              source: {\n                sourceType: 'lavashar'\n              }\n            })];\n          case 2:\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n  /**\n   * Отправляет готовые чанки звука в VPS.\n   * Чанки считаются завершёнными (сообщение отправляется с last=true).\n   * Если было активно слушание или проигрывание – останавливает.\n   *\n   * @param chunks одноканальные, sampleRate: 16000\n   * @param messageName указать, если чанки для шазама\n   */\n  var sendVoice = function (chunks, messageName) {\n    return __awaiter(void 0, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            chunks = filterEmptyChunks(chunks);\n            stopVoice();\n            if (isPlaying) {\n              voicePlayer === null || voicePlayer === void 0 ? void 0 : voicePlayer.stop();\n            }\n            if (!(!isRecognizeInitializing && chunks.length)) return [3 /*break*/, 2];\n            isRecognizeInitializing = true;\n            return [4 /*yield*/, client.init()];\n          case 1:\n            _a.sent();\n            return [2 /*return*/, client.createVoiceStream(function (_a) {\n              var messageId = _a.messageId,\n                sendVoiceStream = _a.sendVoice;\n              isRecognizeInitializing = false;\n              currentVoiceMessageId = messageId;\n              chunks.forEach(function (chunk) {\n                return sendVoiceStream(new Uint8Array(chunk), true, messageName);\n              });\n              return Promise.resolve();\n            }, {\n              source: {\n                sourceType: 'lavashar'\n              }\n            })];\n          case 2:\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n  /**\n   * Активирует слушание голоса.\n   * Если было активно слушание или проигрывание - останавливает, слушание в этом случае не активируется.\n   *\n   * @param begin одноканальные чанки, sampleRate: 16000 – будут отправлены перед голосом пользователя\n   */\n  var listen = function (_a, isAutoListening) {\n    var _b = _a === void 0 ? {} : _a,\n      begin = _b.begin;\n    return recognize({\n      begin: begin,\n      isAutoListening: isAutoListening\n    });\n  };\n  /**\n   * Активирует распознавание музыки.\n   * Если было активно слушание или проигрывание – останавливает\n   */\n  var shazam = function () {\n    return recognize({\n      messageName: MessageNames.MTT,\n      isAutoListening: false\n    });\n  };\n  if (isAudioSupported) {\n    resolveAudioContext(function (context, destroy) {\n      /// создаем плеер только если поддерживается аудио\n      /// и только когда готов AudioContext\n      voicePlayer = createVoicePlayer(context, {\n        startVoiceDelay: 1\n      });\n      destroyAudioContext = destroy;\n      // начало проигрывания озвучки\n      subscriptions.push(voicePlayer.on('play', function (mesId) {\n        isPlaying = true;\n        emit({\n          emotion: 'talk'\n        });\n        emit({\n          tts: {\n            status: 'start',\n            messageId: Number(mesId),\n            appInfo: appInfoDict[mesId]\n          }\n        });\n      }));\n      subscriptions.push(voicePlayer.on('stop', function (mesId) {\n        client.sendMute(Number(mesId));\n      }));\n      // окончание проигрывания озвучки\n      subscriptions.push(voicePlayer.on('end', function (mesId) {\n        isPlaying = false;\n        emit({\n          emotion: 'idle'\n        });\n        emit({\n          tts: {\n            status: 'stop',\n            messageId: Number(mesId),\n            appInfo: appInfoDict[mesId]\n          }\n        });\n        if (mesId === autolistenMessageId) {\n          listen().catch(function (error) {\n            // eslint-disable-next-line no-console\n            console.error(error);\n          });\n        }\n        // очистка сохраненных appInfo и messageId\n        var idx = 0;\n        do {\n          delete appInfoDict[mesIdQueue[0]];\n        } while (mesIdQueue[idx++] !== mesId && mesIdQueue.length > idx);\n        mesIdQueue.splice(0, idx);\n      }));\n      // оповещаем о готовности к воспроизведению звука\n      onReady === null || onReady === void 0 ? void 0 : onReady();\n    });\n  }\n  subscriptions.push(\n  // обработка входящей озвучки\n  client.on('voice', function (data, message) {\n    if (settings.current.disableDubbing) {\n      return;\n    }\n    voicePlayer === null || voicePlayer === void 0 ? void 0 : voicePlayer.append(data, message.messageId.toString(), message.last === 1);\n  }),\n  // статусы слушания речи\n  listener.on('status', function (status) {\n    emit({\n      listener: {\n        status: status\n      }\n    });\n    if (status === 'listen') {\n      voicePlayer === null || voicePlayer === void 0 ? void 0 : voicePlayer.setActive(false);\n      emit({\n        emotion: 'listen'\n      });\n    } else if (status === 'stopped') {\n      voicePlayer === null || voicePlayer === void 0 ? void 0 : voicePlayer.setActive(!settings.current.disableDubbing);\n      emit({\n        asr: {\n          text: ''\n        },\n        emotion: 'idle'\n      });\n    }\n  }),\n  // активация автослушания\n  client.on('systemMessage', function (systemMessage, originalMessage) {\n    var autoListening = systemMessage.auto_listening;\n    var messageId = originalMessage.messageId.toString();\n    if (typeof systemMessage.app_info !== 'undefined') {\n      appInfoDict[messageId] = systemMessage.app_info;\n      mesIdQueue.push(messageId);\n    }\n    if (autoListening) {\n      /// если озвучка включена - сохраняем mesId чтобы включить слушание после озвучки\n      /// если озвучка выключена - включаем слушание сразу\n      if (settings.current.disableDubbing === false) {\n        autolistenMessageId = messageId;\n      } else {\n        listen({}, autoListening).catch(function (error) {\n          // eslint-disable-next-line no-console\n          console.error(error);\n        });\n      }\n    }\n  }), client.on('status', function (_a) {\n    var code = _a.code;\n    if (code < 0) {\n      stopVoice(false);\n    }\n  }), client.on('stt', function (_a, originalMessage) {\n    var _b;\n    var text = _a.text,\n      response = _a.response;\n    var listening = listener.status === 'listen' && !settings.current.disableListening;\n    if (text) {\n      var last = originalMessage.last === 1;\n      if (last || listening) {\n        emit({\n          asr: {\n            mid: originalMessage.messageId,\n            text: text.data || '',\n            last: last\n          }\n        });\n      }\n      if (last) {\n        stopVoice(false);\n      }\n    }\n    if (response) {\n      var decoderResultField = response.decoderResultField,\n        errorResponse = response.errorResponse;\n      var last = !!(decoderResultField && (decoderResultField === null || decoderResultField === void 0 ? void 0 : decoderResultField.isFinal));\n      if ((last || listening) && ((_b = decoderResultField === null || decoderResultField === void 0 ? void 0 : decoderResultField.hypothesis) === null || _b === void 0 ? void 0 : _b.length)) {\n        emit({\n          asr: {\n            mid: originalMessage.messageId,\n            text: decoderResultField.hypothesis[0].normalizedText || '',\n            last: last\n          }\n        });\n      }\n      if (last || errorResponse) {\n        stopVoice(false);\n      }\n    }\n  }), client.on('musicRecognition', function (response, originalMessage) {\n    var _a;\n    emit({\n      mtt: {\n        response: response,\n        mid: originalMessage.messageId\n      }\n    });\n    if (((_a = response.decoderResultField) === null || _a === void 0 ? void 0 : _a.isFinal) || response.errorResponse) {\n      stopVoice(false);\n    }\n  }), settings.on('change-request', function (nextSettings) {\n    var disableDubbing = nextSettings.disableDubbing,\n      disableListening = nextSettings.disableListening;\n    /// Важен порядок обработки флагов слушания и озвучки —\n    /// сначала слушание, потом озвучка\n    disableListening && stopVoice();\n    // Такой вызов необходим, чтобы включая озвучку она тут же проигралась (при её наличии), и наоборот\n    settings.current.disableDubbing !== disableDubbing && (voicePlayer === null || voicePlayer === void 0 ? void 0 : voicePlayer.setActive(!disableDubbing));\n  }));\n  return {\n    destroy: function () {\n      stopVoice();\n      voicePlayer === null || voicePlayer === void 0 ? void 0 : voicePlayer.setActive(false);\n      subscriptions.splice(0, subscriptions.length).map(function (unsubscribe) {\n        return unsubscribe();\n      });\n      destroyAudioContext === null || destroyAudioContext === void 0 ? void 0 : destroyAudioContext();\n    },\n    listen: listen,\n    shazam: shazam,\n    sendVoice: sendVoice,\n    streamVoice: streamVoice,\n    stop: stop,\n    stopPlaying: function () {\n      voicePlayer === null || voicePlayer === void 0 ? void 0 : voicePlayer.stop();\n    },\n    toggleAnalyser: function (enable) {\n      useAnalyser = enable;\n    }\n  };\n};\nvar createMutexedObject = function (initialObject) {\n  var _a = createNanoEvents(),\n    on = _a.on,\n    emit = _a.emit;\n  var object = __assign({}, initialObject);\n  var nextObject = {};\n  var mode = 'released';\n  var tryApply = function () {\n    if (mode === 'released') {\n      var prevObject_1 = object;\n      object = __assign(__assign({}, prevObject_1), nextObject);\n      var isObjectChanged = Object.keys(nextObject).some(function (name) {\n        return nextObject[name] !== prevObject_1[name];\n      });\n      if (isObjectChanged) {\n        emit('changed', object, prevObject_1);\n      }\n    }\n  };\n  var lock = function () {\n    mode = 'locked';\n  };\n  var release = function () {\n    mode = 'released';\n    tryApply();\n  };\n  var change = function (setts) {\n    nextObject = __assign(__assign({}, nextObject), setts);\n    emit('change-request', setts);\n    tryApply();\n  };\n  var current = {};\n  Object.keys(initialObject).forEach(function (prop) {\n    Object.defineProperty(current, prop, {\n      get: function () {\n        return object[prop];\n      }\n    });\n  });\n  return {\n    on: on,\n    lock: lock,\n    release: release,\n    change: change,\n    current: current\n  };\n};\nvar createMutexSwitcher = function (_a, initialDeps) {\n  var lock = _a.lock,\n    release = _a.release;\n  var deps = __assign({}, initialDeps);\n  return {\n    change: function (nextDeps) {\n      deps = __assign(__assign({}, deps), nextDeps);\n      if (Object.values(deps).every(function (dep) {\n        return dep;\n      })) {\n        release();\n      } else {\n        lock();\n      }\n    }\n  };\n};\nvar STATE_UPDATE_TIMEOUT = 200;\nvar DEFAULT_PROJECT_ID = 'd929986a-611a-2ba0-6174-1928c99600a5';\nvar DEFAULT_APPLICATION_ID = '7c4e23bf-cd93-b57e-874b-d9fc1b35f93d';\nvar DEFAULT_APP_VERSION_ID = '26d0bb2e-45d6-a276-f70e-6c016d1f9cff';\nvar DEFAULT_APP = {\n  projectId: DEFAULT_PROJECT_ID,\n  applicationId: DEFAULT_APPLICATION_ID,\n  appversionId: DEFAULT_APP_VERSION_ID,\n  frontendStateId: [DEFAULT_PROJECT_ID, DEFAULT_APPLICATION_ID, DEFAULT_APP_VERSION_ID].join('_'),\n  frontendType: 'DIALOG',\n  systemName: 'assistant',\n  frontendEndpoint: 'None'\n};\nvar BASIC_SMART_APP_COMMANDS_TYPES = ['smart_app_data', 'smart_app_error', 'start_smart_search', 'navigation'];\nfunction convertFieldValuesToString(object) {\n  return Object.keys(object).reduce(function (acc, key) {\n    if (object[key]) {\n      acc[key] = typeof object[key] === 'string' && object[key].startsWith('{') ? object[key] : JSON.stringify(object[key]);\n    }\n    return acc;\n  }, {});\n}\nvar isDefaultApp = function (appInfo) {\n  return appInfo.frontendStateId === DEFAULT_APP.frontendStateId;\n};\nvar promiseTimeout = function (promise, timeout) {\n  var timeoutId;\n  return Promise.race([promise.then(function (v) {\n    if (timeoutId) {\n      window.clearTimeout(timeoutId);\n    }\n    return v;\n  }), new Promise(function (_, reject) {\n    timeoutId = window.setTimeout(function () {\n      reject(new Error(\"Timed out in \" + timeout + \" ms.\"));\n    }, timeout);\n  })]);\n};\nvar createAssistant = function (_a) {\n  var _b;\n  var getMeta = _a.getMeta,\n    getInitialMeta = _a.getInitialMeta,\n    getVoiceMeta = _a.getVoiceMeta,\n    checkCertUrl = _a.checkCertUrl,\n    configuration = __rest(_a, [\"getMeta\", \"getInitialMeta\", \"getVoiceMeta\", \"checkCertUrl\"]);\n  var _c = createNanoEvents(),\n    on = _c.on,\n    emit = _c.emit;\n  // default_character отправляется в мета при отправке InitialSettings\n  var defaultCharacter = 'sber';\n  // хеш [messageId]: requestId, где requestId - пользовательский ид экшена\n  var requestIdMap = {};\n  // mid для последнего отправленного/принятого сообщения (кроме server_action)\n  var lastMid = 0;\n  var subscriptions = [];\n  var backgroundApps = {};\n  var settings = createMutexedObject({\n    disableDubbing: configuration.settings.dubbing === -1,\n    disableListening: false,\n    sendTextAsSsml: false\n  });\n  var settingsSwitcher = createMutexSwitcher(settings, {\n    isListenerStopped: true,\n    isVoicePlayerEnded: true\n  });\n  // готов/не готов воспроизводить озвучку\n  var voiceReady = false;\n  // текущий апп\n  var app = {\n    info: DEFAULT_APP\n  };\n  var sdkMeta = {\n    theme: 'dark'\n  };\n  var metaProvider = function (additionalMeta) {\n    return __awaiter(void 0, void 0, void 0, function () {\n      var appState, _a, current_app, getBackgroundAppsMeta, background_apps;\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            if (!(app !== null && app.info.frontendType === 'WEB_APP' && app.getState)) return [3 /*break*/, 2];\n            return [4 /*yield*/, promiseTimeout(app.getState(), STATE_UPDATE_TIMEOUT).catch(function () {\n              // eslint-disable-next-line no-console\n              console.error('App-state wasn`t resolved, timeout had been expired');\n              return undefined;\n            })];\n          case 1:\n            _a = _b.sent();\n            return [3 /*break*/, 3];\n          case 2:\n            _a = undefined;\n            _b.label = 3;\n          case 3:\n            appState = _a;\n            current_app = {\n              app_info: app.info,\n              state: appState || {}\n            };\n            getBackgroundAppsMeta = function () {\n              return __awaiter(void 0, void 0, void 0, function () {\n                var apps, backgroundAppsIds, backgroundAppsMeta;\n                return __generator(this, function (_a) {\n                  switch (_a.label) {\n                    case 0:\n                      apps = __assign({}, backgroundApps);\n                      backgroundAppsIds = Object.keys(apps);\n                      backgroundAppsMeta = [];\n                      return [4 /*yield*/, Promise.all(backgroundAppsIds.map(function (applicationId) {\n                        return __awaiter(void 0, void 0, void 0, function () {\n                          var _a, getState;\n                          return __generator(this, function (_b) {\n                            _a = apps[applicationId].getState, getState = _a === void 0 ? function () {\n                              return Promise.resolve({});\n                            } : _a;\n                            return [2 /*return*/, promiseTimeout(getState(), STATE_UPDATE_TIMEOUT).then(function (state) {\n                              return state;\n                            }, function () {\n                              return {};\n                            })];\n                          });\n                        });\n                      })).then(function (results) {\n                        results.forEach(function (appResult, index) {\n                          var state = appResult;\n                          var applicationId = backgroundAppsIds[index];\n                          backgroundAppsMeta.push({\n                            app_info: apps[applicationId].appInfo,\n                            state: state\n                          });\n                        });\n                      })];\n                    case 1:\n                      _a.sent();\n                      return [2 /*return*/, backgroundAppsMeta];\n                  }\n                });\n              });\n            };\n            return [4 /*yield*/, getBackgroundAppsMeta()];\n          case 4:\n            background_apps = _b.sent();\n            return [2 /*return*/, convertFieldValuesToString(__assign(__assign(__assign(__assign({}, sdkMeta), {\n              time: getTime(),\n              current_app: current_app,\n              background_apps: background_apps\n            }), additionalMeta || {}), getMeta ? getMeta() : {}))];\n        }\n      });\n    });\n  };\n  var transport = createTransport({\n    createWS: (_b = configuration.fakeVps) === null || _b === void 0 ? void 0 : _b.createFakeWS,\n    checkCertUrl: checkCertUrl\n  });\n  var protocol = createProtocol(transport, __assign(__assign({}, configuration), {\n    getInitialMeta: typeof getInitialMeta !== 'undefined' ? function () {\n      return getInitialMeta().then(function (meta) {\n        return convertFieldValuesToString(__assign(__assign({}, meta), {\n          default_character: defaultCharacter\n        }));\n      });\n    } : function () {\n      return convertFieldValuesToString({\n        default_character: defaultCharacter\n      });\n    },\n    // пока голос не готов, выключаем озвучку\n    settings: __assign(__assign({}, configuration.settings), {\n      dubbing: -1\n    })\n  }));\n  var client = createClient(protocol, metaProvider, {\n    getVoiceMeta: function () {\n      return getVoiceMeta ? convertFieldValuesToString(getVoiceMeta()) : {};\n    }\n  });\n  var voice = createVoice(client, settings, function (event) {\n    if (typeof event.tts !== 'undefined') {\n      emit('tts', event.tts);\n      settingsSwitcher.change({\n        isVoicePlayerEnded: event.tts.status === 'stop'\n      });\n      return;\n    }\n    if (typeof event.listener !== 'undefined') {\n      settingsSwitcher.change({\n        isListenerStopped: event.listener.status === 'stopped'\n      });\n    }\n    emit('assistant', event);\n  }, function () {\n    voiceReady = true;\n    if (!settings.current.disableDubbing) {\n      protocol.changeSettings({\n        dubbing: 1\n      });\n    }\n  });\n  /** завершает текущий апп */\n  var closeApp = function (closing) {\n    if (closing === void 0) {\n      closing = app.info;\n    }\n    // переключить на дефолтный апп\n    if (closing.applicationId === app.info.applicationId) {\n      /// выглядит как нарушение логики,\n      /// но с точки зрения апи - ок\n      /// иначе потребителю нужно знать про DEFAULT_APP\n      app = {\n        info: DEFAULT_APP\n      };\n    }\n    if (!isDefaultApp(closing)) {\n      emit('app', {\n        type: 'close',\n        app: closing\n      });\n    }\n  };\n  /** отправляет текст */\n  var sendText = function (text, shouldSendDisableDubbing, additionalMeta) {\n    if (shouldSendDisableDubbing === void 0) {\n      shouldSendDisableDubbing = false;\n    }\n    voice.stop();\n    return client.sendText(text, settings.current.sendTextAsSsml, shouldSendDisableDubbing, additionalMeta);\n  };\n  /** отправляет server_action */\n  var sendServerAction = function (serverAction, messageName, requestId, actionApp, mode) {\n    if (messageName === void 0) {\n      messageName = 'SERVER_ACTION';\n    }\n    if (requestId === void 0) {\n      requestId = undefined;\n    }\n    if (actionApp === void 0) {\n      actionApp = app.info;\n    }\n    client.sendServerAction(serverAction, actionApp, messageName, mode).then(function (messageId) {\n      if (requestId && messageId) {\n        requestIdMap[messageId.toString()] = requestId;\n      }\n    });\n  };\n  /** отправляет ответ на запрос доступа к местоположению и пр. меты */\n  var sendMetaForPermissionRequest = function (requestMessageId, appInfo, items) {\n    return __awaiter(void 0, void 0, void 0, function () {\n      var _a, props, data, meta;\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            return [4 /*yield*/, getAnswerForRequestPermissions(requestMessageId, appInfo, items)];\n          case 1:\n            _a = _b.sent(), props = __rest(_a.meta, []), data = __rest(_a, [\"meta\"]);\n            return [4 /*yield*/, metaProvider()];\n          case 2:\n            meta = _b.sent();\n            client.sendData(__assign({}, data), 'SERVER_ACTION', __assign(__assign({}, meta), convertFieldValuesToString(props)));\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n  subscriptions.push(protocol.on('ready', function () {\n    return emit('vps', {\n      type: 'ready'\n    });\n  }));\n  // пока voicePlayer не доступен, включение озвучки не будет отправлено\n  subscriptions.push(settings.on('changed', function (nextSettings, prevSettings) {\n    if (nextSettings.disableDubbing !== prevSettings.disableDubbing) {\n      voiceReady && protocol.changeSettings({\n        dubbing: nextSettings.disableDubbing ? -1 : 1\n      });\n    }\n  }));\n  // при неудачном переподключении к сокету\n  subscriptions.push(transport.on('error', function (error) {\n    voice.stop();\n    protocol.clearQueue();\n    emit('vps', {\n      type: 'error',\n      error: error\n    });\n  }));\n  // обработка исходящих сообщений\n  subscriptions.push(protocol.on('outcoming', function (message) {\n    if (message.text || message.voice) {\n      /// не прерываем множественные ответы для сервер-экшенов\n      /// прервем, если получим карточку или бабл в ответ\n      lastMid = message.messageId;\n    }\n    emit('vps', {\n      type: 'outcoming',\n      message: message\n    });\n  }));\n  // обработка ошибок\n  subscriptions.push(protocol.on('error', function (error) {\n    emit('error', error);\n  }));\n  // оповещение о статусах\n  subscriptions.push(client.on('status', function (status, _a) {\n    var messageId = _a.messageId;\n    emit('status', status, messageId);\n  }));\n  // история на запрос GetHistoryRequest\n  subscriptions.push(client.on('history', function (history) {\n    emit('history', history);\n  }));\n  // обработка входящих команд, и событий аппа\n  subscriptions.push(client.on('systemMessage', function (systemMessage, originalMessage) {\n    if (originalMessage.messageName === 'ANSWER_TO_USER') {\n      var _a = systemMessage.answerId,\n        answerId = _a === void 0 ? 0 : _a,\n        activate_app_info = systemMessage.activate_app_info,\n        _b = systemMessage.items,\n        items = _b === void 0 ? [] : _b,\n        mesAppInfo = systemMessage.app_info;\n      var isChatApp = mesAppInfo && mesAppInfo.frontendType === 'CHAT_APP';\n      var isDialog = mesAppInfo && mesAppInfo.frontendType === 'DIALOG';\n      var isAppChanged = mesAppInfo && mesAppInfo.applicationId !== app.info.applicationId;\n      if (\n      // DIALOG не попадает в current_app\n      !isDialog && isAppChanged && (\n      /// игнорируем activate_app_info для чатапов\n      /// по-умолчанию activate_app_info: true\n      isChatApp || activate_app_info !== false)) {\n        emit('app', {\n          type: 'run',\n          app: mesAppInfo\n        });\n      }\n      if (isDialog && isAppChanged && app.info.applicationId !== DEFAULT_APPLICATION_ID) {\n        emit('app', {\n          type: 'run',\n          app: DEFAULT_APP\n        });\n      }\n      // cancel для множественных ответов\n      if (answerId >= 2 && lastMid > originalMessage.messageId) {\n        client.sendCancel(originalMessage.messageId);\n      }\n      // последним сообщением считаем, только если пришли карточки/баблы\n      if (lastMid < originalMessage.messageId && items.findIndex(function (_a) {\n        var bubble = _a.bubble,\n          card = _a.card;\n        return bubble || card;\n      }) >= 0) {\n        lastMid = originalMessage.messageId;\n      }\n      if (items.length) {\n        var _loop_1 = function (i) {\n          var command = items[i].command;\n          if (typeof command !== 'undefined') {\n            window.setTimeout(function () {\n              return emit('command', command);\n            });\n            if (command.type === 'start_music_recognition') {\n              voice.shazam();\n              return {\n                value: void 0\n              };\n            }\n            if (command.type === 'request_permissions' && mesAppInfo) {\n              sendMetaForPermissionRequest(originalMessage.messageId, mesAppInfo, command.permissions);\n              return {\n                value: void 0\n              };\n            }\n            if (command.type === 'action') {\n              emit('actionCommand', {\n                type: 'command',\n                command: command,\n                appInfo: mesAppInfo\n              });\n            }\n            if (mesAppInfo && BASIC_SMART_APP_COMMANDS_TYPES.includes(command.type)) {\n              // эмитим все команды, т.к бывают фоновые команды\n              emit('app', {\n                type: 'command',\n                command: __assign(__assign({}, command), {\n                  sdk_meta: {\n                    mid: originalMessage.messageId.toString(),\n                    requestId: requestIdMap[originalMessage.messageId.toString()]\n                  }\n                }),\n                app: mesAppInfo\n              });\n            }\n            if (command.type === 'close_app' && !isDialog) {\n              closeApp(mesAppInfo);\n            }\n          }\n        };\n        for (var i = 0; i < items.length; i++) {\n          var state_1 = _loop_1(i);\n          if (typeof state_1 === \"object\") return state_1.value;\n        }\n      }\n      emit('vps', {\n        type: 'incoming',\n        systemMessage: systemMessage,\n        originalMessage: originalMessage\n      });\n    }\n  }));\n  // прокидывает команды backgroundApp'ов в их подписчики\n  on('app', function (event) {\n    var _a;\n    if (event.type === 'command') {\n      var backgroundAppOnCommand = (_a = backgroundApps[event.app.applicationId]) === null || _a === void 0 ? void 0 : _a.commandsSubscribers;\n      if (Array.isArray(backgroundAppOnCommand)) {\n        backgroundAppOnCommand.forEach(function (onCommand) {\n          var _a;\n          onCommand(event.command, (_a = event.command.sdk_meta) === null || _a === void 0 ? void 0 : _a.mid);\n        });\n      }\n    }\n  });\n  /** уничтожает ассистент, очищает подписки */\n  var destroy = function () {\n    voice.destroy();\n    client.destroy();\n    protocol.destroy();\n    subscriptions.splice(0, subscriptions.length).map(function (unsubscribe) {\n      return unsubscribe();\n    });\n  };\n  /** запускает ассистент (приветствие) */\n  var start = function (_a) {\n    var _b = _a === void 0 ? {} : _a,\n      _c = _b.disableGreetings,\n      disableGreetings = _c === void 0 ? false : _c,\n      _d = _b.initPhrase,\n      initPhrase = _d === void 0 ? undefined : _d,\n      _e = _b.isFirstSession,\n      isFirstSession = _e === void 0 ? false : _e;\n    return __awaiter(void 0, void 0, void 0, function () {\n      return __generator(this, function (_f) {\n        switch (_f.label) {\n          case 0:\n            if (!(!disableGreetings && isDefaultApp(app.info))) return [3 /*break*/, 2];\n            return [4 /*yield*/, client.sendOpenAssistant({\n              isFirstSession: isFirstSession\n            })];\n          case 1:\n            _f.sent();\n            _f.label = 2;\n          case 2:\n            if (initPhrase) {\n              return [2 /*return*/, client.sendText(initPhrase).then(function (messageId) {\n                return messageId ? client.waitForAnswer(messageId) : undefined;\n              })];\n            }\n            return [2 /*return*/, undefined];\n        }\n      });\n    });\n  };\n  return {\n    get activeApp() {\n      return !isDefaultApp(app.info) ? app.info : null;\n    },\n    get settings() {\n      return Object.create(Object.getPrototypeOf(settings.current), Object.getOwnPropertyDescriptors(settings.current));\n    },\n    destroy: destroy,\n    closeApp: closeApp,\n    listen: voice.listen,\n    shazam: voice.shazam,\n    sendServerAction: sendServerAction,\n    getHistoryRequest: protocol.getHistoryRequest,\n    sendText: sendText,\n    sendVoice: voice.sendVoice,\n    streamVoice: voice.streamVoice,\n    start: start,\n    stop: function () {\n      voice.stop();\n      if (lastMid !== 0) {\n        client.sendCancel(lastMid);\n      }\n      setTimeout(function () {\n        protocol.clearQueue();\n        transport.close();\n      });\n    },\n    stopTts: voice.stopPlaying,\n    stopVoice: voice.stop,\n    emit: emit,\n    on: on,\n    changeConfiguration: protocol.changeConfiguration,\n    changeSettings: settings.change,\n    changeSdkMeta: function (nextSdkMeta) {\n      sdkMeta = __assign(__assign({}, sdkMeta), nextSdkMeta);\n    },\n    reconnect: protocol.reconnect,\n    get protocol() {\n      return protocol;\n    },\n    setActiveApp: function (info, getState) {\n      app = {\n        info: info,\n        getState: getState\n      };\n    },\n    addBackgroundApp: function (_a) {\n      var appInfo = _a.appInfo,\n        getState = _a.getState;\n      backgroundApps[appInfo.applicationId] = {\n        appInfo: appInfo,\n        getState: getState,\n        commandsSubscribers: []\n      };\n      var remove = function () {\n        delete backgroundApps[appInfo.applicationId];\n      };\n      var onCommand = function (subscriber) {\n        var _a;\n        (_a = backgroundApps[appInfo.applicationId]) === null || _a === void 0 ? void 0 : _a.commandsSubscribers.push(subscriber);\n        return {\n          clearSubscribers: function () {\n            if (backgroundApps[appInfo.applicationId]) {\n              backgroundApps[appInfo.applicationId].commandsSubscribers = [];\n            }\n          }\n        };\n      };\n      var sendServerActionToBackgroundApp = function (serverAction, messageName, requestId) {\n        var _a;\n        if (messageName === void 0) {\n          messageName = 'SERVER_ACTION';\n        }\n        if (requestId === void 0) {\n          requestId = undefined;\n        }\n        return sendServerAction(serverAction, messageName, requestId, (_a = backgroundApps[appInfo.applicationId]) === null || _a === void 0 ? void 0 : _a.appInfo);\n      };\n      return {\n        remove: remove,\n        onCommand: onCommand,\n        sendServerAction: sendServerActionToBackgroundApp\n      };\n    },\n    get status() {\n      return protocol.status;\n    },\n    setDefaultCharacterMeta: function (characterId) {\n      defaultCharacter = characterId;\n    },\n    toggleVoiceAnalyser: voice.toggleAnalyser\n  };\n};\nexport { createNavigatorAudioProvider as a, asrExports as b, createAssistant as c };","map":{"version":3,"names":["_","__assign","b","__awaiter","c","__generator","d","createNanoEvents","a","__rest","commonjsRequire","r","requireMinimal","commonjsGlobal","p","protoExports","M","MessageNames","createProtocol","asr","exports","module","global","factory","$protobuf","$Reader","Reader","$util","util","$root","roots","Variables","properties","variables","keys","Object","i","length","prototype","emptyObject","decode","reader","create","end","undefined","len","pos","message","key","value","tag","uint32","end2","tag2","string","skipType","UndecodedSeconds","undecodedSeconds","float","FullyFinalized","EmotionResult","name","confidence","Hypothesis","words","acousticCost","linguisticCost","finalCost","phraseStart","phraseEnd","normalizedText","DecoderResult","hypothesis","emotionResult","contextAnswer","emptyArray","chunkStart","chunkEnd","timeEndpointDetectionMs","timeDecodingMs","isFinal","push","bool","ContextAnswer","contextResult","ContextRef","id","index","originalValue","predictedValue","score","int32","ErrorResponse","errorMessage","PacketWrapperFromServer","undecodedSecondsField","fullyFinalizedField","decoderResultField","errorResponse","$oneOfFields","defineProperty","get","oneOfGetter","set","oneOfSetter","asrExports","mtt","Music2TrackProtocol","result","isMusicFound","errorCode","MttResponse","mttExports","createClient","protocol","provideMeta","_a","getVoiceMeta","_b","on","emit","waitForAnswer","messageId","Promise","resolve","off","systemMessageData","originalMessage","messageName","ANSWER_TO_USER","DO_NOTHING","sendData","data","meta","getMessageId","sendSystemMessage","sendCancel","sendOpenAssistant","isFirstSession","_c","_d","label","is_first_session","sent","sendMeta","additionalMeta","sendMute","sendServerAction","serverAction","appInfo","mode","systemData","app_info","server_action","source","sourceType","sendText","text","isSsml","shouldSendDisableDubbing","trim","batch","clientSendText","sendSettings","prevDubbing","sendDisableDubbing","isStillNeedReturnDubbing","configuration","settings","dubbing","createVoiceStream","callback","sendVoice","first","args","_i","arguments","apply","_e","_f","_g","_h","_j","systemMessage","JSON","parse","voice","Uint8Array","status","bytes","history_1","GetHistoryResponse","historyMessages","parsedHistory","map","historyMessage","content","STT","response","MTT","destroy","init","RETRY_INTERVAL","defaultWSCreator","url","WebSocket","createTransport","createWS","checkCertUrl","hasCert","retryTimeoutId","retries","webSocket","stopped","checkCert","checkUrl","window","fetch","then","catch","close","connect","okay","navigator","onLine","Error","binaryType","addEventListener","readyState","clearTimeout","e","setTimeout","open","reconnect","send","isOnline","convertToMetaPermissions","permission","type","getLocation","reject","geolocation","getCurrentPosition","coords","timestamp","lat","latitude","lon","longitude","accuracy","timeout","getTime","timezone_id","Intl","DateTimeFormat","resolvedOptions","timeZone","timezone_offset_sec","Date","getTimezoneOffset","now","getAnswerForRequestPermissions","requestMessageId","items","permissions","record_audio","geo","read_contacts","time","action_id","request_message_id","command_response","request_permissions","all","location_1","trys","location","IS_APPLE_MOBILE","test","platform","maxTouchPoints","MSStream","createSilentAudioFile","sampleRate","arrayBuffer","ArrayBuffer","dataView","DataView","setUint32","setUint16","missingCharacters","btoa","String","fromCharCode","slice","createIosSilentModePatch","audio","src","load","initialize","Audio","setAttribute","preload","loop","turnOff","pause","turnOn","play","console","error","isActive","paused","iosSilentModePatch","isAudioSupported","AudioContext","webkitAudioContext","createAudioContext","options","audioContext","resolveAudioContext","onReady","isSafari_1","vendor","search","context_1","context","ready","state","onstatechange","handleClick_1","document","removeEventListener","oscillator","createOscillator","frequency","destination","start","stop","resume","unsubscribe_1","downsampleBuffer","buffer","inSampleRate","outSampleRate","sampleRateRatio","newLength","Math","round","Int16Array","offsetResult","offsetBuffer","nextOffsetBuffer","accum","count","min","TARGET_SAMPLE_RATE","IS_FIREFOX","userAgent","toLowerCase","indexOf","IS_SAFARI","processor","analyser","createAudioRecorder","stream","cb","useAnalyser","input","getTracks","forEach","track","disconnect","createMediaStreamSource","createScriptProcessor","createAnalyser","fftSize","listener","inputBuffer","getChannelData","last","some","voiceData","analyserArray","frequencyBinCount","getByteFrequencyData","createMediaStreamDestination","createNavigatorAudioProvider","mediaDevices","getUserMedia","err","createVoiceListener","createAudioProvider","stopRecord","cancelableToken","current","listen","handleVoice","capturedToken","recStop","createTrackCollection","trackIds","trackMap","clear","Array","Map","has","getById","getByIndex","predicate","createChunkQueue","chunks","chunk","remove","splice","ended","HZ_BYTES_COUNT","from16BitToFloat32","incomingData","l","outputData","Float32Array","createTrackStream","ctx","numberOfChannels","delay","onPlay","onEnd","onStop","trackStatus","queue","extraByte","lastChunkOffset","startTime","firstChunk","loaded","isPlaying","byteLength","getChunkFromBuffer","currentTime","duration","getExtraBytes","bytesArraysSizes","incomingMessageVoiceDataLength","sourceLen","prepend","createChunk","audioBuffer","createBuffer","channelChunk","j","createBufferSource","onended","tmp","dataBuffer","bufferUi8","bufferI16","write","slicePoint","setLoaded","createVoicePlayer","actx","startVoiceDelay","tracks","active","cursor","append","trackId","cur","setActive","filterEmptyChunks","chunksOriginal","reduce","acc","chunkOriginal","filter","int","createVoice","client","voicePlayer","subscriptions","appInfoDict","mesIdQueue","isRecognizeInitializing","autolistenMessageId","currentVoiceMessageId","streaming","destroyAudioContext","stopVoice","recognize","begin","isAutoListening","disableListening","voiceAnalyser","streamVoice","cancelTimeoutId","ch","sendVoiceStream","shazam","mesId","emotion","tts","Number","idx","disableDubbing","toString","autoListening","auto_listening","code","listening","mid","nextSettings","unsubscribe","stopPlaying","toggleAnalyser","enable","createMutexedObject","initialObject","object","nextObject","tryApply","prevObject_1","isObjectChanged","lock","release","change","setts","prop","createMutexSwitcher","initialDeps","deps","nextDeps","values","every","dep","STATE_UPDATE_TIMEOUT","DEFAULT_PROJECT_ID","DEFAULT_APPLICATION_ID","DEFAULT_APP_VERSION_ID","DEFAULT_APP","projectId","applicationId","appversionId","frontendStateId","join","frontendType","systemName","frontendEndpoint","BASIC_SMART_APP_COMMANDS_TYPES","convertFieldValuesToString","startsWith","stringify","isDefaultApp","promiseTimeout","promise","timeoutId","race","v","createAssistant","getMeta","getInitialMeta","defaultCharacter","requestIdMap","lastMid","backgroundApps","sendTextAsSsml","settingsSwitcher","isListenerStopped","isVoicePlayerEnded","voiceReady","app","info","sdkMeta","theme","metaProvider","appState","current_app","getBackgroundAppsMeta","background_apps","getState","apps","backgroundAppsIds","backgroundAppsMeta","results","appResult","transport","fakeVps","createFakeWS","default_character","event","changeSettings","closeApp","closing","requestId","actionApp","sendMetaForPermissionRequest","props","prevSettings","clearQueue","history","answerId","activate_app_info","mesAppInfo","isChatApp","isDialog","isAppChanged","findIndex","bubble","card","_loop_1","command","includes","sdk_meta","state_1","backgroundAppOnCommand","commandsSubscribers","isArray","onCommand","disableGreetings","initPhrase","activeApp","getPrototypeOf","getOwnPropertyDescriptors","getHistoryRequest","stopTts","changeConfiguration","changeSdkMeta","nextSdkMeta","setActiveApp","addBackgroundApp","subscriber","clearSubscribers","sendServerActionToBackgroundApp","setDefaultCharacterMeta","characterId","toggleVoiceAnalyser"],"sources":["C:/Users/Andrey/Downloads/pong_canvas_app/node_modules/@salutejs/client/esm/assistant-a6b726e2.js"],"sourcesContent":["import { _ as __assign, b as __awaiter, c as __generator, d as createNanoEvents, a as __rest } from './common-ba25e019.js';\nimport { b as commonjsRequire, r as requireMinimal, c as commonjsGlobal, p as protoExports, M as MessageNames, d as createProtocol } from './sdk-f73acc07.js';\n\nvar asr = {exports: {}};\n\n/*eslint-disable block-scoped-var, id-length, no-control-regex, no-magic-numbers, no-prototype-builtins, no-redeclare, no-shadow, no-var, sort-vars*/\n\n(function (module) {\n\t(function(global, factory) { /* global define, require, module */\n\n\t    /* AMD */ if (typeof commonjsRequire === 'function' && 'object' === 'object' && module && module.exports)\n\t        module.exports = factory(requireMinimal());\n\n\t})(commonjsGlobal, function($protobuf) {\n\n\t    // Common aliases\n\t    var $Reader = $protobuf.Reader, $util = $protobuf.util;\n\t    \n\t    // Exported root namespace\n\t    var $root = $protobuf.roots[\"default\"] || ($protobuf.roots[\"default\"] = {});\n\t    \n\t    $root.Variables = (function() {\n\t    \n\t        /**\n\t         * Properties of a Variables.\n\t         * @exports IVariables\n\t         * @interface IVariables\n\t         * @property {Object.<string,string>|null} [variables] Variables variables\n\t         */\n\t    \n\t        /**\n\t         * Constructs a new Variables.\n\t         * @exports Variables\n\t         * @classdesc Represents a Variables.\n\t         * @implements IVariables\n\t         * @constructor\n\t         * @param {IVariables=} [properties] Properties to set\n\t         */\n\t        function Variables(properties) {\n\t            this.variables = {};\n\t            if (properties)\n\t                for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i)\n\t                    if (properties[keys[i]] != null)\n\t                        this[keys[i]] = properties[keys[i]];\n\t        }\n\t    \n\t        /**\n\t         * Variables variables.\n\t         * @member {Object.<string,string>} variables\n\t         * @memberof Variables\n\t         * @instance\n\t         */\n\t        Variables.prototype.variables = $util.emptyObject;\n\t    \n\t        /**\n\t         * Decodes a Variables message from the specified reader or buffer.\n\t         * @function decode\n\t         * @memberof Variables\n\t         * @static\n\t         * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n\t         * @param {number} [length] Message length if known beforehand\n\t         * @returns {Variables} Variables\n\t         * @throws {Error} If the payload is not a reader or valid buffer\n\t         * @throws {$protobuf.util.ProtocolError} If required fields are missing\n\t         */\n\t        Variables.decode = function decode(reader, length) {\n\t            if (!(reader instanceof $Reader))\n\t                reader = $Reader.create(reader);\n\t            var end = length === undefined ? reader.len : reader.pos + length, message = new $root.Variables(), key, value;\n\t            while (reader.pos < end) {\n\t                var tag = reader.uint32();\n\t                switch (tag >>> 3) {\n\t                case 1: {\n\t                        if (message.variables === $util.emptyObject)\n\t                            message.variables = {};\n\t                        var end2 = reader.uint32() + reader.pos;\n\t                        key = \"\";\n\t                        value = \"\";\n\t                        while (reader.pos < end2) {\n\t                            var tag2 = reader.uint32();\n\t                            switch (tag2 >>> 3) {\n\t                            case 1:\n\t                                key = reader.string();\n\t                                break;\n\t                            case 2:\n\t                                value = reader.string();\n\t                                break;\n\t                            default:\n\t                                reader.skipType(tag2 & 7);\n\t                                break;\n\t                            }\n\t                        }\n\t                        message.variables[key] = value;\n\t                        break;\n\t                    }\n\t                default:\n\t                    reader.skipType(tag & 7);\n\t                    break;\n\t                }\n\t            }\n\t            return message;\n\t        };\n\t    \n\t        return Variables;\n\t    })();\n\t    \n\t    $root.UndecodedSeconds = (function() {\n\t    \n\t        /**\n\t         * Properties of an UndecodedSeconds.\n\t         * @exports IUndecodedSeconds\n\t         * @interface IUndecodedSeconds\n\t         * @property {number|null} [undecodedSeconds] UndecodedSeconds undecodedSeconds\n\t         */\n\t    \n\t        /**\n\t         * Constructs a new UndecodedSeconds.\n\t         * @exports UndecodedSeconds\n\t         * @classdesc Represents an UndecodedSeconds.\n\t         * @implements IUndecodedSeconds\n\t         * @constructor\n\t         * @param {IUndecodedSeconds=} [properties] Properties to set\n\t         */\n\t        function UndecodedSeconds(properties) {\n\t            if (properties)\n\t                for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i)\n\t                    if (properties[keys[i]] != null)\n\t                        this[keys[i]] = properties[keys[i]];\n\t        }\n\t    \n\t        /**\n\t         * UndecodedSeconds undecodedSeconds.\n\t         * @member {number} undecodedSeconds\n\t         * @memberof UndecodedSeconds\n\t         * @instance\n\t         */\n\t        UndecodedSeconds.prototype.undecodedSeconds = 0;\n\t    \n\t        /**\n\t         * Decodes an UndecodedSeconds message from the specified reader or buffer.\n\t         * @function decode\n\t         * @memberof UndecodedSeconds\n\t         * @static\n\t         * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n\t         * @param {number} [length] Message length if known beforehand\n\t         * @returns {UndecodedSeconds} UndecodedSeconds\n\t         * @throws {Error} If the payload is not a reader or valid buffer\n\t         * @throws {$protobuf.util.ProtocolError} If required fields are missing\n\t         */\n\t        UndecodedSeconds.decode = function decode(reader, length) {\n\t            if (!(reader instanceof $Reader))\n\t                reader = $Reader.create(reader);\n\t            var end = length === undefined ? reader.len : reader.pos + length, message = new $root.UndecodedSeconds();\n\t            while (reader.pos < end) {\n\t                var tag = reader.uint32();\n\t                switch (tag >>> 3) {\n\t                case 1: {\n\t                        message.undecodedSeconds = reader.float();\n\t                        break;\n\t                    }\n\t                default:\n\t                    reader.skipType(tag & 7);\n\t                    break;\n\t                }\n\t            }\n\t            return message;\n\t        };\n\t    \n\t        return UndecodedSeconds;\n\t    })();\n\t    \n\t    $root.FullyFinalized = (function() {\n\t    \n\t        /**\n\t         * Properties of a FullyFinalized.\n\t         * @exports IFullyFinalized\n\t         * @interface IFullyFinalized\n\t         */\n\t    \n\t        /**\n\t         * Constructs a new FullyFinalized.\n\t         * @exports FullyFinalized\n\t         * @classdesc Represents a FullyFinalized.\n\t         * @implements IFullyFinalized\n\t         * @constructor\n\t         * @param {IFullyFinalized=} [properties] Properties to set\n\t         */\n\t        function FullyFinalized(properties) {\n\t            if (properties)\n\t                for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i)\n\t                    if (properties[keys[i]] != null)\n\t                        this[keys[i]] = properties[keys[i]];\n\t        }\n\t    \n\t        /**\n\t         * Decodes a FullyFinalized message from the specified reader or buffer.\n\t         * @function decode\n\t         * @memberof FullyFinalized\n\t         * @static\n\t         * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n\t         * @param {number} [length] Message length if known beforehand\n\t         * @returns {FullyFinalized} FullyFinalized\n\t         * @throws {Error} If the payload is not a reader or valid buffer\n\t         * @throws {$protobuf.util.ProtocolError} If required fields are missing\n\t         */\n\t        FullyFinalized.decode = function decode(reader, length) {\n\t            if (!(reader instanceof $Reader))\n\t                reader = $Reader.create(reader);\n\t            var end = length === undefined ? reader.len : reader.pos + length, message = new $root.FullyFinalized();\n\t            while (reader.pos < end) {\n\t                var tag = reader.uint32();\n\t                switch (tag >>> 3) {\n\t                default:\n\t                    reader.skipType(tag & 7);\n\t                    break;\n\t                }\n\t            }\n\t            return message;\n\t        };\n\t    \n\t        return FullyFinalized;\n\t    })();\n\t    \n\t    $root.EmotionResult = (function() {\n\t    \n\t        /**\n\t         * Properties of an EmotionResult.\n\t         * @exports IEmotionResult\n\t         * @interface IEmotionResult\n\t         * @property {string|null} [name] EmotionResult name\n\t         * @property {number|null} [confidence] EmotionResult confidence\n\t         */\n\t    \n\t        /**\n\t         * Constructs a new EmotionResult.\n\t         * @exports EmotionResult\n\t         * @classdesc Represents an EmotionResult.\n\t         * @implements IEmotionResult\n\t         * @constructor\n\t         * @param {IEmotionResult=} [properties] Properties to set\n\t         */\n\t        function EmotionResult(properties) {\n\t            if (properties)\n\t                for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i)\n\t                    if (properties[keys[i]] != null)\n\t                        this[keys[i]] = properties[keys[i]];\n\t        }\n\t    \n\t        /**\n\t         * EmotionResult name.\n\t         * @member {string} name\n\t         * @memberof EmotionResult\n\t         * @instance\n\t         */\n\t        EmotionResult.prototype.name = \"\";\n\t    \n\t        /**\n\t         * EmotionResult confidence.\n\t         * @member {number} confidence\n\t         * @memberof EmotionResult\n\t         * @instance\n\t         */\n\t        EmotionResult.prototype.confidence = 0;\n\t    \n\t        /**\n\t         * Decodes an EmotionResult message from the specified reader or buffer.\n\t         * @function decode\n\t         * @memberof EmotionResult\n\t         * @static\n\t         * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n\t         * @param {number} [length] Message length if known beforehand\n\t         * @returns {EmotionResult} EmotionResult\n\t         * @throws {Error} If the payload is not a reader or valid buffer\n\t         * @throws {$protobuf.util.ProtocolError} If required fields are missing\n\t         */\n\t        EmotionResult.decode = function decode(reader, length) {\n\t            if (!(reader instanceof $Reader))\n\t                reader = $Reader.create(reader);\n\t            var end = length === undefined ? reader.len : reader.pos + length, message = new $root.EmotionResult();\n\t            while (reader.pos < end) {\n\t                var tag = reader.uint32();\n\t                switch (tag >>> 3) {\n\t                case 1: {\n\t                        message.name = reader.string();\n\t                        break;\n\t                    }\n\t                case 2: {\n\t                        message.confidence = reader.float();\n\t                        break;\n\t                    }\n\t                default:\n\t                    reader.skipType(tag & 7);\n\t                    break;\n\t                }\n\t            }\n\t            return message;\n\t        };\n\t    \n\t        return EmotionResult;\n\t    })();\n\t    \n\t    $root.Hypothesis = (function() {\n\t    \n\t        /**\n\t         * Properties of a Hypothesis.\n\t         * @exports IHypothesis\n\t         * @interface IHypothesis\n\t         * @property {string|null} [words] Hypothesis words\n\t         * @property {number|null} [acousticCost] Hypothesis acousticCost\n\t         * @property {number|null} [linguisticCost] Hypothesis linguisticCost\n\t         * @property {number|null} [finalCost] Hypothesis finalCost\n\t         * @property {number|null} [phraseStart] Hypothesis phraseStart\n\t         * @property {number|null} [phraseEnd] Hypothesis phraseEnd\n\t         * @property {string|null} [normalizedText] Hypothesis normalizedText\n\t         */\n\t    \n\t        /**\n\t         * Constructs a new Hypothesis.\n\t         * @exports Hypothesis\n\t         * @classdesc Represents a Hypothesis.\n\t         * @implements IHypothesis\n\t         * @constructor\n\t         * @param {IHypothesis=} [properties] Properties to set\n\t         */\n\t        function Hypothesis(properties) {\n\t            if (properties)\n\t                for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i)\n\t                    if (properties[keys[i]] != null)\n\t                        this[keys[i]] = properties[keys[i]];\n\t        }\n\t    \n\t        /**\n\t         * Hypothesis words.\n\t         * @member {string} words\n\t         * @memberof Hypothesis\n\t         * @instance\n\t         */\n\t        Hypothesis.prototype.words = \"\";\n\t    \n\t        /**\n\t         * Hypothesis acousticCost.\n\t         * @member {number} acousticCost\n\t         * @memberof Hypothesis\n\t         * @instance\n\t         */\n\t        Hypothesis.prototype.acousticCost = 0;\n\t    \n\t        /**\n\t         * Hypothesis linguisticCost.\n\t         * @member {number} linguisticCost\n\t         * @memberof Hypothesis\n\t         * @instance\n\t         */\n\t        Hypothesis.prototype.linguisticCost = 0;\n\t    \n\t        /**\n\t         * Hypothesis finalCost.\n\t         * @member {number} finalCost\n\t         * @memberof Hypothesis\n\t         * @instance\n\t         */\n\t        Hypothesis.prototype.finalCost = 0;\n\t    \n\t        /**\n\t         * Hypothesis phraseStart.\n\t         * @member {number} phraseStart\n\t         * @memberof Hypothesis\n\t         * @instance\n\t         */\n\t        Hypothesis.prototype.phraseStart = 0;\n\t    \n\t        /**\n\t         * Hypothesis phraseEnd.\n\t         * @member {number} phraseEnd\n\t         * @memberof Hypothesis\n\t         * @instance\n\t         */\n\t        Hypothesis.prototype.phraseEnd = 0;\n\t    \n\t        /**\n\t         * Hypothesis normalizedText.\n\t         * @member {string} normalizedText\n\t         * @memberof Hypothesis\n\t         * @instance\n\t         */\n\t        Hypothesis.prototype.normalizedText = \"\";\n\t    \n\t        /**\n\t         * Decodes a Hypothesis message from the specified reader or buffer.\n\t         * @function decode\n\t         * @memberof Hypothesis\n\t         * @static\n\t         * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n\t         * @param {number} [length] Message length if known beforehand\n\t         * @returns {Hypothesis} Hypothesis\n\t         * @throws {Error} If the payload is not a reader or valid buffer\n\t         * @throws {$protobuf.util.ProtocolError} If required fields are missing\n\t         */\n\t        Hypothesis.decode = function decode(reader, length) {\n\t            if (!(reader instanceof $Reader))\n\t                reader = $Reader.create(reader);\n\t            var end = length === undefined ? reader.len : reader.pos + length, message = new $root.Hypothesis();\n\t            while (reader.pos < end) {\n\t                var tag = reader.uint32();\n\t                switch (tag >>> 3) {\n\t                case 1: {\n\t                        message.words = reader.string();\n\t                        break;\n\t                    }\n\t                case 2: {\n\t                        message.acousticCost = reader.float();\n\t                        break;\n\t                    }\n\t                case 3: {\n\t                        message.linguisticCost = reader.float();\n\t                        break;\n\t                    }\n\t                case 4: {\n\t                        message.finalCost = reader.float();\n\t                        break;\n\t                    }\n\t                case 5: {\n\t                        message.phraseStart = reader.float();\n\t                        break;\n\t                    }\n\t                case 6: {\n\t                        message.phraseEnd = reader.float();\n\t                        break;\n\t                    }\n\t                case 7: {\n\t                        message.normalizedText = reader.string();\n\t                        break;\n\t                    }\n\t                default:\n\t                    reader.skipType(tag & 7);\n\t                    break;\n\t                }\n\t            }\n\t            return message;\n\t        };\n\t    \n\t        return Hypothesis;\n\t    })();\n\t    \n\t    $root.DecoderResult = (function() {\n\t    \n\t        /**\n\t         * Properties of a DecoderResult.\n\t         * @exports IDecoderResult\n\t         * @interface IDecoderResult\n\t         * @property {Array.<IHypothesis>|null} [hypothesis] DecoderResult hypothesis\n\t         * @property {number|null} [chunkStart] DecoderResult chunkStart\n\t         * @property {number|null} [chunkEnd] DecoderResult chunkEnd\n\t         * @property {number|null} [timeEndpointDetectionMs] DecoderResult timeEndpointDetectionMs\n\t         * @property {number|null} [timeDecodingMs] DecoderResult timeDecodingMs\n\t         * @property {IVariables|null} [variables] DecoderResult variables\n\t         * @property {boolean|null} [isFinal] DecoderResult isFinal\n\t         * @property {Array.<IEmotionResult>|null} [emotionResult] DecoderResult emotionResult\n\t         * @property {Array.<DecoderResult.IContextAnswer>|null} [contextAnswer] DecoderResult contextAnswer\n\t         */\n\t    \n\t        /**\n\t         * Constructs a new DecoderResult.\n\t         * @exports DecoderResult\n\t         * @classdesc Represents a DecoderResult.\n\t         * @implements IDecoderResult\n\t         * @constructor\n\t         * @param {IDecoderResult=} [properties] Properties to set\n\t         */\n\t        function DecoderResult(properties) {\n\t            this.hypothesis = [];\n\t            this.emotionResult = [];\n\t            this.contextAnswer = [];\n\t            if (properties)\n\t                for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i)\n\t                    if (properties[keys[i]] != null)\n\t                        this[keys[i]] = properties[keys[i]];\n\t        }\n\t    \n\t        /**\n\t         * DecoderResult hypothesis.\n\t         * @member {Array.<IHypothesis>} hypothesis\n\t         * @memberof DecoderResult\n\t         * @instance\n\t         */\n\t        DecoderResult.prototype.hypothesis = $util.emptyArray;\n\t    \n\t        /**\n\t         * DecoderResult chunkStart.\n\t         * @member {number} chunkStart\n\t         * @memberof DecoderResult\n\t         * @instance\n\t         */\n\t        DecoderResult.prototype.chunkStart = 0;\n\t    \n\t        /**\n\t         * DecoderResult chunkEnd.\n\t         * @member {number} chunkEnd\n\t         * @memberof DecoderResult\n\t         * @instance\n\t         */\n\t        DecoderResult.prototype.chunkEnd = 0;\n\t    \n\t        /**\n\t         * DecoderResult timeEndpointDetectionMs.\n\t         * @member {number} timeEndpointDetectionMs\n\t         * @memberof DecoderResult\n\t         * @instance\n\t         */\n\t        DecoderResult.prototype.timeEndpointDetectionMs = 0;\n\t    \n\t        /**\n\t         * DecoderResult timeDecodingMs.\n\t         * @member {number} timeDecodingMs\n\t         * @memberof DecoderResult\n\t         * @instance\n\t         */\n\t        DecoderResult.prototype.timeDecodingMs = 0;\n\t    \n\t        /**\n\t         * DecoderResult variables.\n\t         * @member {IVariables|null|undefined} variables\n\t         * @memberof DecoderResult\n\t         * @instance\n\t         */\n\t        DecoderResult.prototype.variables = null;\n\t    \n\t        /**\n\t         * DecoderResult isFinal.\n\t         * @member {boolean} isFinal\n\t         * @memberof DecoderResult\n\t         * @instance\n\t         */\n\t        DecoderResult.prototype.isFinal = false;\n\t    \n\t        /**\n\t         * DecoderResult emotionResult.\n\t         * @member {Array.<IEmotionResult>} emotionResult\n\t         * @memberof DecoderResult\n\t         * @instance\n\t         */\n\t        DecoderResult.prototype.emotionResult = $util.emptyArray;\n\t    \n\t        /**\n\t         * DecoderResult contextAnswer.\n\t         * @member {Array.<DecoderResult.IContextAnswer>} contextAnswer\n\t         * @memberof DecoderResult\n\t         * @instance\n\t         */\n\t        DecoderResult.prototype.contextAnswer = $util.emptyArray;\n\t    \n\t        /**\n\t         * Decodes a DecoderResult message from the specified reader or buffer.\n\t         * @function decode\n\t         * @memberof DecoderResult\n\t         * @static\n\t         * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n\t         * @param {number} [length] Message length if known beforehand\n\t         * @returns {DecoderResult} DecoderResult\n\t         * @throws {Error} If the payload is not a reader or valid buffer\n\t         * @throws {$protobuf.util.ProtocolError} If required fields are missing\n\t         */\n\t        DecoderResult.decode = function decode(reader, length) {\n\t            if (!(reader instanceof $Reader))\n\t                reader = $Reader.create(reader);\n\t            var end = length === undefined ? reader.len : reader.pos + length, message = new $root.DecoderResult();\n\t            while (reader.pos < end) {\n\t                var tag = reader.uint32();\n\t                switch (tag >>> 3) {\n\t                case 1: {\n\t                        if (!(message.hypothesis && message.hypothesis.length))\n\t                            message.hypothesis = [];\n\t                        message.hypothesis.push($root.Hypothesis.decode(reader, reader.uint32()));\n\t                        break;\n\t                    }\n\t                case 2: {\n\t                        message.chunkStart = reader.float();\n\t                        break;\n\t                    }\n\t                case 3: {\n\t                        message.chunkEnd = reader.float();\n\t                        break;\n\t                    }\n\t                case 4: {\n\t                        message.timeEndpointDetectionMs = reader.float();\n\t                        break;\n\t                    }\n\t                case 5: {\n\t                        message.timeDecodingMs = reader.float();\n\t                        break;\n\t                    }\n\t                case 6: {\n\t                        message.variables = $root.Variables.decode(reader, reader.uint32());\n\t                        break;\n\t                    }\n\t                case 7: {\n\t                        message.isFinal = reader.bool();\n\t                        break;\n\t                    }\n\t                case 8: {\n\t                        if (!(message.emotionResult && message.emotionResult.length))\n\t                            message.emotionResult = [];\n\t                        message.emotionResult.push($root.EmotionResult.decode(reader, reader.uint32()));\n\t                        break;\n\t                    }\n\t                case 9: {\n\t                        if (!(message.contextAnswer && message.contextAnswer.length))\n\t                            message.contextAnswer = [];\n\t                        message.contextAnswer.push($root.DecoderResult.ContextAnswer.decode(reader, reader.uint32()));\n\t                        break;\n\t                    }\n\t                default:\n\t                    reader.skipType(tag & 7);\n\t                    break;\n\t                }\n\t            }\n\t            return message;\n\t        };\n\t    \n\t        DecoderResult.ContextAnswer = (function() {\n\t    \n\t            /**\n\t             * Properties of a ContextAnswer.\n\t             * @memberof DecoderResult\n\t             * @interface IContextAnswer\n\t             * @property {Array.<DecoderResult.ContextAnswer.IContextRef>|null} [contextResult] ContextAnswer contextResult\n\t             */\n\t    \n\t            /**\n\t             * Constructs a new ContextAnswer.\n\t             * @memberof DecoderResult\n\t             * @classdesc Represents a ContextAnswer.\n\t             * @implements IContextAnswer\n\t             * @constructor\n\t             * @param {DecoderResult.IContextAnswer=} [properties] Properties to set\n\t             */\n\t            function ContextAnswer(properties) {\n\t                this.contextResult = [];\n\t                if (properties)\n\t                    for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i)\n\t                        if (properties[keys[i]] != null)\n\t                            this[keys[i]] = properties[keys[i]];\n\t            }\n\t    \n\t            /**\n\t             * ContextAnswer contextResult.\n\t             * @member {Array.<DecoderResult.ContextAnswer.IContextRef>} contextResult\n\t             * @memberof DecoderResult.ContextAnswer\n\t             * @instance\n\t             */\n\t            ContextAnswer.prototype.contextResult = $util.emptyArray;\n\t    \n\t            /**\n\t             * Decodes a ContextAnswer message from the specified reader or buffer.\n\t             * @function decode\n\t             * @memberof DecoderResult.ContextAnswer\n\t             * @static\n\t             * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n\t             * @param {number} [length] Message length if known beforehand\n\t             * @returns {DecoderResult.ContextAnswer} ContextAnswer\n\t             * @throws {Error} If the payload is not a reader or valid buffer\n\t             * @throws {$protobuf.util.ProtocolError} If required fields are missing\n\t             */\n\t            ContextAnswer.decode = function decode(reader, length) {\n\t                if (!(reader instanceof $Reader))\n\t                    reader = $Reader.create(reader);\n\t                var end = length === undefined ? reader.len : reader.pos + length, message = new $root.DecoderResult.ContextAnswer();\n\t                while (reader.pos < end) {\n\t                    var tag = reader.uint32();\n\t                    switch (tag >>> 3) {\n\t                    case 1: {\n\t                            if (!(message.contextResult && message.contextResult.length))\n\t                                message.contextResult = [];\n\t                            message.contextResult.push($root.DecoderResult.ContextAnswer.ContextRef.decode(reader, reader.uint32()));\n\t                            break;\n\t                        }\n\t                    default:\n\t                        reader.skipType(tag & 7);\n\t                        break;\n\t                    }\n\t                }\n\t                return message;\n\t            };\n\t    \n\t            ContextAnswer.ContextRef = (function() {\n\t    \n\t                /**\n\t                 * Properties of a ContextRef.\n\t                 * @memberof DecoderResult.ContextAnswer\n\t                 * @interface IContextRef\n\t                 * @property {string|null} [id] ContextRef id\n\t                 * @property {number|null} [index] ContextRef index\n\t                 * @property {string|null} [originalValue] ContextRef originalValue\n\t                 * @property {string|null} [predictedValue] ContextRef predictedValue\n\t                 * @property {number|null} [score] ContextRef score\n\t                 */\n\t    \n\t                /**\n\t                 * Constructs a new ContextRef.\n\t                 * @memberof DecoderResult.ContextAnswer\n\t                 * @classdesc Represents a ContextRef.\n\t                 * @implements IContextRef\n\t                 * @constructor\n\t                 * @param {DecoderResult.ContextAnswer.IContextRef=} [properties] Properties to set\n\t                 */\n\t                function ContextRef(properties) {\n\t                    if (properties)\n\t                        for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i)\n\t                            if (properties[keys[i]] != null)\n\t                                this[keys[i]] = properties[keys[i]];\n\t                }\n\t    \n\t                /**\n\t                 * ContextRef id.\n\t                 * @member {string} id\n\t                 * @memberof DecoderResult.ContextAnswer.ContextRef\n\t                 * @instance\n\t                 */\n\t                ContextRef.prototype.id = \"\";\n\t    \n\t                /**\n\t                 * ContextRef index.\n\t                 * @member {number} index\n\t                 * @memberof DecoderResult.ContextAnswer.ContextRef\n\t                 * @instance\n\t                 */\n\t                ContextRef.prototype.index = 0;\n\t    \n\t                /**\n\t                 * ContextRef originalValue.\n\t                 * @member {string} originalValue\n\t                 * @memberof DecoderResult.ContextAnswer.ContextRef\n\t                 * @instance\n\t                 */\n\t                ContextRef.prototype.originalValue = \"\";\n\t    \n\t                /**\n\t                 * ContextRef predictedValue.\n\t                 * @member {string} predictedValue\n\t                 * @memberof DecoderResult.ContextAnswer.ContextRef\n\t                 * @instance\n\t                 */\n\t                ContextRef.prototype.predictedValue = \"\";\n\t    \n\t                /**\n\t                 * ContextRef score.\n\t                 * @member {number} score\n\t                 * @memberof DecoderResult.ContextAnswer.ContextRef\n\t                 * @instance\n\t                 */\n\t                ContextRef.prototype.score = 0;\n\t    \n\t                /**\n\t                 * Decodes a ContextRef message from the specified reader or buffer.\n\t                 * @function decode\n\t                 * @memberof DecoderResult.ContextAnswer.ContextRef\n\t                 * @static\n\t                 * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n\t                 * @param {number} [length] Message length if known beforehand\n\t                 * @returns {DecoderResult.ContextAnswer.ContextRef} ContextRef\n\t                 * @throws {Error} If the payload is not a reader or valid buffer\n\t                 * @throws {$protobuf.util.ProtocolError} If required fields are missing\n\t                 */\n\t                ContextRef.decode = function decode(reader, length) {\n\t                    if (!(reader instanceof $Reader))\n\t                        reader = $Reader.create(reader);\n\t                    var end = length === undefined ? reader.len : reader.pos + length, message = new $root.DecoderResult.ContextAnswer.ContextRef();\n\t                    while (reader.pos < end) {\n\t                        var tag = reader.uint32();\n\t                        switch (tag >>> 3) {\n\t                        case 1: {\n\t                                message.id = reader.string();\n\t                                break;\n\t                            }\n\t                        case 2: {\n\t                                message.index = reader.int32();\n\t                                break;\n\t                            }\n\t                        case 3: {\n\t                                message.originalValue = reader.string();\n\t                                break;\n\t                            }\n\t                        case 4: {\n\t                                message.predictedValue = reader.string();\n\t                                break;\n\t                            }\n\t                        case 5: {\n\t                                message.score = reader.float();\n\t                                break;\n\t                            }\n\t                        default:\n\t                            reader.skipType(tag & 7);\n\t                            break;\n\t                        }\n\t                    }\n\t                    return message;\n\t                };\n\t    \n\t                return ContextRef;\n\t            })();\n\t    \n\t            return ContextAnswer;\n\t        })();\n\t    \n\t        return DecoderResult;\n\t    })();\n\t    \n\t    $root.ErrorResponse = (function() {\n\t    \n\t        /**\n\t         * Properties of an ErrorResponse.\n\t         * @exports IErrorResponse\n\t         * @interface IErrorResponse\n\t         * @property {string|null} [errorMessage] ErrorResponse errorMessage\n\t         */\n\t    \n\t        /**\n\t         * Constructs a new ErrorResponse.\n\t         * @exports ErrorResponse\n\t         * @classdesc Represents an ErrorResponse.\n\t         * @implements IErrorResponse\n\t         * @constructor\n\t         * @param {IErrorResponse=} [properties] Properties to set\n\t         */\n\t        function ErrorResponse(properties) {\n\t            if (properties)\n\t                for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i)\n\t                    if (properties[keys[i]] != null)\n\t                        this[keys[i]] = properties[keys[i]];\n\t        }\n\t    \n\t        /**\n\t         * ErrorResponse errorMessage.\n\t         * @member {string} errorMessage\n\t         * @memberof ErrorResponse\n\t         * @instance\n\t         */\n\t        ErrorResponse.prototype.errorMessage = \"\";\n\t    \n\t        /**\n\t         * Decodes an ErrorResponse message from the specified reader or buffer.\n\t         * @function decode\n\t         * @memberof ErrorResponse\n\t         * @static\n\t         * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n\t         * @param {number} [length] Message length if known beforehand\n\t         * @returns {ErrorResponse} ErrorResponse\n\t         * @throws {Error} If the payload is not a reader or valid buffer\n\t         * @throws {$protobuf.util.ProtocolError} If required fields are missing\n\t         */\n\t        ErrorResponse.decode = function decode(reader, length) {\n\t            if (!(reader instanceof $Reader))\n\t                reader = $Reader.create(reader);\n\t            var end = length === undefined ? reader.len : reader.pos + length, message = new $root.ErrorResponse();\n\t            while (reader.pos < end) {\n\t                var tag = reader.uint32();\n\t                switch (tag >>> 3) {\n\t                case 1: {\n\t                        message.errorMessage = reader.string();\n\t                        break;\n\t                    }\n\t                default:\n\t                    reader.skipType(tag & 7);\n\t                    break;\n\t                }\n\t            }\n\t            return message;\n\t        };\n\t    \n\t        return ErrorResponse;\n\t    })();\n\t    \n\t    $root.PacketWrapperFromServer = (function() {\n\t    \n\t        /**\n\t         * Properties of a PacketWrapperFromServer.\n\t         * @exports IPacketWrapperFromServer\n\t         * @interface IPacketWrapperFromServer\n\t         * @property {IUndecodedSeconds|null} [undecodedSecondsField] PacketWrapperFromServer undecodedSecondsField\n\t         * @property {IFullyFinalized|null} [fullyFinalizedField] PacketWrapperFromServer fullyFinalizedField\n\t         * @property {IDecoderResult|null} [decoderResultField] PacketWrapperFromServer decoderResultField\n\t         * @property {IErrorResponse|null} [errorResponse] PacketWrapperFromServer errorResponse\n\t         */\n\t    \n\t        /**\n\t         * Constructs a new PacketWrapperFromServer.\n\t         * @exports PacketWrapperFromServer\n\t         * @classdesc Represents a PacketWrapperFromServer.\n\t         * @implements IPacketWrapperFromServer\n\t         * @constructor\n\t         * @param {IPacketWrapperFromServer=} [properties] Properties to set\n\t         */\n\t        function PacketWrapperFromServer(properties) {\n\t            if (properties)\n\t                for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i)\n\t                    if (properties[keys[i]] != null)\n\t                        this[keys[i]] = properties[keys[i]];\n\t        }\n\t    \n\t        /**\n\t         * PacketWrapperFromServer undecodedSecondsField.\n\t         * @member {IUndecodedSeconds|null|undefined} undecodedSecondsField\n\t         * @memberof PacketWrapperFromServer\n\t         * @instance\n\t         */\n\t        PacketWrapperFromServer.prototype.undecodedSecondsField = null;\n\t    \n\t        /**\n\t         * PacketWrapperFromServer fullyFinalizedField.\n\t         * @member {IFullyFinalized|null|undefined} fullyFinalizedField\n\t         * @memberof PacketWrapperFromServer\n\t         * @instance\n\t         */\n\t        PacketWrapperFromServer.prototype.fullyFinalizedField = null;\n\t    \n\t        /**\n\t         * PacketWrapperFromServer decoderResultField.\n\t         * @member {IDecoderResult|null|undefined} decoderResultField\n\t         * @memberof PacketWrapperFromServer\n\t         * @instance\n\t         */\n\t        PacketWrapperFromServer.prototype.decoderResultField = null;\n\t    \n\t        /**\n\t         * PacketWrapperFromServer errorResponse.\n\t         * @member {IErrorResponse|null|undefined} errorResponse\n\t         * @memberof PacketWrapperFromServer\n\t         * @instance\n\t         */\n\t        PacketWrapperFromServer.prototype.errorResponse = null;\n\t    \n\t        // OneOf field names bound to virtual getters and setters\n\t        var $oneOfFields;\n\t    \n\t        /**\n\t         * PacketWrapperFromServer MessageType.\n\t         * @member {\"undecodedSecondsField\"|\"fullyFinalizedField\"|\"decoderResultField\"|\"errorResponse\"|undefined} MessageType\n\t         * @memberof PacketWrapperFromServer\n\t         * @instance\n\t         */\n\t        Object.defineProperty(PacketWrapperFromServer.prototype, \"MessageType\", {\n\t            get: $util.oneOfGetter($oneOfFields = [\"undecodedSecondsField\", \"fullyFinalizedField\", \"decoderResultField\", \"errorResponse\"]),\n\t            set: $util.oneOfSetter($oneOfFields)\n\t        });\n\t    \n\t        /**\n\t         * Decodes a PacketWrapperFromServer message from the specified reader or buffer.\n\t         * @function decode\n\t         * @memberof PacketWrapperFromServer\n\t         * @static\n\t         * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n\t         * @param {number} [length] Message length if known beforehand\n\t         * @returns {PacketWrapperFromServer} PacketWrapperFromServer\n\t         * @throws {Error} If the payload is not a reader or valid buffer\n\t         * @throws {$protobuf.util.ProtocolError} If required fields are missing\n\t         */\n\t        PacketWrapperFromServer.decode = function decode(reader, length) {\n\t            if (!(reader instanceof $Reader))\n\t                reader = $Reader.create(reader);\n\t            var end = length === undefined ? reader.len : reader.pos + length, message = new $root.PacketWrapperFromServer();\n\t            while (reader.pos < end) {\n\t                var tag = reader.uint32();\n\t                switch (tag >>> 3) {\n\t                case 1: {\n\t                        message.undecodedSecondsField = $root.UndecodedSeconds.decode(reader, reader.uint32());\n\t                        break;\n\t                    }\n\t                case 2: {\n\t                        message.fullyFinalizedField = $root.FullyFinalized.decode(reader, reader.uint32());\n\t                        break;\n\t                    }\n\t                case 4: {\n\t                        message.decoderResultField = $root.DecoderResult.decode(reader, reader.uint32());\n\t                        break;\n\t                    }\n\t                case 8: {\n\t                        message.errorResponse = $root.ErrorResponse.decode(reader, reader.uint32());\n\t                        break;\n\t                    }\n\t                default:\n\t                    reader.skipType(tag & 7);\n\t                    break;\n\t                }\n\t            }\n\t            return message;\n\t        };\n\t    \n\t        return PacketWrapperFromServer;\n\t    })();\n\n\t    return $root;\n\t}); \n} (asr));\n\nvar asrExports = asr.exports;\n\nvar mtt = {exports: {}};\n\n/*eslint-disable block-scoped-var, id-length, no-control-regex, no-magic-numbers, no-prototype-builtins, no-redeclare, no-shadow, no-var, sort-vars*/\n\n(function (module) {\n\t(function(global, factory) { /* global define, require, module */\n\n\t    /* AMD */ if (typeof commonjsRequire === 'function' && 'object' === 'object' && module && module.exports)\n\t        module.exports = factory(requireMinimal());\n\n\t})(commonjsGlobal, function($protobuf) {\n\n\t    // Common aliases\n\t    var $Reader = $protobuf.Reader, $util = $protobuf.util;\n\t    \n\t    // Exported root namespace\n\t    var $root = $protobuf.roots[\"default\"] || ($protobuf.roots[\"default\"] = {});\n\t    \n\t    $root.Music2TrackProtocol = (function() {\n\t    \n\t        /**\n\t         * Namespace Music2TrackProtocol.\n\t         * @exports Music2TrackProtocol\n\t         * @namespace\n\t         */\n\t        var Music2TrackProtocol = {};\n\t    \n\t        Music2TrackProtocol.DecoderResult = (function() {\n\t    \n\t            /**\n\t             * Properties of a DecoderResult.\n\t             * @memberof Music2TrackProtocol\n\t             * @interface IDecoderResult\n\t             * @property {string|null} [result] DecoderResult result\n\t             * @property {boolean|null} [isMusicFound] DecoderResult isMusicFound\n\t             * @property {boolean|null} [isFinal] DecoderResult isFinal\n\t             */\n\t    \n\t            /**\n\t             * Constructs a new DecoderResult.\n\t             * @memberof Music2TrackProtocol\n\t             * @classdesc Represents a DecoderResult.\n\t             * @implements IDecoderResult\n\t             * @constructor\n\t             * @param {Music2TrackProtocol.IDecoderResult=} [properties] Properties to set\n\t             */\n\t            function DecoderResult(properties) {\n\t                if (properties)\n\t                    for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i)\n\t                        if (properties[keys[i]] != null)\n\t                            this[keys[i]] = properties[keys[i]];\n\t            }\n\t    \n\t            /**\n\t             * DecoderResult result.\n\t             * @member {string} result\n\t             * @memberof Music2TrackProtocol.DecoderResult\n\t             * @instance\n\t             */\n\t            DecoderResult.prototype.result = \"\";\n\t    \n\t            /**\n\t             * DecoderResult isMusicFound.\n\t             * @member {boolean} isMusicFound\n\t             * @memberof Music2TrackProtocol.DecoderResult\n\t             * @instance\n\t             */\n\t            DecoderResult.prototype.isMusicFound = false;\n\t    \n\t            /**\n\t             * DecoderResult isFinal.\n\t             * @member {boolean} isFinal\n\t             * @memberof Music2TrackProtocol.DecoderResult\n\t             * @instance\n\t             */\n\t            DecoderResult.prototype.isFinal = false;\n\t    \n\t            /**\n\t             * Decodes a DecoderResult message from the specified reader or buffer.\n\t             * @function decode\n\t             * @memberof Music2TrackProtocol.DecoderResult\n\t             * @static\n\t             * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n\t             * @param {number} [length] Message length if known beforehand\n\t             * @returns {Music2TrackProtocol.DecoderResult} DecoderResult\n\t             * @throws {Error} If the payload is not a reader or valid buffer\n\t             * @throws {$protobuf.util.ProtocolError} If required fields are missing\n\t             */\n\t            DecoderResult.decode = function decode(reader, length) {\n\t                if (!(reader instanceof $Reader))\n\t                    reader = $Reader.create(reader);\n\t                var end = length === undefined ? reader.len : reader.pos + length, message = new $root.Music2TrackProtocol.DecoderResult();\n\t                while (reader.pos < end) {\n\t                    var tag = reader.uint32();\n\t                    switch (tag >>> 3) {\n\t                    case 1: {\n\t                            message.result = reader.string();\n\t                            break;\n\t                        }\n\t                    case 2: {\n\t                            message.isMusicFound = reader.bool();\n\t                            break;\n\t                        }\n\t                    case 3: {\n\t                            message.isFinal = reader.bool();\n\t                            break;\n\t                        }\n\t                    default:\n\t                        reader.skipType(tag & 7);\n\t                        break;\n\t                    }\n\t                }\n\t                return message;\n\t            };\n\t    \n\t            return DecoderResult;\n\t        })();\n\t    \n\t        Music2TrackProtocol.ErrorResponse = (function() {\n\t    \n\t            /**\n\t             * Properties of an ErrorResponse.\n\t             * @memberof Music2TrackProtocol\n\t             * @interface IErrorResponse\n\t             * @property {string|null} [errorMessage] ErrorResponse errorMessage\n\t             * @property {number|null} [errorCode] ErrorResponse errorCode\n\t             */\n\t    \n\t            /**\n\t             * Constructs a new ErrorResponse.\n\t             * @memberof Music2TrackProtocol\n\t             * @classdesc Represents an ErrorResponse.\n\t             * @implements IErrorResponse\n\t             * @constructor\n\t             * @param {Music2TrackProtocol.IErrorResponse=} [properties] Properties to set\n\t             */\n\t            function ErrorResponse(properties) {\n\t                if (properties)\n\t                    for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i)\n\t                        if (properties[keys[i]] != null)\n\t                            this[keys[i]] = properties[keys[i]];\n\t            }\n\t    \n\t            /**\n\t             * ErrorResponse errorMessage.\n\t             * @member {string} errorMessage\n\t             * @memberof Music2TrackProtocol.ErrorResponse\n\t             * @instance\n\t             */\n\t            ErrorResponse.prototype.errorMessage = \"\";\n\t    \n\t            /**\n\t             * ErrorResponse errorCode.\n\t             * @member {number} errorCode\n\t             * @memberof Music2TrackProtocol.ErrorResponse\n\t             * @instance\n\t             */\n\t            ErrorResponse.prototype.errorCode = 0;\n\t    \n\t            /**\n\t             * Decodes an ErrorResponse message from the specified reader or buffer.\n\t             * @function decode\n\t             * @memberof Music2TrackProtocol.ErrorResponse\n\t             * @static\n\t             * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n\t             * @param {number} [length] Message length if known beforehand\n\t             * @returns {Music2TrackProtocol.ErrorResponse} ErrorResponse\n\t             * @throws {Error} If the payload is not a reader or valid buffer\n\t             * @throws {$protobuf.util.ProtocolError} If required fields are missing\n\t             */\n\t            ErrorResponse.decode = function decode(reader, length) {\n\t                if (!(reader instanceof $Reader))\n\t                    reader = $Reader.create(reader);\n\t                var end = length === undefined ? reader.len : reader.pos + length, message = new $root.Music2TrackProtocol.ErrorResponse();\n\t                while (reader.pos < end) {\n\t                    var tag = reader.uint32();\n\t                    switch (tag >>> 3) {\n\t                    case 1: {\n\t                            message.errorMessage = reader.string();\n\t                            break;\n\t                        }\n\t                    case 2: {\n\t                            message.errorCode = reader.int32();\n\t                            break;\n\t                        }\n\t                    default:\n\t                        reader.skipType(tag & 7);\n\t                        break;\n\t                    }\n\t                }\n\t                return message;\n\t            };\n\t    \n\t            return ErrorResponse;\n\t        })();\n\t    \n\t        Music2TrackProtocol.MttResponse = (function() {\n\t    \n\t            /**\n\t             * Properties of a MttResponse.\n\t             * @memberof Music2TrackProtocol\n\t             * @interface IMttResponse\n\t             * @property {Music2TrackProtocol.IDecoderResult|null} [decoderResultField] MttResponse decoderResultField\n\t             * @property {Music2TrackProtocol.IErrorResponse|null} [errorResponse] MttResponse errorResponse\n\t             */\n\t    \n\t            /**\n\t             * Constructs a new MttResponse.\n\t             * @memberof Music2TrackProtocol\n\t             * @classdesc Represents a MttResponse.\n\t             * @implements IMttResponse\n\t             * @constructor\n\t             * @param {Music2TrackProtocol.IMttResponse=} [properties] Properties to set\n\t             */\n\t            function MttResponse(properties) {\n\t                if (properties)\n\t                    for (var keys = Object.keys(properties), i = 0; i < keys.length; ++i)\n\t                        if (properties[keys[i]] != null)\n\t                            this[keys[i]] = properties[keys[i]];\n\t            }\n\t    \n\t            /**\n\t             * MttResponse decoderResultField.\n\t             * @member {Music2TrackProtocol.IDecoderResult|null|undefined} decoderResultField\n\t             * @memberof Music2TrackProtocol.MttResponse\n\t             * @instance\n\t             */\n\t            MttResponse.prototype.decoderResultField = null;\n\t    \n\t            /**\n\t             * MttResponse errorResponse.\n\t             * @member {Music2TrackProtocol.IErrorResponse|null|undefined} errorResponse\n\t             * @memberof Music2TrackProtocol.MttResponse\n\t             * @instance\n\t             */\n\t            MttResponse.prototype.errorResponse = null;\n\t    \n\t            // OneOf field names bound to virtual getters and setters\n\t            var $oneOfFields;\n\t    \n\t            /**\n\t             * MttResponse MessageType.\n\t             * @member {\"decoderResultField\"|\"errorResponse\"|undefined} MessageType\n\t             * @memberof Music2TrackProtocol.MttResponse\n\t             * @instance\n\t             */\n\t            Object.defineProperty(MttResponse.prototype, \"MessageType\", {\n\t                get: $util.oneOfGetter($oneOfFields = [\"decoderResultField\", \"errorResponse\"]),\n\t                set: $util.oneOfSetter($oneOfFields)\n\t            });\n\t    \n\t            /**\n\t             * Decodes a MttResponse message from the specified reader or buffer.\n\t             * @function decode\n\t             * @memberof Music2TrackProtocol.MttResponse\n\t             * @static\n\t             * @param {$protobuf.Reader|Uint8Array} reader Reader or buffer to decode from\n\t             * @param {number} [length] Message length if known beforehand\n\t             * @returns {Music2TrackProtocol.MttResponse} MttResponse\n\t             * @throws {Error} If the payload is not a reader or valid buffer\n\t             * @throws {$protobuf.util.ProtocolError} If required fields are missing\n\t             */\n\t            MttResponse.decode = function decode(reader, length) {\n\t                if (!(reader instanceof $Reader))\n\t                    reader = $Reader.create(reader);\n\t                var end = length === undefined ? reader.len : reader.pos + length, message = new $root.Music2TrackProtocol.MttResponse();\n\t                while (reader.pos < end) {\n\t                    var tag = reader.uint32();\n\t                    switch (tag >>> 3) {\n\t                    case 1: {\n\t                            message.decoderResultField = $root.Music2TrackProtocol.DecoderResult.decode(reader, reader.uint32());\n\t                            break;\n\t                        }\n\t                    case 2: {\n\t                            message.errorResponse = $root.Music2TrackProtocol.ErrorResponse.decode(reader, reader.uint32());\n\t                            break;\n\t                        }\n\t                    default:\n\t                        reader.skipType(tag & 7);\n\t                        break;\n\t                    }\n\t                }\n\t                return message;\n\t            };\n\t    \n\t            return MttResponse;\n\t        })();\n\t    \n\t        return Music2TrackProtocol;\n\t    })();\n\n\t    return $root;\n\t}); \n} (mtt));\n\nvar mttExports = mtt.exports;\n\nvar createClient = function (protocol, provideMeta, _a) {\n    if (provideMeta === void 0) { provideMeta = undefined; }\n    var getVoiceMeta = _a.getVoiceMeta;\n    var _b = createNanoEvents(), on = _b.on, emit = _b.emit;\n    /** ждет ответ бека и возвращает данные из этого ответа */\n    var waitForAnswer = function (messageId) {\n        return new Promise(function (resolve) {\n            var off = on('systemMessage', function (systemMessageData, originalMessage) {\n                if (originalMessage.messageId === messageId &&\n                    (originalMessage.messageName === MessageNames.ANSWER_TO_USER ||\n                        originalMessage.messageName === MessageNames.DO_NOTHING)) {\n                    off();\n                    resolve(systemMessageData);\n                }\n            });\n        });\n    };\n    /** отправляет произвольный systemMessage, не подкладывает мету */\n    var sendData = function (data, messageName, meta) {\n        if (messageName === void 0) { messageName = ''; }\n        var messageId = protocol.getMessageId();\n        protocol.sendSystemMessage({\n            data: data,\n            messageName: messageName,\n        }, true, messageId, { meta: meta || {} });\n        return messageId;\n    };\n    /** отправляет cancel на сообщение */\n    var sendCancel = function (messageId) {\n        protocol.sendCancel({}, true, messageId);\n    };\n    /** отправляет приветствие */\n    var sendOpenAssistant = function (_a) {\n        var _b = _a === void 0 ? { isFirstSession: false } : _a, isFirstSession = _b.isFirstSession;\n        return __awaiter(void 0, void 0, void 0, function () {\n            var data, meta, _c;\n            return __generator(this, function (_d) {\n                switch (_d.label) {\n                    case 0:\n                        data = isFirstSession ? { is_first_session: true } : {};\n                        if (!provideMeta) return [3 /*break*/, 2];\n                        return [4 /*yield*/, provideMeta()];\n                    case 1:\n                        _c = _d.sent();\n                        return [3 /*break*/, 3];\n                    case 2:\n                        _c = undefined;\n                        _d.label = 3;\n                    case 3:\n                        meta = _c;\n                        return [2 /*return*/, waitForAnswer(sendData(data, 'OPEN_ASSISTANT', meta))];\n                }\n            });\n        });\n    };\n    /** вызывает sendSystemMessage, куда подкладывает мету */\n    var sendMeta = function (sendSystemMessage, additionalMeta) { return __awaiter(void 0, void 0, void 0, function () {\n        var meta, _a;\n        return __generator(this, function (_b) {\n            switch (_b.label) {\n                case 0:\n                    if (!provideMeta) return [3 /*break*/, 2];\n                    return [4 /*yield*/, provideMeta(additionalMeta)];\n                case 1:\n                    _a = _b.sent();\n                    return [3 /*break*/, 3];\n                case 2:\n                    _a = {};\n                    _b.label = 3;\n                case 3:\n                    meta = _a;\n                    if (typeof meta !== 'undefined') {\n                        sendSystemMessage({\n                            data: {},\n                            messageName: '',\n                        }, false, {\n                            meta: meta,\n                        });\n                    }\n                    return [2 /*return*/];\n            }\n        });\n    }); };\n    /** перестать слать озвучку для messageId */\n    var sendMute = function (messageId) {\n        protocol.sendMute({}, true, messageId);\n    };\n    /** отправляет server_action и мету */\n    var sendServerAction = function (serverAction, appInfo, messageName, mode) {\n        if (messageName === void 0) { messageName = 'SERVER_ACTION'; }\n        return __awaiter(void 0, void 0, void 0, function () {\n            var messageId;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        messageId = protocol.getMessageId();\n                        // мету и server_action отправляем в одном systemMessage\n                        return [4 /*yield*/, sendMeta(function (data, _, _a) {\n                                var _b = _a === void 0 ? {} : _a, meta = _b.meta;\n                                var systemData = __rest(data, []);\n                                protocol.sendSystemMessage({\n                                    // eslint-disable-next-line camelcase\n                                    data: __assign(__assign({}, systemData), { app_info: appInfo, server_action: serverAction, mode: mode }),\n                                    messageName: messageName || 'SERVER_ACTION',\n                                }, true, messageId, { meta: meta });\n                            }, {\n                                source: {\n                                    sourceType: 'vps',\n                                },\n                            })];\n                    case 1:\n                        // мету и server_action отправляем в одном systemMessage\n                        _a.sent();\n                        return [2 /*return*/, messageId];\n                }\n            });\n        });\n    };\n    /** отправляет текст и текущую мету */\n    var sendText = function (text, isSsml, shouldSendDisableDubbing, additionalMeta) {\n        if (isSsml === void 0) { isSsml = false; }\n        return __awaiter(void 0, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                if (text.trim() === '') {\n                    return [2 /*return*/, undefined];\n                }\n                return [2 /*return*/, protocol.batch(function (_a) {\n                        var sendSystemMessage = _a.sendSystemMessage, clientSendText = _a.sendText, sendSettings = _a.sendSettings, messageId = _a.messageId;\n                        return __awaiter(void 0, void 0, void 0, function () {\n                            var prevDubbing, sendDisableDubbing, isStillNeedReturnDubbing;\n                            return __generator(this, function (_b) {\n                                switch (_b.label) {\n                                    case 0: return [4 /*yield*/, sendMeta(sendSystemMessage, additionalMeta)];\n                                    case 1:\n                                        _b.sent();\n                                        prevDubbing = protocol.configuration.settings.dubbing;\n                                        sendDisableDubbing = prevDubbing !== -1 && shouldSendDisableDubbing;\n                                        if (!sendDisableDubbing) return [3 /*break*/, 3];\n                                        return [4 /*yield*/, sendSettings({ dubbing: -1 }, false)];\n                                    case 2:\n                                        _b.sent();\n                                        _b.label = 3;\n                                    case 3:\n                                        isSsml ? clientSendText(text, {}, 'application/ssml') : clientSendText(text, {});\n                                        isStillNeedReturnDubbing = prevDubbing === protocol.configuration.settings.dubbing;\n                                        if (sendDisableDubbing && isStillNeedReturnDubbing) {\n                                            sendSettings({ dubbing: prevDubbing });\n                                        }\n                                        return [2 /*return*/, messageId];\n                                }\n                            });\n                        });\n                    })];\n            });\n        });\n    };\n    /** инициализирует исходящий голосовой поток, факт. передает в callback параметры для отправки голоса,\n     * отправляет мету */\n    var createVoiceStream = function (callback, additionalMeta) {\n        return protocol.batch(function (_a) {\n            var sendSystemMessage = _a.sendSystemMessage, sendVoice = _a.sendVoice, messageId = _a.messageId;\n            return __awaiter(void 0, void 0, void 0, function () {\n                var first;\n                return __generator(this, function (_b) {\n                    switch (_b.label) {\n                        case 0:\n                            first = true;\n                            return [4 /*yield*/, sendMeta(sendSystemMessage, additionalMeta)];\n                        case 1:\n                            _b.sent();\n                            return [4 /*yield*/, callback({\n                                    sendVoice: function () {\n                                        var args = [];\n                                        for (var _i = 0; _i < arguments.length; _i++) {\n                                            args[_i] = arguments[_i];\n                                        }\n                                        if (first) {\n                                            // отправляем мету только в первом чанке с голосом\n                                            sendVoice(args[0], args[1], args[2], __assign(__assign({}, args[3]), { meta: getVoiceMeta() }));\n                                            first = false;\n                                            return;\n                                        }\n                                        sendVoice.apply(void 0, args);\n                                    },\n                                    messageId: messageId,\n                                })];\n                        case 2:\n                            _b.sent();\n                            return [2 /*return*/];\n                    }\n                });\n            });\n        });\n    };\n    var off = protocol.on('incoming', function (message) {\n        var _a, _b, _c, _d, _e, _f, _g, _h, _j;\n        if ((_a = message.systemMessage) === null || _a === void 0 ? void 0 : _a.data) {\n            emit('systemMessage', JSON.parse(message.systemMessage.data), message);\n        }\n        if (message.voice) {\n            emit('voice', message.voice.data || new Uint8Array(), message);\n        }\n        if (message.status) {\n            emit('status', message.status, message);\n        }\n        if (message.messageName === 'TAKE_HISTORY' && ((_b = message.bytes) === null || _b === void 0 ? void 0 : _b.data)) {\n            var history_1 = protoExports.GetHistoryResponse.decode((_c = message.bytes) === null || _c === void 0 ? void 0 : _c.data).historyMessages;\n            var parsedHistory = history_1.map(function (historyMessage) { return (__assign(__assign({}, historyMessage), { content: JSON.parse(historyMessage.content || '') })); });\n            emit('history', parsedHistory, message);\n        }\n        if (message.messageName === MessageNames.STT && (message.text || ((_e = (_d = message.bytes) === null || _d === void 0 ? void 0 : _d.data) === null || _e === void 0 ? void 0 : _e.length))) {\n            var response = ((_g = (_f = message.bytes) === null || _f === void 0 ? void 0 : _f.data) === null || _g === void 0 ? void 0 : _g.length)\n                ? asrExports.PacketWrapperFromServer.decode(message.bytes.data)\n                : undefined;\n            emit('stt', { text: message.text, response: response }, message);\n        }\n        if (message.messageName === MessageNames.MTT && ((_j = (_h = message.bytes) === null || _h === void 0 ? void 0 : _h.data) === null || _j === void 0 ? void 0 : _j.length)) {\n            emit('musicRecognition', mttExports.Music2TrackProtocol.MttResponse.decode(message.bytes.data), message);\n        }\n    });\n    return {\n        destroy: function () {\n            off();\n        },\n        init: protocol.init,\n        createVoiceStream: createVoiceStream,\n        sendData: sendData,\n        sendMeta: sendMeta,\n        sendOpenAssistant: sendOpenAssistant,\n        sendServerAction: sendServerAction,\n        sendText: sendText,\n        sendCancel: sendCancel,\n        sendMute: sendMute,\n        on: on,\n        waitForAnswer: waitForAnswer,\n    };\n};\n\nvar RETRY_INTERVAL = 300; // ms\nvar defaultWSCreator = function (url) { return new WebSocket(url); };\nvar createTransport = function (_a) {\n    var _b = _a.createWS, createWS = _b === void 0 ? defaultWSCreator : _b, checkCertUrl = _a.checkCertUrl;\n    var _c = createNanoEvents(), on = _c.on, emit = _c.emit;\n    var hasCert = !checkCertUrl;\n    var retryTimeoutId = -1;\n    var retries = 0;\n    var status = 'closed';\n    var webSocket;\n    var stopped = true;\n    var checkCert = function (checkUrl) {\n        return new Promise(function (resolve) {\n            window\n                .fetch(checkUrl)\n                .then(function () { return resolve(true); })\n                .catch(function () { return resolve(false); });\n        });\n    };\n    var close = function () {\n        stopped = true;\n        if (status === 'closing' || status === 'closed') {\n            return;\n        }\n        status = 'closing';\n        webSocket === null || webSocket === void 0 ? void 0 : webSocket.close();\n    };\n    var connect = function (url) { return __awaiter(void 0, void 0, void 0, function () {\n        var okay;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    status = 'connecting';\n                    emit('connecting');\n                    if (!(!hasCert && window.navigator.onLine)) return [3 /*break*/, 2];\n                    return [4 /*yield*/, checkCert(checkCertUrl)];\n                case 1:\n                    okay = _a.sent();\n                    if (!okay) {\n                        status = 'closed';\n                        emit('close');\n                        emit('error', new Error('Cert authority invalid'));\n                        return [2 /*return*/];\n                    }\n                    hasCert = true;\n                    _a.label = 2;\n                case 2:\n                    webSocket = createWS(url);\n                    webSocket.binaryType = 'arraybuffer';\n                    webSocket.addEventListener('open', function () {\n                        if (webSocket.readyState !== 1) {\n                            return;\n                        }\n                        window.clearTimeout(retryTimeoutId);\n                        retries = 0;\n                        status = 'open';\n                        emit('open');\n                    });\n                    webSocket.addEventListener('close', function () {\n                        status = 'closed';\n                        emit('close');\n                    });\n                    webSocket.addEventListener('error', function (e) {\n                        if (status !== 'connecting') {\n                            throw e;\n                        }\n                        // пробуем переподключаться, если возникла ошибка при коннекте\n                        if (!webSocket || (webSocket.readyState === 3 && !stopped)) {\n                            window.clearTimeout(retryTimeoutId);\n                            if (retries < 2) {\n                                retryTimeoutId = window.setTimeout(function () {\n                                    // eslint-disable-next-line @typescript-eslint/no-use-before-define\n                                    open(url);\n                                    retries++;\n                                }, RETRY_INTERVAL * retries);\n                            }\n                            else {\n                                retries = 0;\n                                emit('error', e);\n                            }\n                        }\n                    });\n                    webSocket.addEventListener('message', function (_a) {\n                        var data = _a.data;\n                        emit('message', data);\n                    });\n                    return [2 /*return*/];\n            }\n        });\n    }); };\n    var open = function (url) {\n        if (status === 'connecting' || status === 'open') {\n            return;\n        }\n        stopped = false;\n        connect(url);\n    };\n    var reconnect = function (url) {\n        if (status === 'closed') {\n            open(url);\n            return;\n        }\n        window.setTimeout(function () { return reconnect(url); });\n        close();\n    };\n    var send = function (data) {\n        if (!window.navigator.onLine) {\n            close();\n            emit('error');\n            throw new Error('The client seems to be offline');\n        }\n        webSocket.send(data);\n    };\n    return {\n        close: close,\n        get isOnline() {\n            return window.navigator.onLine;\n        },\n        on: on,\n        open: open,\n        reconnect: reconnect,\n        send: send,\n    };\n};\n\nvar convertToMetaPermissions = function (permission) {\n    return Object.keys(permission).map(function (key) { return ({\n        type: key,\n        status: permission[key],\n    }); });\n};\nvar getLocation = function () { return __awaiter(void 0, void 0, void 0, function () {\n    return __generator(this, function (_a) {\n        return [2 /*return*/, new Promise(function (resolve, reject) {\n                navigator.geolocation.getCurrentPosition(function (_a) {\n                    var coords = _a.coords, timestamp = _a.timestamp;\n                    resolve({\n                        lat: coords.latitude,\n                        lon: coords.longitude,\n                        accuracy: coords.accuracy,\n                        timestamp: timestamp,\n                    });\n                }, reject, { timeout: 5000 });\n            })];\n    });\n}); };\nvar getTime = function () { return ({\n    // Здесь нужен полифилл, т.к. `Intl.DateTimeFormat().resolvedOptions().timeZone` - возвращает пустую строку\n    timezone_id: Intl.DateTimeFormat().resolvedOptions().timeZone,\n    timezone_offset_sec: -new Date().getTimezoneOffset() * 60,\n    timestamp: Date.now(),\n}); };\nvar getAnswerForRequestPermissions = function (requestMessageId, appInfo, items) { return __awaiter(void 0, void 0, void 0, function () {\n    var permissions, response;\n    return __generator(this, function (_a) {\n        permissions = {\n            record_audio: 'denied_once',\n            geo: 'denied_once',\n            read_contacts: 'denied_permanently',\n            push: 'denied_once',\n        };\n        response = {\n            app_info: appInfo,\n            meta: {\n                time: getTime(),\n                permissions: [],\n            },\n            server_action: {\n                action_id: 'command_response',\n                request_message_id: requestMessageId,\n                command_response: {\n                    request_permissions: {\n                        permissions: [],\n                    },\n                },\n            },\n        };\n        return [2 /*return*/, Promise.all(items.map(function (permission) { return __awaiter(void 0, void 0, void 0, function () {\n                var _a, location_1;\n                var _c, _d, _e;\n                return __generator(this, function (_f) {\n                    switch (_f.label) {\n                        case 0:\n                            _a = permission;\n                            switch (_a) {\n                                case 'geo': return [3 /*break*/, 1];\n                            }\n                            return [3 /*break*/, 5];\n                        case 1:\n                            _f.trys.push([1, 3, , 4]);\n                            return [4 /*yield*/, getLocation()];\n                        case 2:\n                            location_1 = _f.sent();\n                            permissions.geo = 'granted';\n                            response.meta.location = location_1;\n                            (_c = response.server_action.command_response.request_permissions) === null || _c === void 0 ? void 0 : _c.permissions.push({\n                                type: 'geo',\n                                status: 'granted',\n                            });\n                            return [3 /*break*/, 4];\n                        case 3:\n                            _f.sent();\n                            permissions.geo = 'denied_permanently';\n                            (_d = response.server_action.command_response.request_permissions) === null || _d === void 0 ? void 0 : _d.permissions.push({\n                                type: 'geo',\n                                status: 'denied_permanently',\n                            });\n                            return [3 /*break*/, 4];\n                        case 4: return [3 /*break*/, 6];\n                        case 5:\n                            // остальные доступы не поддерживаем\n                            (_e = response.server_action.command_response.request_permissions) === null || _e === void 0 ? void 0 : _e.permissions.push({\n                                type: permission,\n                                status: 'denied_permanently',\n                            });\n                            return [3 /*break*/, 6];\n                        case 6: return [2 /*return*/];\n                    }\n                });\n            }); })).then(function () {\n                response.meta.permissions = convertToMetaPermissions(permissions);\n                return response;\n            })];\n    });\n}); };\n\nvar IS_APPLE_MOBILE = typeof window !== 'undefined'\n    ? (/iPad|iPhone|iPod/.test(navigator.platform) ||\n        (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1)) &&\n        !window.MSStream\n    : false;\nfunction createSilentAudioFile(sampleRate) {\n    var arrayBuffer = new ArrayBuffer(10);\n    var dataView = new DataView(arrayBuffer);\n    dataView.setUint32(0, sampleRate, true);\n    dataView.setUint32(4, sampleRate, true);\n    dataView.setUint16(8, 1, true);\n    var missingCharacters = window\n        .btoa(String.fromCharCode.apply(null, new Uint8Array(arrayBuffer)))\n        .slice(0, 13);\n    return \"data:audio/wav;base64,UklGRisAAABXQVZFZm10IBAAAAABAAEA\" + missingCharacters + \"AgAZGF0YQcAAACAgICAgICAAAA=\";\n}\n/**\n * Создает объект, который позволяет воспроизводить аудио с активным silent mode.\n * Перед использование нужно вызвать initialize()\n * Создает <audio> и воспроизводит тишину, управляется turnOn/turnOff.\n * @returns object\n */\nvar createIosSilentModePatch = function () {\n    var audio = null;\n    var destroy = function () {\n        if (audio === null) {\n            return;\n        }\n        audio.src = 'about:blank';\n        audio.load();\n        audio = null;\n    };\n    /**\n     * Инициализирует патч,\n     * вызывать по событию взаимодействия пользователя со страницей (click)\n     */\n    var initialize = function () {\n        if (!IS_APPLE_MOBILE) {\n            return;\n        }\n        destroy();\n        audio = new Audio();\n        audio.setAttribute('x-webkit-airplay', 'deny');\n        audio.preload = 'auto';\n        audio.loop = true;\n        audio.src = createSilentAudioFile(16000);\n        audio.load();\n    };\n    var turnOff = function () {\n        audio === null || audio === void 0 ? void 0 : audio.pause();\n    };\n    return {\n        destroy: destroy,\n        initialize: initialize,\n        turnOff: turnOff,\n        turnOn: function () {\n            audio === null || audio === void 0 ? void 0 : audio.play().catch(function (e) {\n                console.error('ios audio patch excepted', e);\n            });\n        },\n        get isActive() {\n            return (audio === null || audio === void 0 ? void 0 : audio.paused) === false;\n        },\n    };\n};\nvar iosSilentModePatch = createIosSilentModePatch();\n\nvar isAudioSupported = typeof window !== 'undefined' && (window.AudioContext || window.webkitAudioContext);\n/**\n * Возвращает новый инстанс AudioContext или ошибку\n * @param options AudioContextOptions\n * @returns AudioContext\n */\nfunction createAudioContext(options) {\n    if (window.AudioContext) {\n        return new AudioContext(options);\n    }\n    if (window.webkitAudioContext) {\n        // eslint-disable-next-line new-cap\n        return new window.webkitAudioContext();\n    }\n    throw new Error('Audio not supported');\n}\nvar _a = createNanoEvents(), on = _a.on, emit = _a.emit;\nvar audioContext;\n/**\n * При помощи вызова функции из аргумента, возвращает, готовый к воспроизведению звука, AudioContext.\n * Всегда возвращает один и тот же AudioContext\n * @param onReady Функция, в аргумент которой будет возвращен AudioContext\n */\nvar resolveAudioContext = function (onReady) {\n    if (!audioContext) {\n        var isSafari_1 = navigator.vendor.search('Apple') >= 0;\n        var context_1 = createAudioContext();\n        audioContext = {\n            context: context_1,\n            ready: !isSafari_1 && context_1.state === 'running',\n            on: on,\n        };\n        context_1.onstatechange = function () {\n            if (audioContext.context.state === 'running') {\n                audioContext.ready = true;\n                emit('ready');\n            }\n        };\n        /// Контекст может быть не готов для использования сразу после создания\n        /// Если попробовать что-то воспроизвести в этом контексте - звука не будет\n        if (!audioContext.ready) {\n            var handleClick_1 = function () {\n                document.removeEventListener('click', handleClick_1);\n                iosSilentModePatch.initialize();\n                if (isSafari_1) {\n                    /// проигрываем тишину, т.к нужно что-то проиграть,\n                    /// чтобы сафари разрешил воспроизводить звуки в любой момент в этом контексте\n                    var oscillator = audioContext.context.createOscillator();\n                    oscillator.frequency.value = 0;\n                    oscillator.connect(audioContext.context.destination);\n                    oscillator.start(0);\n                    oscillator.stop(0.5);\n                }\n                if (audioContext.context.state === 'suspended') {\n                    /// Developers who write games, WebRTC applications, or other websites that use the Web Audio API\n                    /// should call context.resume() after the first user gesture (e.g. a click, or tap)\n                    /// https://sites.google.com/a/chromium.org/dev/audio-video/autoplay\n                    audioContext.context.resume();\n                }\n            };\n            /// чтобы сделать контекст готовым к использованию (воспроизведению звука),\n            /// необходимо событие от пользователя (только не touch)\n            document.addEventListener('click', handleClick_1);\n        }\n    }\n    if (audioContext.ready) {\n        onReady && onReady(audioContext.context, function () { return iosSilentModePatch.destroy(); });\n    }\n    else {\n        var unsubscribe_1 = on('ready', function () {\n            onReady(audioContext.context, function () { return iosSilentModePatch.destroy(); });\n            unsubscribe_1();\n        });\n    }\n};\n\n/**\n * Понижает sample rate c inSampleRate до значения outSampleRate и преобразует Float32Array в ArrayBuffer\n * @param buffer Аудио\n * @param inSampleRate текущий sample rate\n * @param outSampleRate требуемый sample rate\n * @returns Аудио со значением sample rate = outSampleRate\n */\nvar downsampleBuffer = function (buffer, inSampleRate, outSampleRate) {\n    if (outSampleRate > inSampleRate) {\n        throw new Error('downsampling rate show be smaller than original sample rate');\n    }\n    var sampleRateRatio = inSampleRate / outSampleRate;\n    var newLength = Math.round(buffer.length / sampleRateRatio);\n    var result = new Int16Array(newLength);\n    var offsetResult = 0;\n    var offsetBuffer = 0;\n    while (offsetResult < result.length) {\n        var nextOffsetBuffer = Math.round((offsetResult + 1) * sampleRateRatio);\n        var accum = 0;\n        var count = 0;\n        for (var i = offsetBuffer; i < nextOffsetBuffer && i < buffer.length; i++) {\n            accum += buffer[i];\n            count++;\n        }\n        result[offsetResult] = Math.min(1, accum / count) * 0x7fff;\n        offsetResult++;\n        offsetBuffer = nextOffsetBuffer;\n    }\n    return result.buffer;\n};\nvar TARGET_SAMPLE_RATE = 16000;\nvar IS_FIREFOX = typeof window !== 'undefined' && navigator.userAgent.toLowerCase().indexOf('firefox') > -1;\nvar IS_SAFARI = typeof window !== 'undefined' && /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\nvar context;\nvar processor;\nvar analyser = null;\nvar destination;\n/**\n * Преобразует stream в чанки (кусочки), и передает их в cb,\n * будет это делать, пока не будет вызвана функция остановки\n * @param stream Аудио-поток\n * @param cb callback, куда будут переданы чанки из потока\n * @returns Функция, вызов которой остановит передачу чанков\n */\nvar createAudioRecorder = function (stream, cb, useAnalyser) {\n    return new Promise(function (resolve) {\n        var state = 'inactive';\n        var input;\n        var stop = function () {\n            if (state === 'inactive') {\n                return;\n            }\n            state = 'inactive';\n            stream.getTracks().forEach(function (track) {\n                track.stop();\n            });\n            input.disconnect();\n        };\n        var start = function () {\n            if (state !== 'inactive') {\n                throw new Error(\"Can't start not inactive recorder\");\n            }\n            state = 'recording';\n            if (!context) {\n                context = createAudioContext({\n                    // firefox не умеет выравнивать samplerate, будем делать это самостоятельно\n                    sampleRate: IS_FIREFOX ? undefined : TARGET_SAMPLE_RATE,\n                });\n            }\n            input = context.createMediaStreamSource(stream);\n            if (!processor) {\n                processor = context.createScriptProcessor(2048, 1, 1);\n            }\n            if (!analyser && useAnalyser) {\n                analyser = context.createAnalyser();\n                analyser.fftSize = 1024;\n            }\n            var listener = function (e) {\n                var buffer = e.inputBuffer.getChannelData(0);\n                var data = downsampleBuffer(buffer, context.sampleRate, TARGET_SAMPLE_RATE);\n                var last = state === 'inactive';\n                // отсылаем только чанки где есть звук voiceData > 0, т.к.\n                // в safari первые несколько чанков со звуком пустые\n                if (!IS_SAFARI || new Uint8Array(data).some(function (voiceData) { return voiceData > 0; })) {\n                    var analyserArray = null;\n                    if (analyser) {\n                        analyserArray = new Uint8Array(analyser.frequencyBinCount);\n                        analyser === null || analyser === void 0 ? void 0 : analyser.getByteFrequencyData(analyserArray);\n                    }\n                    cb(data, analyserArray, last);\n                    resolve(stop);\n                }\n                if (last) {\n                    processor.removeEventListener('audioprocess', listener);\n                }\n            };\n            processor.addEventListener('audioprocess', listener);\n            input.connect(processor);\n            if (analyser) {\n                input.connect(analyser);\n            }\n            if (!destination) {\n                destination = context.createMediaStreamDestination();\n            }\n            processor.connect(destination);\n        };\n        start();\n    });\n};\n/**\n * Запрашивает у браузера доступ к микрофону и резолвит Promise, если разрешение получено.\n * После получения разрешения, чанки с голосом будут передаваться в cb - пока не будет вызвана функция из результата.\n * @param cb Callback, куда будут передаваться чанки с голосом пользователя\n * @returns Promise, который содержит функцию прерывающую слушание\n */\nvar createNavigatorAudioProvider = function (cb, useAnalyser) {\n    return navigator.mediaDevices\n        .getUserMedia({\n        audio: true,\n    })\n        .then(function (stream) {\n        return createAudioRecorder(stream, cb, useAnalyser);\n    })\n        .catch(function (err) {\n        if (window.location.protocol === 'http:') {\n            throw new Error('Audio is supported only on a secure connection');\n        }\n        throw err;\n    });\n};\n\n/**\n * Возвращает объект, позволяющий получать запись голоса пользователя и управлять ею.\n * @param createAudioProvider Источник голоса\n * @returns Api для запуска и остановки слушания\n */\nvar createVoiceListener = function (createAudioProvider) {\n    if (createAudioProvider === void 0) { createAudioProvider = createNavigatorAudioProvider; }\n    var _a = createNanoEvents(), emit = _a.emit, on = _a.on;\n    var stopRecord;\n    var status = 'stopped';\n    var cancelableToken = { current: false };\n    var stop = function () {\n        cancelableToken.current = true;\n        cancelableToken = { current: false };\n        status = 'stopped';\n        stopRecord === null || stopRecord === void 0 ? void 0 : stopRecord();\n        emit('status', 'stopped');\n    };\n    var listen = function (handleVoice) {\n        cancelableToken = { current: false };\n        var capturedToken = cancelableToken;\n        status = 'started';\n        emit('status', 'started');\n        return createAudioProvider(function (data, analyser, last) { return handleVoice(new Uint8Array(data), analyser, last); })\n            .then(function (recStop) {\n            stopRecord = recStop;\n        })\n            .then(function () {\n            if (capturedToken.current === true || status === 'stopped') {\n                stopRecord();\n            }\n            else {\n                status = 'listen';\n                emit('status', 'listen');\n            }\n        })\n            .catch(function (err) {\n            status = 'stopped';\n            emit('status', 'stopped');\n            throw err;\n        });\n    };\n    return {\n        listen: listen,\n        stop: stop,\n        on: on,\n        get status() {\n            return status;\n        },\n    };\n};\n\n/** Создает коллекцию треков  */\nvar createTrackCollection = function () {\n    var trackIds;\n    var trackMap;\n    var clear = function () {\n        trackIds = new Array();\n        trackMap = new Map();\n    };\n    var push = function (id, track) {\n        if (trackMap.has(id)) {\n            throw new Error('Track already exists');\n        }\n        trackMap.set(id, track);\n        trackIds.push(id);\n    };\n    var has = function (id) { return trackMap.has(id); };\n    var getById = function (id) {\n        var track = trackMap.get(id);\n        if (track === undefined) {\n            throw new Error('Unknown track id');\n        }\n        return track;\n    };\n    var getByIndex = function (index) {\n        if (index < 0 || index >= trackIds.length) {\n            throw new Error('Index out of bounds');\n        }\n        var track = trackMap.get(trackIds[index]);\n        if (track == null) {\n            throw new Error('Something wrong...');\n        }\n        return track;\n    };\n    var some = function (predicate) { return trackIds.some(function (id) { return predicate(getById(id)); }); };\n    clear();\n    return {\n        clear: clear,\n        has: has,\n        get: getById,\n        getByIndex: getByIndex,\n        push: push,\n        some: some,\n        get length() {\n            return trackIds.length;\n        },\n    };\n};\n\n/** Создает структуру для хранения загружаемых и воспроизводимых частей трека */\nvar createChunkQueue = function () {\n    var chunks = []; // очередь воспроизведения\n    /** Добавить чанк в очередь воспроизведения */\n    var push = function (chunk) {\n        chunks.push(chunk);\n    };\n    /** Удалить чанк из очереди воспроизведения */\n    var remove = function (chunk) {\n        chunks.splice(chunks.indexOf(chunk), 1);\n    };\n    return {\n        get chunks() {\n            return chunks;\n        },\n        remove: remove,\n        push: push,\n        get length() {\n            return chunks.length;\n        },\n        get ended() {\n            // считаем трек законченным, когда все воспроизведено\n            return chunks.length === 0;\n        },\n    };\n};\n\nvar HZ_BYTES_COUNT = 2;\nvar from16BitToFloat32 = function (incomingData) {\n    var l = incomingData.length;\n    var outputData = new Float32Array(l);\n    for (var i = 0; i < l; i += 1) {\n        outputData[i] = incomingData[i] / 32768.0;\n    }\n    return outputData;\n};\n/** Возвращает потоковый подгружаемый трек, который умеет себя проигрывать */\nvar createTrackStream = function (ctx, _a) {\n    var _b = _a === void 0 ? {} : _a, _c = _b.sampleRate, sampleRate = _c === void 0 ? 24000 : _c, _d = _b.numberOfChannels, numberOfChannels = _d === void 0 ? 1 : _d, _e = _b.delay, delay = _e === void 0 ? 0 : _e, onPlay = _b.onPlay, onEnd = _b.onEnd, onStop = _b.onStop, trackStatus = _b.trackStatus;\n    // очередь загруженных чанков (кусочков) трека\n    var queue = createChunkQueue();\n    var buffer = new ArrayBuffer(0);\n    var extraByte = null;\n    var status = trackStatus || 'stop';\n    var lastChunkOffset = 0;\n    var startTime = 0;\n    var firstChunk = true;\n    var loaded = false;\n    var end = function () {\n        // останавливаем воспроизведение чанков из очереди воспроизведения\n        queue.chunks.forEach(function (chunk) {\n            chunk.stop();\n        });\n        status = 'end';\n        onEnd && onEnd();\n        startTime = 0;\n        lastChunkOffset = 0;\n    };\n    var stop = function () {\n        onStop === null || onStop === void 0 ? void 0 : onStop();\n        end();\n    };\n    var play = function () {\n        var _a;\n        if (status === 'end') {\n            return;\n        }\n        var isPlaying = status === 'play';\n        if (!isPlaying) {\n            status = 'play';\n            onPlay && onPlay();\n        }\n        // воспроизводим трек, если источник уже проигрывается или поток полностью загрузился или длина загруженного\n        // больше задержки\n        if (isPlaying || loaded || buffer.byteLength / (sampleRate * HZ_BYTES_COUNT) >= delay) {\n            if (buffer.byteLength > 0) {\n                var chunk = getChunkFromBuffer();\n                startTime = queue.length === 0 ? ctx.currentTime : startTime;\n                queue.push(chunk);\n                chunk.start(startTime + lastChunkOffset);\n                lastChunkOffset += ((_a = chunk.buffer) === null || _a === void 0 ? void 0 : _a.duration) || 0;\n            }\n        }\n        if (loaded && queue.ended) {\n            end();\n            return;\n        }\n    };\n    /** Удаляет или добавляет байт для четности */\n    var getExtraBytes = function (data, bytesArraysSizes) {\n        if (extraByte == null && bytesArraysSizes.incomingMessageVoiceDataLength % 2) {\n            extraByte = data[bytesArraysSizes.incomingMessageVoiceDataLength - 1];\n            bytesArraysSizes.incomingMessageVoiceDataLength -= 1;\n            bytesArraysSizes.sourceLen -= 1;\n        }\n        else if (extraByte != null) {\n            bytesArraysSizes.prepend = extraByte;\n            bytesArraysSizes.start = 1;\n            if (bytesArraysSizes.incomingMessageVoiceDataLength % 2) {\n                bytesArraysSizes.incomingMessageVoiceDataLength += 1;\n                extraByte = null;\n            }\n            else {\n                extraByte = data[bytesArraysSizes.incomingMessageVoiceDataLength - 1];\n                bytesArraysSizes.sourceLen -= 1;\n            }\n        }\n    };\n    var createChunk = function (chunk) {\n        var audioBuffer = ctx.createBuffer(numberOfChannels, chunk.length / numberOfChannels, sampleRate);\n        for (var i = 0; i < numberOfChannels; i++) {\n            var channelChunk = new Float32Array(chunk.length / numberOfChannels);\n            var index = 0;\n            for (var j = i; j < chunk.length; j += numberOfChannels) {\n                channelChunk[index++] = chunk[j];\n            }\n            audioBuffer.getChannelData(i).set(channelChunk);\n        }\n        var source = ctx.createBufferSource();\n        source.buffer = audioBuffer;\n        source.connect(ctx.destination);\n        source.onended = function () {\n            queue.remove(source);\n            if (queue.ended && status !== 'end' && loaded) {\n                status = 'end';\n                onEnd && onEnd();\n            }\n        };\n        return source;\n    };\n    /** Получить чанк из буфера */\n    var getChunkFromBuffer = function () {\n        var tmp = buffer;\n        buffer = new ArrayBuffer(0);\n        var data = new Uint8Array(tmp);\n        var bytesArraysSizes = {\n            incomingMessageVoiceDataLength: data.length,\n            sourceLen: data.length,\n            start: 0,\n            prepend: null,\n        };\n        // выравние по два байта\n        getExtraBytes(data, bytesArraysSizes);\n        var dataBuffer = new ArrayBuffer(bytesArraysSizes.incomingMessageVoiceDataLength);\n        var bufferUi8 = new Uint8Array(dataBuffer);\n        var bufferI16 = new Int16Array(dataBuffer);\n        bufferUi8.set(data.slice(0, bytesArraysSizes.sourceLen), bytesArraysSizes.start);\n        if (bytesArraysSizes.prepend != null) {\n            bufferUi8[0] = bytesArraysSizes.prepend;\n        }\n        return createChunk(from16BitToFloat32(bufferI16));\n    };\n    /** добавляет чанк в очередь на воспроизведение */\n    var write = function (data) {\n        // 44 байта - заголовок трека\n        var slicePoint = firstChunk ? 44 : 0;\n        firstChunk = false;\n        if (slicePoint >= data.length) {\n            return;\n        }\n        var tmp = new Uint8Array(buffer.byteLength + data.length - slicePoint);\n        tmp.set(new Uint8Array(buffer), 0);\n        tmp.set(slicePoint ? data.slice(slicePoint) : data, buffer.byteLength);\n        buffer = tmp;\n        if (status === 'play') {\n            play();\n        }\n    };\n    return {\n        get loaded() {\n            return loaded;\n        },\n        setLoaded: function () {\n            loaded = true;\n            if (status === 'play') {\n                play();\n            }\n        },\n        write: write,\n        get status() {\n            return status;\n        },\n        play: play,\n        stop: stop,\n    };\n};\n\nvar createVoicePlayer = function (actx, _a) {\n    var _b = _a === void 0 ? {} : _a, _c = _b.startVoiceDelay, startVoiceDelay = _c === void 0 ? 0.2 : _c, sampleRate = _b.sampleRate, numberOfChannels = _b.numberOfChannels;\n    var _d = createNanoEvents(), on = _d.on, emit = _d.emit;\n    var tracks = createTrackCollection();\n    // true - воспроизводим все треки в очереди (новые в том числе), false - скипаем всю очередь (новые в т.ч.)\n    var active = true;\n    // индекс текущего трека в tracks\n    var cursor = 0;\n    var play = function () {\n        if (cursor >= tracks.length) {\n            if (tracks.some(function (track) { return !track.loaded; })) {\n                return;\n            }\n            iosSilentModePatch.turnOff();\n            // очищаем коллекцию, если все треки были воспроизведены\n            cursor = 0;\n            tracks.clear();\n            return;\n        }\n        // хак для silent mode ios\n        if (!iosSilentModePatch.isActive) {\n            iosSilentModePatch.turnOn();\n        }\n        // рекурсивно последовательно включаем треки из очереди\n        var current = tracks.getByIndex(cursor);\n        if (current.status === 'end') {\n            if (cursor < tracks.length) {\n                cursor++;\n                play();\n            }\n        }\n        else {\n            current.play();\n        }\n    };\n    var append = function (data, trackId, last) {\n        if (last === void 0) { last = false; }\n        var current = tracks.has(trackId) ? tracks.get(trackId) : undefined;\n        if (current == null) {\n            /// если trackId нет в коллекции - создаем трек\n            /// по окончании проигрывания - запускаем следующий трек, вызывая play\n            current = createTrackStream(actx, {\n                sampleRate: sampleRate,\n                numberOfChannels: numberOfChannels,\n                delay: startVoiceDelay,\n                onPlay: function () { return emit('play', trackId); },\n                onStop: function () { return emit('stop', trackId); },\n                onEnd: function () {\n                    emit('end', trackId);\n                    play();\n                },\n                trackStatus: active ? 'stop' : 'end',\n            });\n            tracks.push(trackId, current);\n        }\n        if (current.status !== 'end' && data.length) {\n            current.write(data);\n        }\n        if (last) {\n            // все чанки трека загружены\n            current.setLoaded();\n        }\n        play();\n    };\n    var stop = function () {\n        while (cursor < tracks.length) {\n            var cur = cursor;\n            cursor++;\n            tracks.getByIndex(cur).stop();\n        }\n        iosSilentModePatch.turnOff();\n    };\n    return {\n        append: append,\n        setActive: function (value) {\n            active = value;\n            if (value) {\n                play();\n            }\n            else {\n                stop();\n            }\n        },\n        on: on,\n        stop: stop,\n    };\n};\n\n/** Фильтр тишины */\nvar filterEmptyChunks = function (chunksOriginal) {\n    return chunksOriginal.reduce(function (acc, chunkOriginal) {\n        var chunk = chunkOriginal.filter(function (int) { return int; });\n        if (chunk.length) {\n            acc.push(chunk);\n        }\n        return acc;\n    }, []);\n};\nvar createVoice = function (client, settings, emit, \n/// пока onReady не вызван, треки не воспроизводятся\n/// когда случится onReady, очередь треков начнет проигрываться\nonReady) {\n    var useAnalyser = false;\n    var voicePlayer;\n    var listener = createVoiceListener(function (cb) { return createNavigatorAudioProvider(cb, useAnalyser); });\n    var subscriptions = [];\n    var appInfoDict = {};\n    var mesIdQueue = [];\n    /** в процессе инициализации слушания */\n    var isRecognizeInitializing = false;\n    /** проигрывается/не проигрывается озвучка */\n    var isPlaying = false;\n    /** id сообщения, после проигрывания которого, нужно активировать слушание */\n    var autolistenMessageId = null;\n    /** id сообщения со звуком, отправляемое в данный момент */\n    var currentVoiceMessageId = null;\n    /** стримит поток чанков. Если метода нет, то стриминг не идёт */\n    var streaming = null;\n    /** Уничтожает аудио-контекст */\n    var destroyAudioContext = null;\n    /** Останавливает слушание голоса, отправляет cancel. Возвращает true - если слушание было активно */\n    var stopVoice = function (sendCancel) {\n        if (sendCancel === void 0) { sendCancel = true; }\n        autolistenMessageId = null;\n        streaming = null;\n        if (sendCancel && currentVoiceMessageId) {\n            client.sendCancel(currentVoiceMessageId);\n        }\n        currentVoiceMessageId = null;\n        if (listener.status === 'listen') {\n            listener.stop();\n            return true;\n        }\n        return false;\n    };\n    /** Останавливает слушание и воспроизведение */\n    var stop = function () {\n        // здесь важен порядок остановки голоса\n        stopVoice();\n        voicePlayer === null || voicePlayer === void 0 ? void 0 : voicePlayer.stop();\n    };\n    var recognize = function (_a) {\n        var _b = _a === void 0 ? {} : _a, begin = _b.begin, messageName = _b.messageName, _c = _b.isAutoListening, isAutoListening = _c === void 0 ? false : _c;\n        return __awaiter(void 0, void 0, void 0, function () {\n            var unsubscribe_1;\n            return __generator(this, function (_d) {\n                switch (_d.label) {\n                    case 0:\n                        if (stopVoice()) {\n                            return [2 /*return*/];\n                        }\n                        if (isPlaying) {\n                            voicePlayer === null || voicePlayer === void 0 ? void 0 : voicePlayer.stop();\n                            return [2 /*return*/];\n                        }\n                        if (settings.current.disableListening) {\n                            return [2 /*return*/];\n                        }\n                        if (!(listener.status === 'stopped' && !isRecognizeInitializing)) return [3 /*break*/, 2];\n                        isRecognizeInitializing = true;\n                        unsubscribe_1 = listener.on('status', function () {\n                            isRecognizeInitializing = false;\n                            unsubscribe_1();\n                        });\n                        return [4 /*yield*/, client.init().catch(function (error) {\n                                isRecognizeInitializing = false;\n                                throw error;\n                            })];\n                    case 1:\n                        _d.sent();\n                        return [2 /*return*/, client.createVoiceStream(function (_a) {\n                                var sendVoice = _a.sendVoice, messageId = _a.messageId;\n                                begin === null || begin === void 0 ? void 0 : begin.forEach(function (chunk) { return sendVoice(new Uint8Array(chunk), false); });\n                                currentVoiceMessageId = messageId;\n                                return listener.listen(function (chunk, analyser, last) {\n                                    if (analyser) {\n                                        emit({ voiceAnalyser: { data: analyser } });\n                                    }\n                                    sendVoice(chunk, last, messageName);\n                                });\n                            }, {\n                                source: {\n                                    sourceType: isAutoListening ? 'autoListening' : 'lavashar',\n                                },\n                            })];\n                    case 2: return [2 /*return*/];\n                }\n            });\n        });\n    };\n    /**\n     * Стримит переданные чанки звука в VPS.\n     * При отсутствии last=true через 3 секунды тишины отправляет Cancel.\n     * Если было активно слушание или проигрывание – останавливает.\n     *\n     * @param chunks одноканальные, sampleRate: 16000\n     * @param last последние чанки этого стрима?\n     * @param messageName указать, если чанки для шазама\n     */\n    var streamVoice = function (chunks, last, messageName) { return __awaiter(void 0, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    chunks = filterEmptyChunks(chunks);\n                    if (streaming === null || streaming === void 0 ? void 0 : streaming(chunks, last)) {\n                        return [2 /*return*/];\n                    }\n                    stopVoice();\n                    if (isPlaying) {\n                        voicePlayer === null || voicePlayer === void 0 ? void 0 : voicePlayer.stop();\n                    }\n                    if (!(!isRecognizeInitializing && chunks.length)) return [3 /*break*/, 2];\n                    isRecognizeInitializing = true;\n                    return [4 /*yield*/, client.init()];\n                case 1:\n                    _a.sent();\n                    return [2 /*return*/, client.createVoiceStream(function (_a) {\n                            var messageId = _a.messageId, sendVoice = _a.sendVoice;\n                            return __awaiter(void 0, void 0, void 0, function () {\n                                var cancelTimeoutId;\n                                return __generator(this, function (_b) {\n                                    cancelTimeoutId = -1;\n                                    isRecognizeInitializing = false;\n                                    currentVoiceMessageId = messageId;\n                                    streaming = function (ch, l) {\n                                        clearTimeout(cancelTimeoutId);\n                                        ch.forEach(function (chunk) { return sendVoice(new Uint8Array(chunk), l, messageName); });\n                                        if (l) {\n                                            streaming = null;\n                                        }\n                                        else {\n                                            cancelTimeoutId = setTimeout(function () {\n                                                if (streaming) {\n                                                    stopVoice();\n                                                }\n                                            }, 3000);\n                                        }\n                                        return true;\n                                    };\n                                    streaming(chunks, last);\n                                    return [2 /*return*/];\n                                });\n                            });\n                        }, {\n                            source: {\n                                sourceType: 'lavashar',\n                            },\n                        })];\n                case 2: return [2 /*return*/];\n            }\n        });\n    }); };\n    /**\n     * Отправляет готовые чанки звука в VPS.\n     * Чанки считаются завершёнными (сообщение отправляется с last=true).\n     * Если было активно слушание или проигрывание – останавливает.\n     *\n     * @param chunks одноканальные, sampleRate: 16000\n     * @param messageName указать, если чанки для шазама\n     */\n    var sendVoice = function (chunks, messageName) { return __awaiter(void 0, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    chunks = filterEmptyChunks(chunks);\n                    stopVoice();\n                    if (isPlaying) {\n                        voicePlayer === null || voicePlayer === void 0 ? void 0 : voicePlayer.stop();\n                    }\n                    if (!(!isRecognizeInitializing && chunks.length)) return [3 /*break*/, 2];\n                    isRecognizeInitializing = true;\n                    return [4 /*yield*/, client.init()];\n                case 1:\n                    _a.sent();\n                    return [2 /*return*/, client.createVoiceStream(function (_a) {\n                            var messageId = _a.messageId, sendVoiceStream = _a.sendVoice;\n                            isRecognizeInitializing = false;\n                            currentVoiceMessageId = messageId;\n                            chunks.forEach(function (chunk) { return sendVoiceStream(new Uint8Array(chunk), true, messageName); });\n                            return Promise.resolve();\n                        }, {\n                            source: {\n                                sourceType: 'lavashar',\n                            },\n                        })];\n                case 2: return [2 /*return*/];\n            }\n        });\n    }); };\n    /**\n     * Активирует слушание голоса.\n     * Если было активно слушание или проигрывание - останавливает, слушание в этом случае не активируется.\n     *\n     * @param begin одноканальные чанки, sampleRate: 16000 – будут отправлены перед голосом пользователя\n     */\n    var listen = function (_a, isAutoListening) {\n        var _b = _a === void 0 ? {} : _a, begin = _b.begin;\n        return recognize({ begin: begin, isAutoListening: isAutoListening });\n    };\n    /**\n     * Активирует распознавание музыки.\n     * Если было активно слушание или проигрывание – останавливает\n     */\n    var shazam = function () {\n        return recognize({ messageName: MessageNames.MTT, isAutoListening: false });\n    };\n    if (isAudioSupported) {\n        resolveAudioContext(function (context, destroy) {\n            /// создаем плеер только если поддерживается аудио\n            /// и только когда готов AudioContext\n            voicePlayer = createVoicePlayer(context, { startVoiceDelay: 1 });\n            destroyAudioContext = destroy;\n            // начало проигрывания озвучки\n            subscriptions.push(voicePlayer.on('play', function (mesId) {\n                isPlaying = true;\n                emit({ emotion: 'talk' });\n                emit({ tts: { status: 'start', messageId: Number(mesId), appInfo: appInfoDict[mesId] } });\n            }));\n            subscriptions.push(voicePlayer.on('stop', function (mesId) {\n                client.sendMute(Number(mesId));\n            }));\n            // окончание проигрывания озвучки\n            subscriptions.push(voicePlayer.on('end', function (mesId) {\n                isPlaying = false;\n                emit({ emotion: 'idle' });\n                emit({ tts: { status: 'stop', messageId: Number(mesId), appInfo: appInfoDict[mesId] } });\n                if (mesId === autolistenMessageId) {\n                    listen().catch(function (error) {\n                        // eslint-disable-next-line no-console\n                        console.error(error);\n                    });\n                }\n                // очистка сохраненных appInfo и messageId\n                var idx = 0;\n                do {\n                    delete appInfoDict[mesIdQueue[0]];\n                } while (mesIdQueue[idx++] !== mesId && mesIdQueue.length > idx);\n                mesIdQueue.splice(0, idx);\n            }));\n            // оповещаем о готовности к воспроизведению звука\n            onReady === null || onReady === void 0 ? void 0 : onReady();\n        });\n    }\n    subscriptions.push(\n    // обработка входящей озвучки\n    client.on('voice', function (data, message) {\n        if (settings.current.disableDubbing) {\n            return;\n        }\n        voicePlayer === null || voicePlayer === void 0 ? void 0 : voicePlayer.append(data, message.messageId.toString(), message.last === 1);\n    }), \n    // статусы слушания речи\n    listener.on('status', function (status) {\n        emit({ listener: { status: status } });\n        if (status === 'listen') {\n            voicePlayer === null || voicePlayer === void 0 ? void 0 : voicePlayer.setActive(false);\n            emit({ emotion: 'listen' });\n        }\n        else if (status === 'stopped') {\n            voicePlayer === null || voicePlayer === void 0 ? void 0 : voicePlayer.setActive(!settings.current.disableDubbing);\n            emit({ asr: { text: '' }, emotion: 'idle' });\n        }\n    }), \n    // активация автослушания\n    client.on('systemMessage', function (systemMessage, originalMessage) {\n        var autoListening = systemMessage.auto_listening;\n        var messageId = originalMessage.messageId.toString();\n        if (typeof systemMessage.app_info !== 'undefined') {\n            appInfoDict[messageId] = systemMessage.app_info;\n            mesIdQueue.push(messageId);\n        }\n        if (autoListening) {\n            /// если озвучка включена - сохраняем mesId чтобы включить слушание после озвучки\n            /// если озвучка выключена - включаем слушание сразу\n            if (settings.current.disableDubbing === false) {\n                autolistenMessageId = messageId;\n            }\n            else {\n                listen({}, autoListening).catch(function (error) {\n                    // eslint-disable-next-line no-console\n                    console.error(error);\n                });\n            }\n        }\n    }), client.on('status', function (_a) {\n        var code = _a.code;\n        if (code < 0) {\n            stopVoice(false);\n        }\n    }), client.on('stt', function (_a, originalMessage) {\n        var _b;\n        var text = _a.text, response = _a.response;\n        var listening = listener.status === 'listen' && !settings.current.disableListening;\n        if (text) {\n            var last = originalMessage.last === 1;\n            if (last || listening) {\n                emit({\n                    asr: {\n                        mid: originalMessage.messageId,\n                        text: text.data || '',\n                        last: last,\n                    },\n                });\n            }\n            if (last) {\n                stopVoice(false);\n            }\n        }\n        if (response) {\n            var decoderResultField = response.decoderResultField, errorResponse = response.errorResponse;\n            var last = !!(decoderResultField && (decoderResultField === null || decoderResultField === void 0 ? void 0 : decoderResultField.isFinal));\n            if ((last || listening) && ((_b = decoderResultField === null || decoderResultField === void 0 ? void 0 : decoderResultField.hypothesis) === null || _b === void 0 ? void 0 : _b.length)) {\n                emit({\n                    asr: {\n                        mid: originalMessage.messageId,\n                        text: decoderResultField.hypothesis[0].normalizedText || '',\n                        last: last,\n                    },\n                });\n            }\n            if (last || errorResponse) {\n                stopVoice(false);\n            }\n        }\n    }), client.on('musicRecognition', function (response, originalMessage) {\n        var _a;\n        emit({ mtt: { response: response, mid: originalMessage.messageId } });\n        if (((_a = response.decoderResultField) === null || _a === void 0 ? void 0 : _a.isFinal) || response.errorResponse) {\n            stopVoice(false);\n        }\n    }), settings.on('change-request', function (nextSettings) {\n        var disableDubbing = nextSettings.disableDubbing, disableListening = nextSettings.disableListening;\n        /// Важен порядок обработки флагов слушания и озвучки —\n        /// сначала слушание, потом озвучка\n        disableListening && stopVoice();\n        // Такой вызов необходим, чтобы включая озвучку она тут же проигралась (при её наличии), и наоборот\n        settings.current.disableDubbing !== disableDubbing && (voicePlayer === null || voicePlayer === void 0 ? void 0 : voicePlayer.setActive(!disableDubbing));\n    }));\n    return {\n        destroy: function () {\n            stopVoice();\n            voicePlayer === null || voicePlayer === void 0 ? void 0 : voicePlayer.setActive(false);\n            subscriptions.splice(0, subscriptions.length).map(function (unsubscribe) { return unsubscribe(); });\n            destroyAudioContext === null || destroyAudioContext === void 0 ? void 0 : destroyAudioContext();\n        },\n        listen: listen,\n        shazam: shazam,\n        sendVoice: sendVoice,\n        streamVoice: streamVoice,\n        stop: stop,\n        stopPlaying: function () {\n            voicePlayer === null || voicePlayer === void 0 ? void 0 : voicePlayer.stop();\n        },\n        toggleAnalyser: function (enable) {\n            useAnalyser = enable;\n        },\n    };\n};\n\nvar createMutexedObject = function (initialObject) {\n    var _a = createNanoEvents(), on = _a.on, emit = _a.emit;\n    var object = __assign({}, initialObject);\n    var nextObject = {};\n    var mode = 'released';\n    var tryApply = function () {\n        if (mode === 'released') {\n            var prevObject_1 = object;\n            object = __assign(__assign({}, prevObject_1), nextObject);\n            var isObjectChanged = Object.keys(nextObject).some(function (name) { return nextObject[name] !== prevObject_1[name]; });\n            if (isObjectChanged) {\n                emit('changed', object, prevObject_1);\n            }\n        }\n    };\n    var lock = function () {\n        mode = 'locked';\n    };\n    var release = function () {\n        mode = 'released';\n        tryApply();\n    };\n    var change = function (setts) {\n        nextObject = __assign(__assign({}, nextObject), setts);\n        emit('change-request', setts);\n        tryApply();\n    };\n    var current = {};\n    Object.keys(initialObject).forEach(function (prop) {\n        Object.defineProperty(current, prop, {\n            get: function () {\n                return object[prop];\n            },\n        });\n    });\n    return {\n        on: on,\n        lock: lock,\n        release: release,\n        change: change,\n        current: current,\n    };\n};\n\nvar createMutexSwitcher = function (_a, initialDeps) {\n    var lock = _a.lock, release = _a.release;\n    var deps = __assign({}, initialDeps);\n    return {\n        change: function (nextDeps) {\n            deps = __assign(__assign({}, deps), nextDeps);\n            if (Object.values(deps).every(function (dep) { return dep; })) {\n                release();\n            }\n            else {\n                lock();\n            }\n        },\n    };\n};\n\nvar STATE_UPDATE_TIMEOUT = 200;\nvar DEFAULT_PROJECT_ID = 'd929986a-611a-2ba0-6174-1928c99600a5';\nvar DEFAULT_APPLICATION_ID = '7c4e23bf-cd93-b57e-874b-d9fc1b35f93d';\nvar DEFAULT_APP_VERSION_ID = '26d0bb2e-45d6-a276-f70e-6c016d1f9cff';\nvar DEFAULT_APP = {\n    projectId: DEFAULT_PROJECT_ID,\n    applicationId: DEFAULT_APPLICATION_ID,\n    appversionId: DEFAULT_APP_VERSION_ID,\n    frontendStateId: [DEFAULT_PROJECT_ID, DEFAULT_APPLICATION_ID, DEFAULT_APP_VERSION_ID].join('_'),\n    frontendType: 'DIALOG',\n    systemName: 'assistant',\n    frontendEndpoint: 'None',\n};\nvar BASIC_SMART_APP_COMMANDS_TYPES = ['smart_app_data', 'smart_app_error', 'start_smart_search', 'navigation'];\nfunction convertFieldValuesToString(object) {\n    return Object.keys(object).reduce(function (acc, key) {\n        if (object[key]) {\n            acc[key] =\n                typeof object[key] === 'string' && object[key].startsWith('{')\n                    ? object[key]\n                    : JSON.stringify(object[key]);\n        }\n        return acc;\n    }, {});\n}\nvar isDefaultApp = function (appInfo) { return appInfo.frontendStateId === DEFAULT_APP.frontendStateId; };\nvar promiseTimeout = function (promise, timeout) {\n    var timeoutId;\n    return Promise.race([\n        promise.then(function (v) {\n            if (timeoutId) {\n                window.clearTimeout(timeoutId);\n            }\n            return v;\n        }),\n        new Promise(function (_, reject) {\n            timeoutId = window.setTimeout(function () {\n                reject(new Error(\"Timed out in \" + timeout + \" ms.\"));\n            }, timeout);\n        }),\n    ]);\n};\nvar createAssistant = function (_a) {\n    var _b;\n    var getMeta = _a.getMeta, getInitialMeta = _a.getInitialMeta, getVoiceMeta = _a.getVoiceMeta, checkCertUrl = _a.checkCertUrl, configuration = __rest(_a, [\"getMeta\", \"getInitialMeta\", \"getVoiceMeta\", \"checkCertUrl\"]);\n    var _c = createNanoEvents(), on = _c.on, emit = _c.emit;\n    // default_character отправляется в мета при отправке InitialSettings\n    var defaultCharacter = 'sber';\n    // хеш [messageId]: requestId, где requestId - пользовательский ид экшена\n    var requestIdMap = {};\n    // mid для последнего отправленного/принятого сообщения (кроме server_action)\n    var lastMid = 0;\n    var subscriptions = [];\n    var backgroundApps = {};\n    var settings = createMutexedObject({\n        disableDubbing: configuration.settings.dubbing === -1,\n        disableListening: false,\n        sendTextAsSsml: false,\n    });\n    var settingsSwitcher = createMutexSwitcher(settings, { isListenerStopped: true, isVoicePlayerEnded: true });\n    // готов/не готов воспроизводить озвучку\n    var voiceReady = false;\n    // текущий апп\n    var app = { info: DEFAULT_APP };\n    var sdkMeta = { theme: 'dark' };\n    var metaProvider = function (additionalMeta) { return __awaiter(void 0, void 0, void 0, function () {\n        var appState, _a, current_app, getBackgroundAppsMeta, background_apps;\n        return __generator(this, function (_b) {\n            switch (_b.label) {\n                case 0:\n                    if (!(app !== null && app.info.frontendType === 'WEB_APP' && app.getState)) return [3 /*break*/, 2];\n                    return [4 /*yield*/, promiseTimeout(app.getState(), STATE_UPDATE_TIMEOUT).catch(function () {\n                            // eslint-disable-next-line no-console\n                            console.error('App-state wasn`t resolved, timeout had been expired');\n                            return undefined;\n                        })];\n                case 1:\n                    _a = _b.sent();\n                    return [3 /*break*/, 3];\n                case 2:\n                    _a = undefined;\n                    _b.label = 3;\n                case 3:\n                    appState = _a;\n                    current_app = {\n                        app_info: app.info,\n                        state: appState || {},\n                    };\n                    getBackgroundAppsMeta = function () { return __awaiter(void 0, void 0, void 0, function () {\n                        var apps, backgroundAppsIds, backgroundAppsMeta;\n                        return __generator(this, function (_a) {\n                            switch (_a.label) {\n                                case 0:\n                                    apps = __assign({}, backgroundApps);\n                                    backgroundAppsIds = Object.keys(apps);\n                                    backgroundAppsMeta = [];\n                                    return [4 /*yield*/, Promise.all(backgroundAppsIds.map(function (applicationId) { return __awaiter(void 0, void 0, void 0, function () {\n                                            var _a, getState;\n                                            return __generator(this, function (_b) {\n                                                _a = apps[applicationId].getState, getState = _a === void 0 ? function () { return Promise.resolve({}); } : _a;\n                                                return [2 /*return*/, promiseTimeout(getState(), STATE_UPDATE_TIMEOUT).then(function (state) { return state; }, function () { return ({}); })];\n                                            });\n                                        }); })).then(function (results) {\n                                            results.forEach(function (appResult, index) {\n                                                var state = appResult;\n                                                var applicationId = backgroundAppsIds[index];\n                                                backgroundAppsMeta.push({\n                                                    app_info: apps[applicationId].appInfo,\n                                                    state: state,\n                                                });\n                                            });\n                                        })];\n                                case 1:\n                                    _a.sent();\n                                    return [2 /*return*/, backgroundAppsMeta];\n                            }\n                        });\n                    }); };\n                    return [4 /*yield*/, getBackgroundAppsMeta()];\n                case 4:\n                    background_apps = _b.sent();\n                    return [2 /*return*/, convertFieldValuesToString(__assign(__assign(__assign(__assign({}, sdkMeta), { time: getTime(), current_app: current_app, background_apps: background_apps }), (additionalMeta || {})), (getMeta ? getMeta() : {})))];\n            }\n        });\n    }); };\n    var transport = createTransport({\n        createWS: (_b = configuration.fakeVps) === null || _b === void 0 ? void 0 : _b.createFakeWS,\n        checkCertUrl: checkCertUrl,\n    });\n    var protocol = createProtocol(transport, __assign(__assign({}, configuration), { getInitialMeta: typeof getInitialMeta !== 'undefined'\n            ? function () {\n                return getInitialMeta().then(function (meta) {\n                    return convertFieldValuesToString(__assign(__assign({}, meta), { default_character: defaultCharacter }));\n                });\n            }\n            : function () {\n                return convertFieldValuesToString({\n                    default_character: defaultCharacter,\n                });\n            }, \n        // пока голос не готов, выключаем озвучку\n        settings: __assign(__assign({}, configuration.settings), { dubbing: -1 }) }));\n    var client = createClient(protocol, metaProvider, {\n        getVoiceMeta: function () { return (getVoiceMeta ? convertFieldValuesToString(getVoiceMeta()) : {}); },\n    });\n    var voice = createVoice(client, settings, function (event) {\n        if (typeof event.tts !== 'undefined') {\n            emit('tts', event.tts);\n            settingsSwitcher.change({ isVoicePlayerEnded: event.tts.status === 'stop' });\n            return;\n        }\n        if (typeof event.listener !== 'undefined') {\n            settingsSwitcher.change({ isListenerStopped: event.listener.status === 'stopped' });\n        }\n        emit('assistant', event);\n    }, function () {\n        voiceReady = true;\n        if (!settings.current.disableDubbing) {\n            protocol.changeSettings({ dubbing: 1 });\n        }\n    });\n    /** завершает текущий апп */\n    var closeApp = function (closing) {\n        if (closing === void 0) { closing = app.info; }\n        // переключить на дефолтный апп\n        if (closing.applicationId === app.info.applicationId) {\n            /// выглядит как нарушение логики,\n            /// но с точки зрения апи - ок\n            /// иначе потребителю нужно знать про DEFAULT_APP\n            app = {\n                info: DEFAULT_APP,\n            };\n        }\n        if (!isDefaultApp(closing)) {\n            emit('app', { type: 'close', app: closing });\n        }\n    };\n    /** отправляет текст */\n    var sendText = function (text, shouldSendDisableDubbing, additionalMeta) {\n        if (shouldSendDisableDubbing === void 0) { shouldSendDisableDubbing = false; }\n        voice.stop();\n        return client.sendText(text, settings.current.sendTextAsSsml, shouldSendDisableDubbing, additionalMeta);\n    };\n    /** отправляет server_action */\n    var sendServerAction = function (serverAction, messageName, requestId, actionApp, mode) {\n        if (messageName === void 0) { messageName = 'SERVER_ACTION'; }\n        if (requestId === void 0) { requestId = undefined; }\n        if (actionApp === void 0) { actionApp = app.info; }\n        client.sendServerAction(serverAction, actionApp, messageName, mode).then(function (messageId) {\n            if (requestId && messageId) {\n                requestIdMap[messageId.toString()] = requestId;\n            }\n        });\n    };\n    /** отправляет ответ на запрос доступа к местоположению и пр. меты */\n    var sendMetaForPermissionRequest = function (requestMessageId, appInfo, items) { return __awaiter(void 0, void 0, void 0, function () {\n        var _a, props, data, meta;\n        return __generator(this, function (_b) {\n            switch (_b.label) {\n                case 0: return [4 /*yield*/, getAnswerForRequestPermissions(requestMessageId, appInfo, items)];\n                case 1:\n                    _a = _b.sent(), props = __rest(_a.meta, []), data = __rest(_a, [\"meta\"]);\n                    return [4 /*yield*/, metaProvider()];\n                case 2:\n                    meta = _b.sent();\n                    client.sendData(__assign({}, data), 'SERVER_ACTION', __assign(__assign({}, meta), convertFieldValuesToString(props)));\n                    return [2 /*return*/];\n            }\n        });\n    }); };\n    subscriptions.push(protocol.on('ready', function () { return emit('vps', { type: 'ready' }); }));\n    // пока voicePlayer не доступен, включение озвучки не будет отправлено\n    subscriptions.push(settings.on('changed', function (nextSettings, prevSettings) {\n        if (nextSettings.disableDubbing !== prevSettings.disableDubbing) {\n            voiceReady && protocol.changeSettings({ dubbing: nextSettings.disableDubbing ? -1 : 1 });\n        }\n    }));\n    // при неудачном переподключении к сокету\n    subscriptions.push(transport.on('error', function (error) {\n        voice.stop();\n        protocol.clearQueue();\n        emit('vps', { type: 'error', error: error });\n    }));\n    // обработка исходящих сообщений\n    subscriptions.push(protocol.on('outcoming', function (message) {\n        if (message.text || message.voice) {\n            /// не прерываем множественные ответы для сервер-экшенов\n            /// прервем, если получим карточку или бабл в ответ\n            lastMid = message.messageId;\n        }\n        emit('vps', { type: 'outcoming', message: message });\n    }));\n    // обработка ошибок\n    subscriptions.push(protocol.on('error', function (error) {\n        emit('error', error);\n    }));\n    // оповещение о статусах\n    subscriptions.push(client.on('status', function (status, _a) {\n        var messageId = _a.messageId;\n        emit('status', status, messageId);\n    }));\n    // история на запрос GetHistoryRequest\n    subscriptions.push(client.on('history', function (history) {\n        emit('history', history);\n    }));\n    // обработка входящих команд, и событий аппа\n    subscriptions.push(client.on('systemMessage', function (systemMessage, originalMessage) {\n        if (originalMessage.messageName === 'ANSWER_TO_USER') {\n            var _a = systemMessage.answerId, answerId = _a === void 0 ? 0 : _a, activate_app_info = systemMessage.activate_app_info, _b = systemMessage.items, items = _b === void 0 ? [] : _b, mesAppInfo = systemMessage.app_info;\n            var isChatApp = mesAppInfo && mesAppInfo.frontendType === 'CHAT_APP';\n            var isDialog = mesAppInfo && mesAppInfo.frontendType === 'DIALOG';\n            var isAppChanged = mesAppInfo && mesAppInfo.applicationId !== app.info.applicationId;\n            if (\n            // DIALOG не попадает в current_app\n            !isDialog &&\n                isAppChanged &&\n                /// игнорируем activate_app_info для чатапов\n                /// по-умолчанию activate_app_info: true\n                (isChatApp || activate_app_info !== false)) {\n                emit('app', { type: 'run', app: mesAppInfo });\n            }\n            if (isDialog && isAppChanged && app.info.applicationId !== DEFAULT_APPLICATION_ID) {\n                emit('app', { type: 'run', app: DEFAULT_APP });\n            }\n            // cancel для множественных ответов\n            if (answerId >= 2 && lastMid > originalMessage.messageId) {\n                client.sendCancel(originalMessage.messageId);\n            }\n            // последним сообщением считаем, только если пришли карточки/баблы\n            if (lastMid < originalMessage.messageId && items.findIndex(function (_a) {\n                var bubble = _a.bubble, card = _a.card;\n                return bubble || card;\n            }) >= 0) {\n                lastMid = originalMessage.messageId;\n            }\n            if (items.length) {\n                var _loop_1 = function (i) {\n                    var command = items[i].command;\n                    if (typeof command !== 'undefined') {\n                        window.setTimeout(function () { return emit('command', command); });\n                        if (command.type === 'start_music_recognition') {\n                            voice.shazam();\n                            return { value: void 0 };\n                        }\n                        if (command.type === 'request_permissions' && mesAppInfo) {\n                            sendMetaForPermissionRequest(originalMessage.messageId, mesAppInfo, command.permissions);\n                            return { value: void 0 };\n                        }\n                        if (command.type === 'action') {\n                            emit('actionCommand', {\n                                type: 'command',\n                                command: command,\n                                appInfo: mesAppInfo,\n                            });\n                        }\n                        if (mesAppInfo && BASIC_SMART_APP_COMMANDS_TYPES.includes(command.type)) {\n                            // эмитим все команды, т.к бывают фоновые команды\n                            emit('app', {\n                                type: 'command',\n                                command: __assign(__assign({}, command), { sdk_meta: {\n                                        mid: originalMessage.messageId.toString(),\n                                        requestId: requestIdMap[originalMessage.messageId.toString()],\n                                    } }),\n                                app: mesAppInfo,\n                            });\n                        }\n                        if (command.type === 'close_app' && !isDialog) {\n                            closeApp(mesAppInfo);\n                        }\n                    }\n                };\n                for (var i = 0; i < items.length; i++) {\n                    var state_1 = _loop_1(i);\n                    if (typeof state_1 === \"object\")\n                        return state_1.value;\n                }\n            }\n            emit('vps', { type: 'incoming', systemMessage: systemMessage, originalMessage: originalMessage });\n        }\n    }));\n    // прокидывает команды backgroundApp'ов в их подписчики\n    on('app', function (event) {\n        var _a;\n        if (event.type === 'command') {\n            var backgroundAppOnCommand = (_a = backgroundApps[event.app.applicationId]) === null || _a === void 0 ? void 0 : _a.commandsSubscribers;\n            if (Array.isArray(backgroundAppOnCommand)) {\n                backgroundAppOnCommand.forEach(function (onCommand) {\n                    var _a;\n                    onCommand(event.command, (_a = event.command.sdk_meta) === null || _a === void 0 ? void 0 : _a.mid);\n                });\n            }\n        }\n    });\n    /** уничтожает ассистент, очищает подписки */\n    var destroy = function () {\n        voice.destroy();\n        client.destroy();\n        protocol.destroy();\n        subscriptions.splice(0, subscriptions.length).map(function (unsubscribe) { return unsubscribe(); });\n    };\n    /** запускает ассистент (приветствие) */\n    var start = function (_a) {\n        var _b = _a === void 0 ? {} : _a, _c = _b.disableGreetings, disableGreetings = _c === void 0 ? false : _c, _d = _b.initPhrase, initPhrase = _d === void 0 ? undefined : _d, _e = _b.isFirstSession, isFirstSession = _e === void 0 ? false : _e;\n        return __awaiter(void 0, void 0, void 0, function () {\n            return __generator(this, function (_f) {\n                switch (_f.label) {\n                    case 0:\n                        if (!(!disableGreetings && isDefaultApp(app.info))) return [3 /*break*/, 2];\n                        return [4 /*yield*/, client.sendOpenAssistant({ isFirstSession: isFirstSession })];\n                    case 1:\n                        _f.sent();\n                        _f.label = 2;\n                    case 2:\n                        if (initPhrase) {\n                            return [2 /*return*/, client\n                                    .sendText(initPhrase)\n                                    .then(function (messageId) { return (messageId ? client.waitForAnswer(messageId) : undefined); })];\n                        }\n                        return [2 /*return*/, undefined];\n                }\n            });\n        });\n    };\n    return {\n        get activeApp() {\n            return !isDefaultApp(app.info) ? app.info : null;\n        },\n        get settings() {\n            return Object.create(Object.getPrototypeOf(settings.current), Object.getOwnPropertyDescriptors(settings.current));\n        },\n        destroy: destroy,\n        closeApp: closeApp,\n        listen: voice.listen,\n        shazam: voice.shazam,\n        sendServerAction: sendServerAction,\n        getHistoryRequest: protocol.getHistoryRequest,\n        sendText: sendText,\n        sendVoice: voice.sendVoice,\n        streamVoice: voice.streamVoice,\n        start: start,\n        stop: function () {\n            voice.stop();\n            if (lastMid !== 0) {\n                client.sendCancel(lastMid);\n            }\n            setTimeout(function () {\n                protocol.clearQueue();\n                transport.close();\n            });\n        },\n        stopTts: voice.stopPlaying,\n        stopVoice: voice.stop,\n        emit: emit,\n        on: on,\n        changeConfiguration: protocol.changeConfiguration,\n        changeSettings: settings.change,\n        changeSdkMeta: function (nextSdkMeta) {\n            sdkMeta = __assign(__assign({}, sdkMeta), nextSdkMeta);\n        },\n        reconnect: protocol.reconnect,\n        get protocol() {\n            return protocol;\n        },\n        setActiveApp: function (info, getState) {\n            app = { info: info, getState: getState };\n        },\n        addBackgroundApp: function (_a) {\n            var appInfo = _a.appInfo, getState = _a.getState;\n            backgroundApps[appInfo.applicationId] = {\n                appInfo: appInfo,\n                getState: getState,\n                commandsSubscribers: [],\n            };\n            var remove = function () {\n                delete backgroundApps[appInfo.applicationId];\n            };\n            var onCommand = function (subscriber) {\n                var _a;\n                (_a = backgroundApps[appInfo.applicationId]) === null || _a === void 0 ? void 0 : _a.commandsSubscribers.push(subscriber);\n                return {\n                    clearSubscribers: function () {\n                        if (backgroundApps[appInfo.applicationId]) {\n                            backgroundApps[appInfo.applicationId].commandsSubscribers = [];\n                        }\n                    },\n                };\n            };\n            var sendServerActionToBackgroundApp = function (serverAction, messageName, requestId) {\n                var _a;\n                if (messageName === void 0) { messageName = 'SERVER_ACTION'; }\n                if (requestId === void 0) { requestId = undefined; }\n                return sendServerAction(serverAction, messageName, requestId, (_a = backgroundApps[appInfo.applicationId]) === null || _a === void 0 ? void 0 : _a.appInfo);\n            };\n            return {\n                remove: remove,\n                onCommand: onCommand,\n                sendServerAction: sendServerActionToBackgroundApp,\n            };\n        },\n        get status() {\n            return protocol.status;\n        },\n        setDefaultCharacterMeta: function (characterId) {\n            defaultCharacter = characterId;\n        },\n        toggleVoiceAnalyser: voice.toggleAnalyser,\n    };\n};\n\nexport { createNavigatorAudioProvider as a, asrExports as b, createAssistant as c };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}